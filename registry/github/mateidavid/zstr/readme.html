<div id="readme" class="org" data-path="README.org"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">A C++ ZLib wrapper</h2><a id="user-content-a-c-zlib-wrapper" class="anchor" aria-label="Permalink: A C++ ZLib wrapper" href="#a-c-zlib-wrapper"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="http://travis-ci.org/mateidavid/zstr" rel="nofollow"><img src="https://camo.githubusercontent.com/a1d0e2411d9b944d090b1dcf2e9aab93955af6e1048e28b7601ff44dcb6c2831/687474703a2f2f7472617669732d63692e6f72672f6d6174656964617669642f7a7374722e7376673f6272616e63683d6d6173746572" alt="http://travis-ci.org/mateidavid/zstr.svg?branch=master" data-canonical-src="http://travis-ci.org/mateidavid/zstr.svg?branch=master" style="max-width: 100%;"></a> <a href="https://tldrlegal.com/license/mit-license" rel="nofollow"><img src="https://camo.githubusercontent.com/d8238ad4fa02968d60f3c1dc7ff0daf3c403a63aa40c8118f79bf0bc2db91c1b/687474703a2f2f696d672e736869656c64732e696f2f3a6c6963656e73652d6d69742d626c75652e737667" alt="http://img.shields.io/:license-mit-blue.svg" data-canonical-src="http://img.shields.io/:license-mit-blue.svg" style="max-width: 100%;"></a></p>
<p dir="auto">This C++ header-only library enables the use of C++ standard iostreams to access ZLib-compressed streams.</p>
<p dir="auto">For input access (decompression), the compression format is auto-detected, and multiple concatenated compressed streams are decompressed seamlessly.</p>
<p dir="auto">For output access (compression), the only parameter exposed by this API is the compression level.</p>
<p dir="auto">Alternatives to this library include:</p>
<ul dir="auto">
  <li>The original <a href="http://www.zlib.net/" rel="nofollow">ZLib</a>, through its <a href="http://www.zlib.net/manual.html" rel="nofollow">C API</a>. This does not interact nicely with C++ iostreams.</li>
  <li>The <a href="http://www.cs.unc.edu/Research/compgeom/gzstream/" rel="nofollow">GZStream</a> library. This library does not auto-detect input compression, and it cannot wrap streams (only files).</li>
  <li>The <a href="http://www.boost.org/doc/libs/release/libs/iostreams/" rel="nofollow">Boost IOStreams</a> library. The library does not auto-detect input compression (by default, though that can be easily implemented with filters), and more importantly, it is not a header-only Boost library.</li>
  <li>The <a href="https://github.com/tmaklin/bxzstr">bxzstr</a> library, if you want support for BZ2 and/or LZMA as well.</li>
</ul>
<p dir="auto">For an example usage, see <a href="examples/ztxtpipe.cpp">examples/ztxtpipe.cpp</a> and <a href="examples/zc.cpp">examples/zc.cpp</a>.</p>
<p dir="auto">It is compatible with <a href="https://github.com/richgel999/miniz">miniz</a> in case you don’t want to get frustrated with zlib e. g. on Windows.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Input Auto-detection</h4><a id="user-content-input-auto-detection" class="anchor" aria-label="Permalink: Input Auto-detection" href="#input-auto-detection"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">For input access, the library seamlessly auto-detects whether the source stream is compressed or not. The following compressed streams are detected:</p>
<ul dir="auto">
  <li>GZip header, when stream starts with <code>1F 8B</code>. See <a href="http://en.wikipedia.org/wiki/Gzip" rel="nofollow">GZip format</a>.</li>
  <li>ZLib header, when stream starts with <code>78 01</code>, <code>78 9C</code>, and <code>78 DA</code>. See <a href="http://stackoverflow.com/a/17176881" rel="nofollow">answer here</a>.</li>
</ul>
<p dir="auto">If none of these formats are detected, the library assumes the input is not compressed, and it produces a plain copy of the source stream.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Classes</h4><a id="user-content-classes" class="anchor" aria-label="Permalink: Classes" href="#classes"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The package provides 6 classes for accessing ZLib streams:</p>
<ul dir="auto">
  <li><code>zstr::istreambuf</code> is the core decompression class. This is constructed from an existing <code>std::streambuf</code> that contains source data. The <code>zstr::istreambuf</code> constructor accepts explicit settings for the internal buffer size (default: 1 MB) and the auto-detection option (default: on). ZLib errors cause exceptions to be thrown.</li>
  <li><code>zstr::ostreambuf</code> is the core compression class. This is constructed from an existing <code>std::streambuf</code> that contains sink data. The <code>zstr::ostreambuf</code> constructor accepts explicit settings for the internal buffer size (default: 1 MB) and the compression option (default: ZLib default). ZLib errors cause exceptions to be thrown.</li>
  <li><code>zstr::istream</code> is a wrapper for a <code>zstr::istreambuf</code> that accesses an <i>external</i> <code>std::streambuf</code>. It can be constructed from an existing <code>std::istream</code> (such as <code>std::cin</code>) or <code>std::streambuf</code>.</li>
  <li><code>zstr::ostream</code> is a wrapper for a <code>zstr::ostreambuf</code> that accesses an <i>external</i> <code>std::streambuf</code>. It can be constructed from an existing <code>std::ostream</code> (such as <code>std::cout</code>) or <code>std::streambuf</code>.</li>
  <li><code>zstr::ifstream</code> is a wrapper for a <code>zstr::istreambuf</code> that accesses an <i>internal</i> <code>std::ifstream</code>. This can be used to open a file and read decompressed data from it.</li>
  <li><code>zstr::ofstream</code> is a wrapper for a <code>zstr::ostreambuf</code> that accesses an <i>internal</i> <code>std::ofstream</code>. This can be used to open a file and write compressed data to it.</li>
</ul>
<p dir="auto">For all stream objects, the <code>badbit</code> of their exception mask is turned on in order to propagate exceptions.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">CMake</h4><a id="user-content-cmake" class="anchor" aria-label="Permalink: CMake" href="#cmake"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">There are three simple ways to add zstr to a CMake project.</p>
<p dir="auto">Method 1. Add zstr as a subdirectory and link to the <code>zstr::zstr</code> target</p>
<div class="highlight highlight-source-cmake notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="add_subdirectory(zstr) # defines INTERFACE target 'zstr::zstr'

add_executable(YourTarget main.cpp)
target_link_libraries(YourTarget PRIVATE zstr::zstr)
# if using cmake &lt; 3.13 you may also need the following line
# target_include_directories(YourTarget PRIVATE ${ZSTR_INCLUDE_DIRS})"><pre><span class="pl-k">add_subdirectory</span>(zstr) <span class="pl-c"># defines INTERFACE target 'zstr::zstr'</span>

<span class="pl-k">add_executable</span>(YourTarget main.cpp)
<span class="pl-k">target_link_libraries</span>(YourTarget <span class="pl-e">PRIVATE</span> zstr::zstr)
<span class="pl-c"># if using cmake &lt; 3.13 you may also need the following line</span>
<span class="pl-c"># target_include_directories(YourTarget PRIVATE ${ZSTR_INCLUDE_DIRS})</span></pre></div>
<p dir="auto">Method 2. Fetch a copy of zstr from an external repository and link to the <code>zstr::zstr</code> target</p>
<p dir="auto"><i>NOTE: The FetchContent functions shown here were introduced in CMake 3.14</i></p>
<div class="highlight highlight-source-cmake notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="include(FetchContent)
FetchContent_Declare(ZStrGitRepo
  GIT_REPOSITORY    &quot;https://github.com/mateidavid/zstr&quot; # can also be a local filesystem path!
  GIT_TAG           &quot;master&quot;
)
FetchContent_MakeAvailable(ZStrGitRepo) # defines INTERFACE target 'zstr::zstr'

add_executable(YourTarget main.cpp)
target_link_libraries(YourTarget PRIVATE zstr::zstr)"><pre><span class="pl-k">include</span>(FetchContent)
FetchContent_Declare(ZStrGitRepo
  GIT_REPOSITORY    <span class="pl-s">"https://github.com/mateidavid/zstr"</span> <span class="pl-c"># can also be a local filesystem path!</span>
  GIT_TAG           <span class="pl-s">"master"</span>
)
FetchContent_MakeAvailable(ZStrGitRepo) <span class="pl-c"># defines INTERFACE target 'zstr::zstr'</span>

<span class="pl-k">add_executable</span>(YourTarget main.cpp)
<span class="pl-k">target_link_libraries</span>(YourTarget <span class="pl-e">PRIVATE</span> zstr::zstr)</pre></div>
<p dir="auto">Method 3. Add path containing ‘zstr.hpp’ to your target’s include directories</p>
<p dir="auto"><i>NOTE: With this method you’re responsible for finding and linking to ZLIB !</i></p>
<div class="highlight highlight-source-cmake notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="find_package(ZLIB REQUIRED)
add_executable(YourTarget main.cpp)
target_link_libraries(YourTarget PRIVATE ZLIB::ZLIB)
target_include_directories(YourTarget PRIVATE /path/to/zstr/src)"><pre><span class="pl-k">find_package</span>(ZLIB REQUIRED)
<span class="pl-k">add_executable</span>(YourTarget main.cpp)
<span class="pl-k">target_link_libraries</span>(YourTarget <span class="pl-e">PRIVATE</span> ZLIB::ZLIB)
<span class="pl-k">target_include_directories</span>(YourTarget <span class="pl-e">PRIVATE</span> /<span class="pl-k">path</span>/to/zstr/src)</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Requisites</h4><a id="user-content-requisites" class="anchor" aria-label="Permalink: Requisites" href="#requisites"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you use GCC and want to use the `fs.open()` function, you need to deploy at least GCC version 5.1.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">License</h4><a id="user-content-license" class="anchor" aria-label="Permalink: License" href="#license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Released under the <a href="LICENSE">MIT license</a>.</p>
</article></div>