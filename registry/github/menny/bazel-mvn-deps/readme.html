<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Mabel</h1><a id="user-content-mabel" class="anchor" aria-label="Permalink: Mabel" href="#mabel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://github.com/menny/mabel/releases"><img src="https://camo.githubusercontent.com/0f062351e3f5fac77ab68c24cecf3d82195d40902c4bed07a499e773933f89cc/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f72656c656173652f6d656e6e792f6d6162656c2e737667" alt="Latest release" data-canonical-src="https://img.shields.io/github/release/menny/mabel.svg" style="max-width: 100%;"></a> <a target="_blank" rel="noopener noreferrer" href="https://github.com/menny/mabel/workflows/CI/badge.svg?event=push&amp;branch=master"><img src="https://github.com/menny/mabel/workflows/CI/badge.svg?event=push&amp;branch=master" alt="" style="max-width: 100%;"></a> <a href="https://codecov.io/gh/menny/mabel" rel="nofollow"><img src="https://camo.githubusercontent.com/ed5bbda6d7a1a0e0845d8ce403d7353c1daa6091ccb0f661403aa5166345bb4b/68747470733a2f2f636f6465636f762e696f2f67682f6d656e6e792f6d6162656c2f6272616e63682f6d61737465722f67726170682f62616467652e737667" alt="codecov" data-canonical-src="https://codecov.io/gh/menny/mabel/branch/master/graph/badge.svg" style="max-width: 100%;"></a></p>
<p dir="auto">Yet another Maven dependency graph generator for Bazel.</p>
<p dir="auto">Mabel provides the <code>mabel_rule</code> rule and <code>artifact</code> macro, which automatically generate a set of targets that can be used as dependencies based on a given list of Maven coordinates. The rule outputs the dependency graph to a lockfile (similar to Yarn's lock file or npm's package-lock.json).</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Features</h2><a id="user-content-features" class="anchor" aria-label="Permalink: Features" href="#features"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Transitively resolves all dependencies from a given list of Maven dependencies and manages version conflicts, ensuring that only one version of each artifact is available in the dependency graph.</li>
<li>Generates repository rules for all remote artifacts.</li>
<li>Generates required Java rules with transitive dependencies.</li>
<li>Allows marking dependencies as <code>test_only</code>.</li>
<li>Automatically detects which rule type to create for a given dependency:
<ul dir="auto">
<li><code>aar_import</code> for Android artifacts.</li>
<li><code>java_plugin</code> + <code>java_library</code> for annotation processors. More about this <a href="#annotation-processors">here</a>.</li>
<li><a href="rules/jvm_import/jvm_import.bzl"><code>jvm_import</code></a> for anything else.</li>
</ul>
</li>
<li>Allows implementation replacement for <code>jvm_import</code> and <code>aar_import</code>. These can be replaced with another rule or macro.</li>
<li>Supports custom Maven repository URLs and locking dependencies to a specific Maven repository.</li>
<li>Adds <code>licenses</code> data to <code>jvm_import</code> rules if a license is declared in the artifact's POM file. Also adds license metadata to the targets' <code>tags</code> attribute:
<ul dir="auto">
<li><code>mabel_license_name</code> - The name of the license as it appears in the <code>pom.xml</code> file.</li>
<li><code>mabel_license_url</code> - The URL to the license file as it appears in the <code>pom.xml</code> file.</li>
<li><code>mabel_license_detected_type</code> - The type of license (<code>Apache</code>, <code>MIT</code>, <code>GPL</code>, etc.) as detected by Mabel.</li>
</ul>
</li>
<li>Adds <code>srcjar</code> if sources are available in the Maven repository.</li>
<li>Handles POM options:
<ul dir="auto">
<li>Profiles and placeholders.</li>
<li>Version specifications.</li>
<li>Dependencies that do not have a POM.</li>
<li>Exports the Maven coordinate as a tag in the <code>jvm_import</code> rule. This can help with Bazel's <a href="https://github.com/google/bazel-common/blob/master/tools/maven/pom_file.bzl">pom_file</a> rule.</li>
</ul>
</li>
<li>Calculates <code>sha256</code> for each remote artifact.</li>
<li>Produces a lockfile that describes the dependency graph. This file should be checked into your repository.</li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Why</h2><a id="user-content-why" class="anchor" aria-label="Permalink: Why" href="#why"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Unlike other build systems, Bazel does not provide a dependency management service as part of the build and does not provide a way to specify a Maven dependency (which will be resolved transitively) and be available during compilation.</p>
<p dir="auto">There are several attempts to solve this problem (such as <a href="https://github.com/spotify/bazel-tools/tree/master/sync-deps">sync-deps</a>, <a href="https://github.com/bazelbuild/gmaven_rules">gmaven</a>, <a href="https://github.com/bazelbuild/rules_jvm_external">rules_jvm_external</a>, <a href="https://github.com/bazelbuild/migration-tooling">migration-tooling</a>, <a href="https://github.com/jin/rules_maven">maven-rules</a>, and <a href="https://github.com/johnynek/bazel-deps">bazel-deps</a>), but some do not support Kotlin or Android, and some do not support customized Maven repositories.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Usage</h2><a id="user-content-usage" class="anchor" aria-label="Permalink: Usage" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Mabel uses a two-phase approach for dependency management:</p>
<ol dir="auto">
<li><strong>Phase 1: Lockfile Generation</strong> - Run the <code>mabel_rule</code> target to resolve dependencies and generate a JSON lockfile</li>
<li><strong>Phase 2: Module Extension</strong> - Configure the <code>maven</code> extension to read the lockfile and create repository rules</li>
</ol>
<p dir="auto">This approach ensures reproducible builds and allows you to review dependency changes before committing them.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Step 1: Add Mabel to your MODULE.bazel</h4><a id="user-content-step-1-add-mabel-to-your-modulebazel" class="anchor" aria-label="Permalink: Step 1: Add Mabel to your MODULE.bazel" href="#step-1-add-mabel-to-your-modulebazel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Add <code>mabel</code> as dependencies:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel_dep(name = &quot;mabel&quot;, version = &quot;0.31.0&quot;)  # Check latest release"><pre><span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"mabel"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"0.31.0"</span>)  <span class="pl-c"># Check latest release</span></pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Step 2: Define Dependencies in BUILD.bazel</h4><a id="user-content-step-2-define-dependencies-in-buildbazel" class="anchor" aria-label="Permalink: Step 2: Define Dependencies in BUILD.bazel" href="#step-2-define-dependencies-in-buildbazel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In your module's <code>BUILD.bazel</code> file (e.g., <code>//third_party:BUILD.bazel</code>), load the <code>mabel_rule</code> and <code>artifact</code> symbols, and define a <code>mabel_rule</code> target with the list of your dependencies:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@mabel//rules:mabel.bzl&quot;, &quot;mabel_rule&quot;, &quot;artifact&quot;)

mabel_rule(
    name = &quot;maven_deps&quot;,
    lockfile_path = &quot;third_party/maven_install.json&quot;,
    maven_deps = [
        artifact(&quot;com.google.guava:guava:33.0.0-jre&quot;),
        artifact(&quot;org.apache.commons:commons-lang3:3.14.0&quot;),
        artifact(&quot;com.google.code.findbugs:jsr305:3.0.2&quot;),
    ],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@mabel//rules:mabel.bzl"</span>, <span class="pl-s">"mabel_rule"</span>, <span class="pl-s">"artifact"</span>)

<span class="pl-en">mabel_rule</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"maven_deps"</span>,
    <span class="pl-s1">lockfile_path</span> <span class="pl-c1">=</span> <span class="pl-s">"third_party/maven_install.json"</span>,
    <span class="pl-s1">maven_deps</span> <span class="pl-c1">=</span> [
        <span class="pl-en">artifact</span>(<span class="pl-s">"com.google.guava:guava:33.0.0-jre"</span>),
        <span class="pl-en">artifact</span>(<span class="pl-s">"org.apache.commons:commons-lang3:3.14.0"</span>),
        <span class="pl-en">artifact</span>(<span class="pl-s">"com.google.code.findbugs:jsr305:3.0.2"</span>),
    ],
)</pre></div>
<p dir="auto"><strong>Attributes:</strong></p>
<ul dir="auto">
<li>
<p dir="auto"><code>name</code> - A unique name for this target.</p>
</li>
<li>
<p dir="auto"><code>lockfile_path</code> - Path to the output JSON lockfile (relative to workspace root). This file will be created/updated when you run the target.</p>
</li>
<li>
<p dir="auto"><code>maven_deps</code> - List of <code>artifact()</code> macro invocations representing Maven coordinates to resolve.</p>
</li>
<li>
<p dir="auto"><code>version_conflict_resolver</code> - (Optional) Default <code>latest_version</code>. Strategy for resolving version conflicts. Can be <code>latest_version</code> or <code>breadth_first</code>.</p>
</li>
<li>
<p dir="auto"><code>calculate_sha</code> - (Optional) Default <code>True</code>. Calculates the <code>sha256</code> value of each remote artifact.</p>
</li>
<li>
<p dir="auto"><code>fetch_srcjar</code> - (Optional) Default <code>False</code>. Also tries to fetch sources jar for each dependency.</p>
</li>
</ul>
<p dir="auto">The <code>artifact()</code> macro accepts:</p>
<ul dir="auto">
<li><code>coordinate</code> - Maven coordinate in the form <code>group-id:artifact-id:version</code> (e.g., <code>"com.google.guava:guava:33.0.0-jre"</code>).</li>
<li><code>type</code> - (Optional) Target type to create. Default is <code>inherit</code>. Can be <code>jar</code>, <code>aar</code>, <code>naive</code>, <code>processor</code>, <code>inherit</code>, or <code>auto</code>.</li>
<li><code>test_only</code> - (Optional) Marks this dependency as test-only.</li>
<li><code>maven_exclude_deps</code> - (Optional) List of Maven dependencies to exclude from resolution.</li>
<li><code>repositories</code> - (Optional) List of URLs pointing to Maven servers. Defaults to Maven Central.</li>
<li><code>exports_generation_type</code> - (Optional) Default <code>inherit</code>. Override exports generation for this artifact. Can be <code>inherit</code>, <code>all</code>, <code>requested_deps</code>, <code>none</code>.</li>
<li><code>debug_logs</code> - (Optional) Default <code>False</code>. Prints debug logs for this artifact.</li>
</ul>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Step 3: Generate the Lockfile</h4><a id="user-content-step-3-generate-the-lockfile" class="anchor" aria-label="Permalink: Step 3: Generate the Lockfile" href="#step-3-generate-the-lockfile"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Run the <code>mabel_rule</code> target to resolve all transitive dependencies and generate the lockfile:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel run //third_party:maven_deps"><pre>bazel run //third_party:maven_deps</pre></div>
<p dir="auto">This will:</p>
<ol dir="auto">
<li>Resolve all transitive dependencies from the specified Maven coordinates</li>
<li>Apply version conflict resolution (using the configured strategy)</li>
<li>Download and calculate SHA256 hashes for all artifacts</li>
<li>Generate <code>third_party/maven_install.json</code> containing all resolved dependency metadata</li>
</ol>
<p dir="auto">The lockfile is a JSON file with the following structure:</p>
<div class="highlight highlight-source-json notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="{
  &quot;version&quot;: &quot;1.0&quot;,
  &quot;artifacts&quot;: {
    &quot;com.google.guava:guava:33.0.0-jre&quot;: {
      &quot;repo_name&quot;: &quot;com_google_guava__guava__33_0_0_jre&quot;,
      &quot;url&quot;: &quot;https://repo1.maven.org/maven2/...&quot;,
      &quot;sha256&quot;: &quot;...&quot;,
      &quot;dependencies&quot;: [&quot;com_google_code_findbugs__jsr305__3_0_2&quot;, ...],
      &quot;exports&quot;: [...],
      &quot;runtime_deps&quot;: [...],
      &quot;test_only&quot;: false,
      &quot;target_type&quot;: &quot;jar&quot;,
      &quot;licenses&quot;: [...]
    }
  }
}"><pre>{
  <span class="pl-ent">"version"</span>: <span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span>,
  <span class="pl-ent">"artifacts"</span>: {
    <span class="pl-ent">"com.google.guava:guava:33.0.0-jre"</span>: {
      <span class="pl-ent">"repo_name"</span>: <span class="pl-s"><span class="pl-pds">"</span>com_google_guava__guava__33_0_0_jre<span class="pl-pds">"</span></span>,
      <span class="pl-ent">"url"</span>: <span class="pl-s"><span class="pl-pds">"</span>https://repo1.maven.org/maven2/...<span class="pl-pds">"</span></span>,
      <span class="pl-ent">"sha256"</span>: <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>,
      <span class="pl-ent">"dependencies"</span>: [<span class="pl-s"><span class="pl-pds">"</span>com_google_code_findbugs__jsr305__3_0_2<span class="pl-pds">"</span></span>, <span class="pl-ii">...</span>],
      <span class="pl-ent">"exports"</span>: [<span class="pl-ii">...</span>],
      <span class="pl-ent">"runtime_deps"</span>: [<span class="pl-ii">...</span>],
      <span class="pl-ent">"test_only"</span>: <span class="pl-c1">false</span>,
      <span class="pl-ent">"target_type"</span>: <span class="pl-s"><span class="pl-pds">"</span>jar<span class="pl-pds">"</span></span>,
      <span class="pl-ent">"licenses"</span>: [<span class="pl-ii">...</span>]
    }
  }
}</pre></div>
<p dir="auto"><strong>Important:</strong> Commit this lockfile to your version control system. It should be treated like <code>package-lock.json</code> in npm or <code>Cargo.lock</code> in Rust.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Step 4: Configure the Module Extension</h4><a id="user-content-step-4-configure-the-module-extension" class="anchor" aria-label="Permalink: Step 4: Configure the Module Extension" href="#step-4-configure-the-module-extension"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In your <code>MODULE.bazel</code>, configure the <code>mabel</code> extension to read the lockfile:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="mabel = use_extension(&quot;@mabel//rules:extensions.bzl&quot;, &quot;mabel&quot;)
mabel.install(
    lockfile = &quot;//third_party:maven_install.json&quot;,
    aliases_repo = &quot;maven&quot;,
)

# Import the maven alias repository for convenient access
use_repo(mabel, &quot;maven&quot;)

# Optionally (but discouraged) import specific versioned repositories if needed
use_repo(mabel,
    &quot;com_google_guava__guava__33_0_0_jre&quot;,
    &quot;org_apache_commons__commons_lang3__3_14_0&quot;,
    &quot;com_google_code_findbugs__jsr305__3_0_2&quot;,
)"><pre><span class="pl-s1">mabel</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(<span class="pl-s">"@mabel//rules:extensions.bzl"</span>, <span class="pl-s">"mabel"</span>)
<span class="pl-s1">mabel</span>.<span class="pl-c1">install</span>(
    <span class="pl-s1">lockfile</span> <span class="pl-c1">=</span> <span class="pl-s">"//third_party:maven_install.json"</span>,
    <span class="pl-s1">aliases_repo</span> <span class="pl-c1">=</span> <span class="pl-s">"maven"</span>,
)

<span class="pl-c"># Import the maven alias repository for convenient access</span>
<span class="pl-en">use_repo</span>(<span class="pl-s1">mabel</span>, <span class="pl-s">"maven"</span>)

<span class="pl-c"># Optionally (but discouraged) import specific versioned repositories if needed</span>
<span class="pl-en">use_repo</span>(<span class="pl-s1">mabel</span>,
    <span class="pl-s">"com_google_guava__guava__33_0_0_jre"</span>,
    <span class="pl-s">"org_apache_commons__commons_lang3__3_14_0"</span>,
    <span class="pl-s">"com_google_code_findbugs__jsr305__3_0_2"</span>,
)</pre></div>
<p dir="auto">The <code>mabel.install()</code> tag accepts:</p>
<ul dir="auto">
<li><code>lockfile</code> - Label pointing to the JSON lockfile generated in Step 3.</li>
<li><code>aliases_repo</code> - Name of the alias repository to create (e.g., <code>"maven"</code>). This repository provides clean, version-free paths to your dependencies.</li>
</ul>
<p dir="auto">The <code>use_repo()</code> call imports the repository rules created by the extension. The <code>"maven"</code> repository is an alias repository that provides convenient access to all dependencies. Repository names follow the <code>{group_id}__{artifact_id}__{version}</code> pattern, where dots, hyphens, and other special characters are replaced with underscores.</p>
<p dir="auto"><strong>How to find repository names:</strong></p>
<p dir="auto">You can find the exact repository names in the lockfile under the <code>repo_name</code> field for each artifact, or use this command:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="cat third_party/maven_install.json | grep -o '&quot;repo_name&quot;: &quot;[^&quot;]*&quot;' | cut -d'&quot;' -f4 | sort"><pre>cat third_party/maven_install.json <span class="pl-k">|</span> grep -o <span class="pl-s"><span class="pl-pds">'</span>"repo_name": "[^"]*"<span class="pl-pds">'</span></span> <span class="pl-k">|</span> cut -d<span class="pl-s"><span class="pl-pds">'</span>"<span class="pl-pds">'</span></span> -f4 <span class="pl-k">|</span> sort</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Step 5: Use in Your Targets</h4><a id="user-content-step-5-use-in-your-targets" class="anchor" aria-label="Permalink: Step 5: Use in Your Targets" href="#step-5-use-in-your-targets"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Reference the dependencies in your Bazel targets using the <code>@maven</code> alias repository:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="java_library(
    name = &quot;mylib&quot;,
    srcs = [&quot;MyLib.java&quot;],
    deps = [
        &quot;@maven//com/google/guava/guava&quot;,
        &quot;@maven//org/apache/commons/commons-lang3&quot;,
    ],
)"><pre><span class="pl-en">java_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"mylib"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"MyLib.java"</span>],
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"@maven//com/google/guava/guava"</span>,
        <span class="pl-s">"@maven//org/apache/commons/commons-lang3"</span>,
    ],
)</pre></div>
<p dir="auto">The <code>@maven</code> repository provides clean, version-free paths to your dependencies using the pattern <code>@maven//group/id/artifact-id</code>.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Updating Dependencies</h4><a id="user-content-updating-dependencies" class="anchor" aria-label="Permalink: Updating Dependencies" href="#updating-dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">When you need to update dependencies:</p>
<ol dir="auto">
<li>Modify the <code>maven_deps</code> list in your <code>mabel_rule</code> (add, remove, or change versions)</li>
<li>Run <code>bazel run //third_party:maven_deps</code> to regenerate the lockfile</li>
<li>Review the changes to <code>maven_install.json</code> (use <code>git diff</code>)</li>
<li>Update the <code>use_repo()</code> call in <code>MODULE.bazel</code> if you added or removed dependencies</li>
<li>Commit the updated lockfile</li>
</ol>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Working with Multiple Dependency Sets</h4><a id="user-content-working-with-multiple-dependency-sets" class="anchor" aria-label="Permalink: Working with Multiple Dependency Sets" href="#working-with-multiple-dependency-sets"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You can define multiple <code>mabel_rule</code> targets for different dependency sets (e.g., separate sets for main code, tests, or different modules):</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="mabel_rule(
    name = &quot;main_deps&quot;,
    lockfile_path = &quot;third_party/main_install.json&quot;,
    maven_deps = [
        artifact(&quot;com.google.guava:guava:33.0.0-jre&quot;),
    ],
)

mabel_rule(
    name = &quot;test_deps&quot;,
    lockfile_path = &quot;third_party/test_install.json&quot;,
    maven_deps = [
        artifact(&quot;junit:junit:4.13.2&quot;, test_only = True),
        artifact(&quot;org.mockito:mockito-core:5.0.0&quot;, test_only = True),
    ],
)"><pre><span class="pl-en">mabel_rule</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"main_deps"</span>,
    <span class="pl-s1">lockfile_path</span> <span class="pl-c1">=</span> <span class="pl-s">"third_party/main_install.json"</span>,
    <span class="pl-s1">maven_deps</span> <span class="pl-c1">=</span> [
        <span class="pl-en">artifact</span>(<span class="pl-s">"com.google.guava:guava:33.0.0-jre"</span>),
    ],
)

<span class="pl-en">mabel_rule</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"test_deps"</span>,
    <span class="pl-s1">lockfile_path</span> <span class="pl-c1">=</span> <span class="pl-s">"third_party/test_install.json"</span>,
    <span class="pl-s1">maven_deps</span> <span class="pl-c1">=</span> [
        <span class="pl-en">artifact</span>(<span class="pl-s">"junit:junit:4.13.2"</span>, <span class="pl-s1">test_only</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>),
        <span class="pl-en">artifact</span>(<span class="pl-s">"org.mockito:mockito-core:5.0.0"</span>, <span class="pl-s1">test_only</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>),
    ],
)</pre></div>
<p dir="auto">Then configure multiple lockfiles in <code>MODULE.bazel</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="mabel = use_extension(&quot;@mabel//rules:extensions.bzl&quot;, &quot;mabel&quot;)
mabel.install(
    lockfile = &quot;//third_party:main_install.json&quot;,
    aliases_repo = &quot;maven&quot;,
)
mabel.install(
    lockfile = &quot;//third_party:test_install.json&quot;,
    aliases_repo = &quot;maven_test&quot;,
)
use_repo(mabel,
    &quot;maven&quot;,       # Alias repository for main dependencies
    &quot;maven_test&quot;,  # Alias repository for test dependencies
)"><pre><span class="pl-s1">mabel</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(<span class="pl-s">"@mabel//rules:extensions.bzl"</span>, <span class="pl-s">"mabel"</span>)
<span class="pl-s1">mabel</span>.<span class="pl-c1">install</span>(
    <span class="pl-s1">lockfile</span> <span class="pl-c1">=</span> <span class="pl-s">"//third_party:main_install.json"</span>,
    <span class="pl-s1">aliases_repo</span> <span class="pl-c1">=</span> <span class="pl-s">"maven"</span>,
)
<span class="pl-s1">mabel</span>.<span class="pl-c1">install</span>(
    <span class="pl-s1">lockfile</span> <span class="pl-c1">=</span> <span class="pl-s">"//third_party:test_install.json"</span>,
    <span class="pl-s1">aliases_repo</span> <span class="pl-c1">=</span> <span class="pl-s">"maven_test"</span>,
)
<span class="pl-en">use_repo</span>(<span class="pl-s1">mabel</span>,
    <span class="pl-s">"maven"</span>,       <span class="pl-c"># Alias repository for main dependencies</span>
    <span class="pl-s">"maven_test"</span>,  <span class="pl-c"># Alias repository for test dependencies</span>
)</pre></div>
<p dir="auto">Each <code>mabel.install()</code> creates its own alias repository, allowing you to organize dependencies by category. You can use <code>@maven//...</code> for main dependencies and <code>@maven_test//...</code> for test dependencies.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Maven Alias Repository</h2><a id="user-content-maven-alias-repository" class="anchor" aria-label="Permalink: Maven Alias Repository" href="#maven-alias-repository"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>@maven</code> alias repository provides a convenient way to reference Maven artifacts without needing to specify versions in your BUILD files.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Benefits</h3><a id="user-content-benefits" class="anchor" aria-label="Permalink: Benefits" href="#benefits"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><strong>Clean syntax</strong>: <code>@maven//com/google/guava/guava</code> instead of <code>@com_google_guava__guava__33_0_0_jre//:jar</code></li>
<li><strong>Version agnostic</strong>: Update versions in one place (the lockfile) without changing BUILD files</li>
<li><strong>Consistent with Maven conventions</strong>: Uses groupId/artifactId path structure</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">How it works</h3><a id="user-content-how-it-works" class="anchor" aria-label="Permalink: How it works" href="#how-it-works"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The extension automatically creates the <code>@maven</code> repository that contains alias targets for all dependencies in your lockfiles. Each alias points to the actual versioned repository.</p>
<p dir="auto">For example, for <code>com.google.guava:guava:33.0.0-jre</code>, the extension creates:</p>
<ul dir="auto">
<li>A versioned repository: <code>@com_google_guava__guava__33_0_0_jre</code> &lt;- do not use that</li>
<li>An alias at: <code>@maven//com/google/guava/guava</code> -&gt; points to <code>@com_google_guava__guava__33_0_0_jre//:jar</code></li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Path structure</h3><a id="user-content-path-structure" class="anchor" aria-label="Permalink: Path structure" href="#path-structure"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The alias repository follows Maven's groupId/artifactId structure:</p>
<ul dir="auto">
<li><strong>groupId</strong>: Dots become slashes (e.g., <code>com.google.guava</code> → <code>com/google/guava</code>)</li>
<li><strong>artifactId</strong>: Used as-is (e.g., <code>guava</code> → <code>guava</code>)</li>
</ul>
<p dir="auto">Examples:</p>
<ul dir="auto">
<li><code>com.google.guava:guava</code> → <code>@maven//com/google/guava/guava</code></li>
<li><code>org.apache.commons:commons-lang3</code> → <code>@maven//org/apache/commons/commons-lang3</code></li>
<li><code>com.squareup.okhttp3:okhttp</code> → <code>@maven//com/squareup/okhttp3/okhttp</code></li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Rule Configuration</h2><a id="user-content-rule-configuration" class="anchor" aria-label="Permalink: Rule Configuration" href="#rule-configuration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code>mabel_rule</code></h3><a id="user-content-mabel_rule" class="anchor" aria-label="Permalink: mabel_rule" href="#mabel_rule"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This rule merges the dependencies into one version-conflict-resolved dependency graph, ensuring you do not have conflicting versions of an artifact in your classpath.</p>
<p dir="auto"><strong>Attributes:</strong></p>
<ul dir="auto">
<li><code>maven_deps</code> - List of <code>artifact</code> targets representing Maven coordinates.</li>
<li><code>lockfile_path</code> - Path to output JSON lockfile. This file will be generated and used by the module extension to create repository rules.</li>
<li><code>artifacts_path</code> - (Optional) Cache location to download artifacts into. Empty means <code>[user-home-folder]/.mabel/artifacts/</code>.</li>
<li><code>calculate_sha</code> - Default <code>True</code>. Calculates the <code>sha256</code> value of each remote artifact.</li>
<li><code>debug_logs</code> - Default <code>False</code>. If set to <code>True</code>, prints debug logs while resolving dependencies.</li>
<li><code>default_exports_generation</code> - Default <code>requested_deps</code>. Specifies for which targets the <code>exports</code> attribute should be generated. Can be: <code>all</code>, <code>requested_deps</code>, <code>none</code>.</li>
<li><code>default_target_type</code> - Default <code>auto</code>. The type of artifact targets to generate. Can be: <code>jar</code>, <code>aar</code>, <code>naive</code>, <code>processor</code>, <code>auto</code>.</li>
<li><code>fetch_srcjar</code> - Default <code>False</code>. Also attempts to fetch the source jar for each dependency.</li>
<li><code>generated_targets_prefix</code> - A prefix to add to all generated targets. Default is empty (no prefix). This is useful if you want to generate several unrelated graphs.</li>
<li><code>mabel_repository_rule_name</code> - Default <code>mabel</code>. The name of the mabel remote repository.</li>
<li><code>output_graph_to_file</code> - Default <code>False</code>. If set to <code>True</code>, outputs the graph to <code>dependencies.txt</code>.</li>
<li><code>public_targets_category</code> - Default <code>all</code>. Sets public visibility of resolved targets. Can be: <code>requested_deps</code>, <code>recursive_exports</code>, <code>all</code>.</li>
<li><code>version_conflict_resolver</code> - Default <code>latest_version</code>. Defines the strategy used to resolve version conflicts. Can be: <code>latest_version</code>, <code>breadth_first</code>.</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code>artifact</code></h3><a id="user-content-artifact" class="anchor" aria-label="Permalink: artifact" href="#artifact"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This macro declares a Maven dependency to be resolved and imported into your workspace.</p>
<p dir="auto"><strong>Attributes:</strong></p>
<ul dir="auto">
<li><code>coordinate</code> - Maven coordinate in the form <code>group-id:artifact-id:version</code>.</li>
<li><code>type</code> - The type of target(s) to create for this artifact. Default is <code>inherit</code>. Can be <code>jar</code>, <code>aar</code>, <code>naive</code>, <code>processor</code>, <code>inherit</code> or <code>auto</code>. For more details, see <a href="resolver/src/main/java/net/evendanan/bazel/mvn/api/model/TargetType.java">TargetType.java</a>.</li>
<li><code>test_only</code> - Marks this dependency to be used in tests only.</li>
<li><code>maven_exclude_deps</code> - List of Maven dependencies that should not be resolved. You can omit the <code>version</code> or both <code>artifact-id:version</code>.</li>
<li><code>repositories</code> - List of URLs that point to Maven servers. The default list includes Maven Central.</li>
<li><code>exports_generation_type</code> - Default <code>inherit</code>. Overrides exports generation for this artifact. Can be <code>inherit</code>, <code>all</code>, <code>requested_deps</code>, <code>none</code>.</li>
<li><code>debug_logs</code> - Default <code>False</code>. Prints debug logs for this artifact.</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Real Examples</h3><a id="user-content-real-examples" class="anchor" aria-label="Permalink: Real Examples" href="#real-examples"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You can find several examples under the <code>examples/</code> folder in this repository. These examples are built as part of the CI process, so they represent working use cases.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Detected Rules</h2><a id="user-content-detected-rules" class="anchor" aria-label="Permalink: Detected Rules" href="#detected-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Android AARs</h3><a id="user-content-android-aars" class="anchor" aria-label="Permalink: Android AARs" href="#android-aars"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If the resolved artifact is an <code>aar</code> file, Mabel will create an <code>aar_import</code> target.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Annotation Processors</h3><a id="user-content-annotation-processors" class="anchor" aria-label="Permalink: Annotation Processors" href="#annotation-processors"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">For dependencies detected as annotation processors, Mabel creates a <a href="https://docs.bazel.build/versions/master/be/java.html#java_plugin" rel="nofollow"><code>java_plugin</code></a> rule for each detected <a href="https://docs.bazel.build/versions/master/be/java.html#java_plugin.processor_class" rel="nofollow"><code>processor_class</code></a>, and then wraps all of these rules in a <code>java_library</code> rule that <a href="https://docs.bazel.build/versions/master/be/java.html#java_library.exported_plugins" rel="nofollow">exports</a> the plugins.</p>
<p dir="auto">For example, if you include <code>com.google.auto.value:auto-value:1.6.3</code>, which is a Java annotation processor, Mabel creates the following rules:</p>
<ul dir="auto">
<li><code>//resolver:main_deps___com_google_auto_value__auto_value</code> - A <code>java_library</code> without annotation-processing capabilities.</li>
<li><code>//resolver:main_deps___com_google_auto_value__auto_value___processor_class_0</code>..4 - A <code>java_plugin</code> with annotation-processing capabilities using each detected processor class. There are four of these because there are four processor classes.</li>
<li><code>//resolver:main_deps___com_google_auto_value__auto_value___generates_api___processor_class_0</code>..4 - The same as above, but with <a href="https://docs.bazel.build/versions/master/be/java.html#java_plugin.generates_api" rel="nofollow"><code>generates_api</code></a> enabled.</li>
<li><code>//resolver:main_deps___com_google_auto_value__auto_value___processor_class_all</code> - A <code>java_library</code> that groups all processors that do not generate API.</li>
<li><code>//resolver:main_deps___com_google_auto_value__auto_value___generates_api___processor_class_all</code> - Same as above, but generates API.</li>
</ul>
<p dir="auto">Please read the <a href="https://docs.bazel.build/versions/master/be/java.html#java_plugin.generates_api" rel="nofollow">Bazel docs</a> about which variant you want.</p>
<p dir="auto">Since Mabel wraps the <code>java_plugin</code> rules in <code>java_library</code> rules, you should add them to the <code>deps</code> list of your rule and not to the <code>plugins</code> list, unless you're directly using the <code>X___processor_class_Y</code> variant, in which case you should use it in the <code>plugins</code> field.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Troubleshooting</h2><a id="user-content-troubleshooting" class="anchor" aria-label="Permalink: Troubleshooting" href="#troubleshooting"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Repository names not found</h3><a id="user-content-repository-names-not-found" class="anchor" aria-label="Permalink: Repository names not found" href="#repository-names-not-found"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you get errors about missing repositories, make sure all repository names are listed in the <code>use_repo()</code> call. You can extract all repository names from the lockfile:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="cat third_party/maven_install.json | grep -o '&quot;repo_name&quot;: &quot;[^&quot;]*&quot;' | cut -d'&quot;' -f4 | sort"><pre>cat third_party/maven_install.json <span class="pl-k">|</span> grep -o <span class="pl-s"><span class="pl-pds">'</span>"repo_name": "[^"]*"<span class="pl-pds">'</span></span> <span class="pl-k">|</span> cut -d<span class="pl-s"><span class="pl-pds">'</span>"<span class="pl-pds">'</span></span> -f4 <span class="pl-k">|</span> sort</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Version conflicts</h3><a id="user-content-version-conflicts" class="anchor" aria-label="Permalink: Version conflicts" href="#version-conflicts"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Mabel resolves version conflicts using the configured strategy (<code>latest_version</code> by default). If you encounter issues:</p>
<ol dir="auto">
<li>Check the generated lockfile to see which versions were selected</li>
<li>Try the alternative <code>breadth_first</code> resolver strategy</li>
<li>Use <code>maven_exclude_deps</code> to explicitly exclude problematic transitive dependencies</li>
</ol>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Lockfile changes unexpectedly</h3><a id="user-content-lockfile-changes-unexpectedly" class="anchor" aria-label="Permalink: Lockfile changes unexpectedly" href="#lockfile-changes-unexpectedly"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If the lockfile changes when you haven't modified dependencies:</p>
<ol dir="auto">
<li>Maven metadata might have been updated (for SNAPSHOT versions)</li>
<li>A transitive dependency might have changed</li>
<li>Use <code>calculate_sha = True</code> (default) to ensure reproducible builds</li>
</ol>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Build errors after updating dependencies</h3><a id="user-content-build-errors-after-updating-dependencies" class="anchor" aria-label="Permalink: Build errors after updating dependencies" href="#build-errors-after-updating-dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">After running <code>bazel run //third_party:maven_deps</code>:</p>
<ol dir="auto">
<li>Review the <code>git diff</code> of the lockfile to understand what changed</li>
<li>Update the <code>use_repo()</code> call in MODULE.bazel if repository names changed</li>
<li>Run <code>bazel clean --expunge</code> if you encounter caching issues</li>
</ol>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Contributing</h2><a id="user-content-contributing" class="anchor" aria-label="Permalink: Contributing" href="#contributing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Contributions are welcome! Please see the <a href="CONTRIBUTING.md">CONTRIBUTING.md</a> file for guidelines.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">License</h2><a id="user-content-license" class="anchor" aria-label="Permalink: License" href="#license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Apache License 2.0. See <a href="LICENSE">LICENSE</a> file for details.</p>
</article></div>