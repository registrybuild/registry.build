<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto"><code>rules_grafana</code> for Bazel</h1><a id="user-content-rules_grafana-for-bazel" class="anchor" aria-label="Permalink: rules_grafana for Bazel" href="#rules_grafana-for-bazel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Dashboards as code, the <a href="https://bazel.build/" rel="nofollow">Bazel</a> way.
Write Grafana dashboards with Python
and build them into a reusable Docker image.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Try it out</h2><a id="user-content-try-it-out" class="anchor" aria-label="Permalink: Try it out" href="#try-it-out"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Build and load the Docker image
bazel run //example:grafana_load

# Run the container
docker run --rm -p 3000:3000 rules_grafana/example:latest

# Open Grafana in your browser
open http://localhost:3000"><pre><span class="pl-c"><span class="pl-c">#</span> Build and load the Docker image</span>
bazel run //example:grafana_load

<span class="pl-c"><span class="pl-c">#</span> Run the container</span>
docker run --rm -p 3000:3000 rules_grafana/example:latest

<span class="pl-c"><span class="pl-c">#</span> Open Grafana in your browser</span>
open http://localhost:3000</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Installation</h2><a id="user-content-installation" class="anchor" aria-label="Permalink: Installation" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">From Bazel Central Registry (recommended)</h3><a id="user-content-from-bazel-central-registry-recommended" class="anchor" aria-label="Permalink: From Bazel Central Registry (recommended)" href="#from-bazel-central-registry-recommended"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Add to your <code>MODULE.bazel</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel_dep(name = &quot;rules_grafana&quot;, version = &quot;2.0.0&quot;)

# For plugins and container setup
grafana = use_extension(&quot;@rules_grafana//grafana:extensions.bzl&quot;, &quot;grafana&quot;)
use_repo(grafana, &quot;grafana_oci&quot;)

# Optional: Add plugins
grafana.plugin(
    name = &quot;my_plugin&quot;,
    urls = [&quot;https://grafana.com/api/plugins/my-plugin/versions/1.0.0/download&quot;],
    sha256 = &quot;...&quot;,
    type = &quot;zip&quot;,
)
use_repo(grafana, &quot;my_plugin&quot;)"><pre><span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_grafana"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"2.0.0"</span>)

<span class="pl-c"># For plugins and container setup</span>
<span class="pl-s1">grafana</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(<span class="pl-s">"@rules_grafana//grafana:extensions.bzl"</span>, <span class="pl-s">"grafana"</span>)
<span class="pl-en">use_repo</span>(<span class="pl-s1">grafana</span>, <span class="pl-s">"grafana_oci"</span>)

<span class="pl-c"># Optional: Add plugins</span>
<span class="pl-s1">grafana</span>.<span class="pl-c1">plugin</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_plugin"</span>,
    <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://grafana.com/api/plugins/my-plugin/versions/1.0.0/download"</span>],
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-s">"..."</span>,
    <span class="pl-s1">type</span> <span class="pl-c1">=</span> <span class="pl-s">"zip"</span>,
)
<span class="pl-en">use_repo</span>(<span class="pl-s1">grafana</span>, <span class="pl-s">"my_plugin"</span>)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">From GitHub (before BCR publication)</h3><a id="user-content-from-github-before-bcr-publication" class="anchor" aria-label="Permalink: From GitHub (before BCR publication)" href="#from-github-before-bcr-publication"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel_dep(name = &quot;rules_grafana&quot;, version = &quot;2.0.0&quot;)
git_override(
    module_name = &quot;rules_grafana&quot;,
    remote = &quot;https://github.com/etsy/rules_grafana.git&quot;,
    branch = &quot;main&quot;,
)

# For plugins and container setup
grafana = use_extension(&quot;@rules_grafana//grafana:extensions.bzl&quot;, &quot;grafana&quot;)
use_repo(grafana, &quot;grafana_oci&quot;)"><pre><span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_grafana"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"2.0.0"</span>)
<span class="pl-en">git_override</span>(
    <span class="pl-s1">module_name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_grafana"</span>,
    <span class="pl-s1">remote</span> <span class="pl-c1">=</span> <span class="pl-s">"https://github.com/etsy/rules_grafana.git"</span>,
    <span class="pl-s1">branch</span> <span class="pl-c1">=</span> <span class="pl-s">"main"</span>,
)

<span class="pl-c"># For plugins and container setup</span>
<span class="pl-s1">grafana</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(<span class="pl-s">"@rules_grafana//grafana:extensions.bzl"</span>, <span class="pl-s">"grafana"</span>)
<span class="pl-en">use_repo</span>(<span class="pl-s1">grafana</span>, <span class="pl-s">"grafana_oci"</span>)</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Bazel compatibility</h2><a id="user-content-bazel-compatibility" class="anchor" aria-label="Permalink: Bazel compatibility" href="#bazel-compatibility"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Requires Bazel 8.0.0 or later with bzlmod enabled.</p>
<p dir="auto"><code>rules_grafana</code> depends on <a href="https://github.com/bazelbuild/rules_python"><code>rules_python</code></a> and
<a href="https://github.com/bazel-contrib/rules_oci"><code>rules_oci</code></a>, but these are automatically managed
through Bazel's module system.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Usage</h2><a id="user-content-usage" class="anchor" aria-label="Permalink: Usage" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>rules_grafana</code> makes it easy to build dashboards and incorporate them into your Bazel build,
and to build a complete, runnable Docker image.</p>
<p dir="auto">Dashboards can be either hard-coded JSON files or Python scripts that generate dashboards.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">JSON dashboards</h3><a id="user-content-json-dashboards" class="anchor" aria-label="Permalink: JSON dashboards" href="#json-dashboards"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Use <code>json_dashboards</code> to add JSON files containing dashboards to your build.
The JSON must be a complete, valid Grafana dashboard;
see the <a href="http://docs.grafana.org/reference/dashboard/" rel="nofollow">Grafana docs</a> for details on the JSON format.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_grafana//grafana:grafana.bzl&quot;, &quot;json_dashboards&quot;)

json_dashboards(
    name = &quot;dashboards&quot;,
    srcs = [&quot;awesome_graphs.json&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_grafana//grafana:grafana.bzl"</span>, <span class="pl-s">"json_dashboards"</span>)

<span class="pl-en">json_dashboards</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"dashboards"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"awesome_graphs.json"</span>],
)</pre></div>
<p dir="auto">Unlike using the JSON files directly,
<code>json_dashboards</code> will check the syntax of your files
and ensure that each dashboard has a <code>uid</code> set,
to ensure it has a <a href="http://docs.grafana.org/administration/provisioning/#reuseable-dashboard-urls" rel="nofollow">consistent URL in Grafana</a>.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Python dashboards</h3><a id="user-content-python-dashboards" class="anchor" aria-label="Permalink: Python dashboards" href="#python-dashboards"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Dashboards can also be generated with Python,
using the <a href="https://github.com/weaveworks/grafanalib"><code>grafanalib</code></a> library.
<code>grafanalib</code> is automatically imported,
and you can also add other <code>deps</code> to help build your dashboard.</p>
<p dir="auto">Each Python dashboard file should print the complete JSON of a Grafana dashboard.
An easy way to do that is to follow a template like this:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="from grafanalib.core import *
from grafanalib._gen import print_dashboard

dashboard = Dashboard(
    # Fill in your dashboard!
)

print_dashboard(dashboard.auto_panel_ids()) # `auto_panel_ids()` call is required!"><pre><span class="pl-k">from</span> <span class="pl-s1">grafanalib</span>.<span class="pl-s1">core</span> <span class="pl-k">import</span> <span class="pl-c1">*</span>
<span class="pl-k">from</span> <span class="pl-s1">grafanalib</span>.<span class="pl-s1">_gen</span> <span class="pl-k">import</span> <span class="pl-s1">print_dashboard</span>

<span class="pl-s1">dashboard</span> <span class="pl-c1">=</span> <span class="pl-en">Dashboard</span>(
    <span class="pl-c"># Fill in your dashboard!</span>
)

<span class="pl-en">print_dashboard</span>(<span class="pl-s1">dashboard</span>.<span class="pl-c1">auto_panel_ids</span>()) <span class="pl-c"># `auto_panel_ids()` call is required!</span></pre></div>
<p dir="auto">Use <code>py_dashboards</code> to add Python files that generate dashboards to your build.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_grafana//grafana:grafana.bzl&quot;, &quot;py_dashboards&quot;)

py_dashboards(
    name = &quot;dashboards&quot;,
    srcs = [&quot;amazing_graphs.py&quot;, &quot;even_better_graphs.py&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_grafana//grafana:grafana.bzl"</span>, <span class="pl-s">"py_dashboards"</span>)

<span class="pl-en">py_dashboards</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"dashboards"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"amazing_graphs.py"</span>, <span class="pl-s">"even_better_graphs.py"</span>],
)</pre></div>
<p dir="auto">You can run the Python and see the generated JSON with the <code>FOO_builder</code> target created by <code>py_dashboards</code>,
where <code>FOO</code> is the Python filename without <code>.py</code>.
For example, run <code>bazel run //example:sample_builder</code> in this repository to see the output of <code>sample.py</code>.
The JSON is generated at build time, not at run time, so Python isn't a runtime dependency.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Docker image</h3><a id="user-content-docker-image" class="anchor" aria-label="Permalink: Docker image" href="#docker-image"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Use <code>grafana_image</code> to build your dashboards into a Docker image containing Grafana.
When you run the image, it starts Grafana on port 3000
and serves all of the dashboards you've built,
directly from the container.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_grafana//grafana:image.bzl&quot;, &quot;grafana_image&quot;)
load(&quot;@rules_oci//oci:defs.bzl&quot;, &quot;oci_load&quot;)

grafana_image(
    name = &quot;grafana&quot;,
    dashboards = [&quot;:dashboards&quot;],
    datasources = [&quot;:datasources.yaml&quot;],
)

# To run locally, load the image into Docker:
oci_load(
    name = &quot;grafana_load&quot;,
    image = &quot;:grafana&quot;,
    repo_tags = [&quot;my-grafana:latest&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_grafana//grafana:image.bzl"</span>, <span class="pl-s">"grafana_image"</span>)
<span class="pl-en">load</span>(<span class="pl-s">"@rules_oci//oci:defs.bzl"</span>, <span class="pl-s">"oci_load"</span>)

<span class="pl-en">grafana_image</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"grafana"</span>,
    <span class="pl-s1">dashboards</span> <span class="pl-c1">=</span> [<span class="pl-s">":dashboards"</span>],
    <span class="pl-s1">datasources</span> <span class="pl-c1">=</span> [<span class="pl-s">":datasources.yaml"</span>],
)

<span class="pl-c"># To run locally, load the image into Docker:</span>
<span class="pl-en">oci_load</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"grafana_load"</span>,
    <span class="pl-s1">image</span> <span class="pl-c1">=</span> <span class="pl-s">":grafana"</span>,
    <span class="pl-s1">repo_tags</span> <span class="pl-c1">=</span> [<span class="pl-s">"my-grafana:latest"</span>],
)</pre></div>
<p dir="auto">Then run:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel run //:grafana_load
docker run --rm -p 3000:3000 my-grafana:latest"><pre>bazel run //:grafana_load
docker run --rm -p 3000:3000 my-grafana:latest</pre></div>
<p dir="auto">The dashboards and datasources are added via <a href="http://docs.grafana.org/administration/provisioning/" rel="nofollow">Grafana provisioning</a>,
where the configuration and sources are declared and built into the image,
alongside all the dashboards.
You must provide a <code>datasources.yaml</code> file declaring your datasources;
see the <a href="http://docs.grafana.org/administration/provisioning/#datasources" rel="nofollow">Grafana datasources docs</a> for details of the format.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Plugins</h3><a id="user-content-plugins" class="anchor" aria-label="Permalink: Plugins" href="#plugins"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Grafana plugins can be installed into the image too.
Use the <code>grafana</code> module extension to download plugins:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# In your MODULE.bazel
grafana = use_extension(&quot;@rules_grafana//grafana:extensions.bzl&quot;, &quot;grafana&quot;)
grafana.plugin(
    name = &quot;grafana_plotly_plugin&quot;,
    urls = [&quot;https://grafana.com/api/plugins/natel-plotly-panel/versions/0.0.7/download&quot;],
    sha256 = &quot;818ab33b42a1421b561f4e44f0cd19cd1a56767d3952045b8042a4da58bd470e&quot;,
    type = &quot;zip&quot;,
)
use_repo(grafana, &quot;grafana_plotly_plugin&quot;)"><pre><span class="pl-c"># In your MODULE.bazel</span>
<span class="pl-s1">grafana</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(<span class="pl-s">"@rules_grafana//grafana:extensions.bzl"</span>, <span class="pl-s">"grafana"</span>)
<span class="pl-s1">grafana</span>.<span class="pl-c1">plugin</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"grafana_plotly_plugin"</span>,
    <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://grafana.com/api/plugins/natel-plotly-panel/versions/0.0.7/download"</span>],
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-s">"818ab33b42a1421b561f4e44f0cd19cd1a56767d3952045b8042a4da58bd470e"</span>,
    <span class="pl-s1">type</span> <span class="pl-c1">=</span> <span class="pl-s">"zip"</span>,
)
<span class="pl-en">use_repo</span>(<span class="pl-s1">grafana</span>, <span class="pl-s">"grafana_plotly_plugin"</span>)</pre></div>
<p dir="auto">Then pass the plugin to the image rule's <code>plugins</code> list as <code>@grafana_plotly_plugin//:plugin</code>.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Custom Grafana image</h3><a id="user-content-custom-grafana-image" class="anchor" aria-label="Permalink: Custom Grafana image" href="#custom-grafana-image"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The default version of Grafana (11.6.9) may not suit your needs.
You can override the container by modifying the grafana extension in your MODULE.bazel.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">API Reference</h2><a id="user-content-api-reference" class="anchor" aria-label="Permalink: API Reference" href="#api-reference"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code>json_dashboards</code></h3><a id="user-content-json_dashboards" class="anchor" aria-label="Permalink: json_dashboards" href="#json_dashboards"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Processes a set of <code>.json</code> Grafana dashboards for inclusion in the image.</p>
<p dir="auto">Arguments:</p>
<ul dir="auto">
<li><code>name</code>: Unique name for this target.  Required.</li>
<li><code>srcs</code>: List of labels of <code>.json</code> files to build into dashboards.  Required.</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code>py_dashboards</code></h3><a id="user-content-py_dashboards" class="anchor" aria-label="Permalink: py_dashboards" href="#py_dashboards"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Processes a set of <code>.py</code> Grafana dashboards for inclusion in the image.</p>
<p dir="auto">Arguments:</p>
<ul dir="auto">
<li><code>name</code>: Unique name for this target.  Required.</li>
<li><code>srcs</code>: List of labels of <code>.py</code> files to build into dashboards.  Required.</li>
<li><code>deps</code>: List of labels of additional <code>py_library</code> targets to use while executing the Python dashboards.  Optional, default <code>[]</code>.</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code>grafana_image</code></h3><a id="user-content-grafana_image" class="anchor" aria-label="Permalink: grafana_image" href="#grafana_image"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Builds a Docker image containing Grafana and the provided dashboards and datasources.</p>
<p dir="auto">Arguments:</p>
<ul dir="auto">
<li><code>name</code>: Unique name for this target.  Required.</li>
<li><code>dashboards</code>: List of labels of <code>json_dashboards</code> and/or <code>py_dashboards</code> targets to include in the image.  Required.</li>
<li><code>datasources</code>: List of labels of <code>datasources.yaml</code> files to include in the image (<a href="http://docs.grafana.org/administration/provisioning/#datasources" rel="nofollow">Grafana datasources docs</a>).  Required.</li>
<li><code>plugins</code>: List of labels of plugin targets from the grafana extension, like <code>@your_plugin_name//:plugin</code>.  Optional.</li>
<li><code>env</code>: Dictionary of environment variant names to values, set in the Docker image when Grafana is run.  Optional.
Useful for setting runtime configs with <code>GF_</code> variables.</li>
<li><code>tags</code>: List of tags to apply to the target.  Optional.</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Module extension: <code>grafana</code></h3><a id="user-content-module-extension-grafana" class="anchor" aria-label="Permalink: Module extension: grafana" href="#module-extension-grafana"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Module extension for managing Grafana plugins and container configuration.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto"><code>grafana.plugin</code></h4><a id="user-content-grafanaplugin" class="anchor" aria-label="Permalink: grafana.plugin" href="#grafanaplugin"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Downloads a Grafana plugin for inclusion in a <code>grafana_image</code>.</p>
<p dir="auto">Arguments:</p>
<ul dir="auto">
<li><code>name</code>: Unique name for this plugin repository.  Required.</li>
<li><code>urls</code>: List of strings of mirror URLs referencing the plugin archive.  Required.</li>
<li><code>sha256</code>: String of the expected SHA-256 hash of the download.  Required.</li>
<li><code>type</code>: The archive type of the downloaded file as a string;
takes the same values as the <code>type</code> attribute of Bazel's <code>http_archive</code> rule.
Optional, as the archive type can be determined from the plugin's file extension.</li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Contributing</h2><a id="user-content-contributing" class="anchor" aria-label="Permalink: Contributing" href="#contributing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Contributions are welcome! Please see <a href="CONTRIBUTING.md">CONTRIBUTING.md</a> for guidelines.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">License</h2><a id="user-content-license" class="anchor" aria-label="Permalink: License" href="#license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="LICENSE">Apache 2.0</a></p>
</article></div>