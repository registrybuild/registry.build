<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Gazelle build file generator</h1><a id="user-content-gazelle-build-file-generator" class="anchor" aria-label="Permalink: Gazelle build file generator" href="#gazelle-build-file-generator"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Gazelle is a build file generator for Bazel projects. It can create new BUILD.bazel files for a project that follows language conventions, and it can update existing build files to include new sources, dependencies, and options. Gazelle natively supports Go and protobuf, and it may be <a href="extend.md">extended</a> to support new languages and custom rule sets.</p>
<p dir="auto">Gazelle may be run by Bazel using the <a href="#bazel-rule"><code>gazelle</code> rule</a> or it may be installed and run as a command line tool. Gazelle can also generate build files for external repositories as part of the <a href="reference.md#go_repository"><code>go_repository</code></a> rule.</p>
<p dir="auto"><em>Gazelle is under active development. Its interface and the rules it generates may change. Gazelle is not an official Google product.</em></p>
<p dir="auto">Mailing list: <a href="https://groups.google.com/forum/#!forum/bazel-go-discuss" rel="nofollow">bazel-go-discuss</a></p>
<p dir="auto">Slack: <a href="https://bazelbuild.slack.com/archives/CDBP88Z0D" rel="nofollow">#go on Bazel Slack</a>, <a href="https://gophers.slack.com/archives/C1SCQE54N" rel="nofollow">#bazel on Go Slack</a></p>
<p dir="auto"><em>rules_go and Gazelle are getting community maintainers! If you are a regular
user of either project and are interested in helping out with development,
code reviews, and issue triage, please drop by our Slack channels (linked above)
and say hello!</em></p>
<p dir="auto"><strong>See also:</strong></p>
<ul dir="auto">
<li><a href="how-gazelle-works.md">How Gazelle Works</a></li>
<li><a href="reference.md#go_repository"><code>go_repository</code></a></li>
<li><a href="extend.md">Extending Gazelle</a></li>
<li><a href="https://github.com/bazelbuild/rules_go/blob/master/proto/core.rst#avoiding-conflicts">Avoiding conflicts with proto rules</a></li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Supported languages</h2><a id="user-content-supported-languages" class="anchor" aria-label="Permalink: Supported languages" href="#supported-languages"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Gazelle can generate Bazel BUILD files for many languages:</p>
<ul dir="auto">
<li><strong>Go:</strong> Go supported is included here in bazel-gazelle, see below.</li>
<li><strong>Haskell:</strong>  Tweag's <a href="https://github.com/tweag/rules_haskell">rules_haskell</a> has two extensions: <a href="https://github.com/tweag/gazelle_cabal">gazelle_cabal</a>, for generating rules from Cabal files, and <a href="https://github.com/tweag/gazelle_haskell_modules">gazelle_haskell_modules</a> for even more fine-grained build definitions.</li>
<li><strong>Java:</strong> bazel-contrib's <a href="https://github.com/bazel-contrib/rules_jvm">rules_jvm</a> extensions include <a href="https://github.com/bazel-contrib/rules_jvm/tree/main/java/gazelle">a gazelle extension</a> for generating <code>java_library</code>, <code>java_binary</code>, <code>java_test</code>, and <code>java_test_suite</code> rules.</li>
<li><strong>JavaScript / TypeScript:</strong> Aspect provides <a href="https://github.com/aspect-build/aspect-gazelle/tree/main/language/js">JavaScript and TypeScript Support</a>. BenchSci's <a href="https://github.com/benchsci/rules_nodejs_gazelle">rules_nodejs_gazelle</a> supports generating <code>ts_project</code>, <code>js_library</code>, <code>jest_test</code>, and <code>web_asset</code> rules, and is able to support module bundlers like Webpack and Next.js.</li>
<li><strong>Kotlin:</strong> Aspect Build provides some <a href="https://github.com/aspect-build/aspect-gazelle/tree/main/language/kotlin">Kotlin Support</a>. Still under development, please check the README for currently available features.</li>
<li><strong>Protocol Buffers:</strong> Support for the <code>proto_library</code> rule, as well as <code>go_proto_library</code> is in this repository, see below. Other language-specific proto rules are not supported here. <a href="https://github.com/stackb/rules_proto">stackb/rules_proto</a> is a good resource for these rules.</li>
<li><strong>Python:</strong> <a href="https://github.com/bazel-contrib/rules_python">rules_python</a> has an extension for generating <code>py_library</code>, <code>py_binary</code>, and <code>py_test</code> rules.</li>
<li><strong>R:</strong> <a href="https://github.com/grailbio/rules_r">rules_r</a> has an extension for generating rules for R package builds and tests.</li>
<li><strong>Rust:</strong> <a href="https://github.com/Calsign/gazelle_rust">gazelle_rust</a> is an extension for generating <a href="https://github.com/bazelbuild/rules_rust">rules_rust</a> targets.</li>
<li><strong>Starlark:</strong> <a href="https://github.com/bazelbuild/bazel-skylib">bazel-skylib</a> has an extension for generating <code>bzl_library</code> rules. See <a href="https://github.com/bazelbuild/bazel-skylib/tree/main/gazelle/bzl">bazel_skylib/gazelle/bzl</a>.</li>
<li><strong>Swift:</strong> <a href="https://github.com/cgrindel/swift_gazelle_plugin">swift_gazelle_plugin</a> has an extension for generating <code>swift_library</code>, <code>swift_binary</code>, and   <code>swift_test</code> rules. It also includes facilities for resolving, downloading and building external Swift packages for a Bazel workspace.</li>
<li><strong>C/C++:</strong> <a href="https://github.com/EngFlow/gazelle_cc">gazelle_cc</a> has an extension for <code>cc_*</code> rules.</li>
</ul>
<p dir="auto">If you know of an extension which could be linked here, please <a href="https://github.com/bazel-contrib/bazel-gazelle/edit/master/README.rst">open a PR</a>!</p>
<p dir="auto">More languages can be added by <a href="extend.md">Extending Gazelle</a>. Chat with us in the <code>#gazelle</code> channel on <a href="https://slack.bazel.build" rel="nofollow">Bazel Slack</a> if you'd like to discuss your design.</p>
<p dir="auto">If you've written your own extension, please consider open-sourcing it for use by the rest of the community. Note that such extensions belong in a language-specific repository, not in bazel-gazelle. See discussion in <a href="https://github.com/bazelbuild/bazel-gazelle/issues/1030" data-hovercard-type="issue" data-hovercard-url="/bazel-contrib/bazel-gazelle/issues/1030/hovercard">#1030</a>.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Setup</h2><a id="user-content-setup" class="anchor" aria-label="Permalink: Setup" href="#setup"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Bzlmod</h3><a id="user-content-bzlmod" class="anchor" aria-label="Permalink: Bzlmod" href="#bzlmod"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">See the <a href="https://github.com/bazel-contrib/rules_go/blob/master/docs/go/core/bzlmod.md">Go Bzlmod docs</a>.</p>
<p dir="auto">The full documentation for the <code>go_deps</code> extension is in <a href="extensions.md#go_deps">extensions.md</a>.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">WORKSPACE</h3><a id="user-content-workspace" class="anchor" aria-label="Permalink: WORKSPACE" href="#workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To use Gazelle in a new project, add the <code>bazel_gazelle</code> repository and its dependencies to your WORKSPACE file and call <code>gazelle_dependencies</code>. It should look like this:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_archive&quot;)

http_archive(
    name = &quot;io_bazel_rules_go&quot;,
    integrity = &quot;sha256-M6zErg9wUC20uJPJ/B3Xqb+ZjCPn/yxFF3QdQEmpdvg=&quot;,
    urls = [
        &quot;https://mirror.bazel.build/github.com/bazelbuild/rules_go/releases/download/v0.48.0/rules_go-v0.48.0.zip&quot;,
        &quot;https://github.com/bazelbuild/rules_go/releases/download/v0.48.0/rules_go-v0.48.0.zip&quot;,
    ],
)

http_archive(
    name = &quot;bazel_gazelle&quot;,
    integrity = &quot;sha256-12v3pg/YsFBEQJDfooN6Tq+YKeEWVhjuNdzspcvfWNU=&quot;,
    urls = [
        &quot;https://mirror.bazel.build/github.com/bazelbuild/bazel-gazelle/releases/download/v0.37.0/bazel-gazelle-v0.37.0.tar.gz&quot;,
        &quot;https://github.com/bazelbuild/bazel-gazelle/releases/download/v0.37.0/bazel-gazelle-v0.37.0.tar.gz&quot;,
    ],
)


load(&quot;@io_bazel_rules_go//go:deps.bzl&quot;, &quot;go_register_toolchains&quot;, &quot;go_rules_dependencies&quot;)
load(&quot;@bazel_gazelle//:deps.bzl&quot;, &quot;gazelle_dependencies&quot;, &quot;go_repository&quot;)

############################################################
# Define your own dependencies here using go_repository.
# Else, dependencies declared by rules_go/gazelle will be used.
# The first declaration of an external repository &quot;wins&quot;.
############################################################

go_rules_dependencies()

go_register_toolchains(version = &quot;1.20.5&quot;)

gazelle_dependencies()"><pre><span class="pl-en">load</span>(<span class="pl-s">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="pl-s">"http_archive"</span>)

<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"io_bazel_rules_go"</span>,
    <span class="pl-s1">integrity</span> <span class="pl-c1">=</span> <span class="pl-s">"sha256-M6zErg9wUC20uJPJ/B3Xqb+ZjCPn/yxFF3QdQEmpdvg="</span>,
    <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"https://mirror.bazel.build/github.com/bazelbuild/rules_go/releases/download/v0.48.0/rules_go-v0.48.0.zip"</span>,
        <span class="pl-s">"https://github.com/bazelbuild/rules_go/releases/download/v0.48.0/rules_go-v0.48.0.zip"</span>,
    ],
)

<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"bazel_gazelle"</span>,
    <span class="pl-s1">integrity</span> <span class="pl-c1">=</span> <span class="pl-s">"sha256-12v3pg/YsFBEQJDfooN6Tq+YKeEWVhjuNdzspcvfWNU="</span>,
    <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"https://mirror.bazel.build/github.com/bazelbuild/bazel-gazelle/releases/download/v0.37.0/bazel-gazelle-v0.37.0.tar.gz"</span>,
        <span class="pl-s">"https://github.com/bazelbuild/bazel-gazelle/releases/download/v0.37.0/bazel-gazelle-v0.37.0.tar.gz"</span>,
    ],
)


<span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_go//go:deps.bzl"</span>, <span class="pl-s">"go_register_toolchains"</span>, <span class="pl-s">"go_rules_dependencies"</span>)
<span class="pl-en">load</span>(<span class="pl-s">"@bazel_gazelle//:deps.bzl"</span>, <span class="pl-s">"gazelle_dependencies"</span>, <span class="pl-s">"go_repository"</span>)

<span class="pl-c">############################################################</span>
<span class="pl-c"># Define your own dependencies here using go_repository.</span>
<span class="pl-c"># Else, dependencies declared by rules_go/gazelle will be used.</span>
<span class="pl-c"># The first declaration of an external repository "wins".</span>
<span class="pl-c">############################################################</span>

<span class="pl-en">go_rules_dependencies</span>()

<span class="pl-en">go_register_toolchains</span>(<span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"1.20.5"</span>)

<span class="pl-en">gazelle_dependencies</span>()</pre></div>
<p dir="auto"><code>gazelle_dependencies</code> supports optional argument <code>go_env</code> (dict-mapping)
to set project specific go environment variables. If you are using a
<code>WORKSPACE.bazel</code> file, you will need to specify that using:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="gazelle_dependencies(go_repository_default_config = &quot;//:WORKSPACE.bazel&quot;)"><pre><span class="pl-en">gazelle_dependencies</span>(<span class="pl-s1">go_repository_default_config</span> <span class="pl-c1">=</span> <span class="pl-s">"//:WORKSPACE.bazel"</span>)</pre></div>
<p dir="auto">Add the code below to the BUILD or BUILD.bazel file in the root directory
of your repository.</p>
<p dir="auto"><strong>Important:</strong> For Go projects, replace the string after <code>prefix</code> with
the portion of your import path that corresponds to your repository.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_gazelle//:def.bzl&quot;, &quot;gazelle&quot;)

# gazelle:prefix github.com/example/project
gazelle(name = &quot;gazelle&quot;)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@bazel_gazelle//:def.bzl"</span>, <span class="pl-s">"gazelle"</span>)

<span class="pl-c"># gazelle:prefix github.com/example/project</span>
<span class="pl-en">gazelle</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"gazelle"</span>)</pre></div>
<p dir="auto">After adding this code, you can run Gazelle with Bazel.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="bazel run //:gazelle"><pre class="notranslate"><code>bazel run //:gazelle
</code></pre></div>
<p dir="auto">This will generate new BUILD.bazel files for your project. You can run the same command in the future to update existing BUILD.bazel files to include new source files or options.</p>
<p dir="auto">You can write other <code>gazelle</code> rules to run alternate commands like <code>update-repos</code>.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="gazelle(
    name = &quot;gazelle-update-repos&quot;,
    args = [
        &quot;-from_file=go.mod&quot;,
        &quot;-to_macro=deps.bzl%go_dependencies&quot;,
        &quot;-prune&quot;,
    ],
    command = &quot;update-repos&quot;,
)"><pre><span class="pl-en">gazelle</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"gazelle-update-repos"</span>,
    <span class="pl-s1">args</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"-from_file=go.mod"</span>,
        <span class="pl-s">"-to_macro=deps.bzl%go_dependencies"</span>,
        <span class="pl-s">"-prune"</span>,
    ],
    <span class="pl-s1">command</span> <span class="pl-c1">=</span> <span class="pl-s">"update-repos"</span>,
)</pre></div>
<p dir="auto">You can also pass additional arguments to Gazelle after a <code>--</code> argument.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="bazel run //:gazelle -- update-repos -from_file=go.mod -to_macro=deps.bzl%go_dependencies"><pre class="notranslate"><code>bazel run //:gazelle -- update-repos -from_file=go.mod -to_macro=deps.bzl%go_dependencies
</code></pre></div>
<p dir="auto">After running <code>update-repos</code>, you might want to run <code>bazel run //:gazelle</code> again, as the <code>update-repos</code> command can affect the output of a normal run of Gazelle.</p>
<p dir="auto">To verify that all BUILD files are update-to-date, you can use the <code>gazelle_test</code> rule.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_gazelle//:def.bzl&quot;, &quot;gazelle_test&quot;)

gazelle_test(
    name = &quot;gazelle_test&quot;,
    workspace = &quot;//:BUILD.bazel&quot;, # a file in the workspace root, where the gazelle will be run
)"><pre class="notranslate"><code>load("@bazel_gazelle//:def.bzl", "gazelle_test")

gazelle_test(
    name = "gazelle_test",
    workspace = "//:BUILD.bazel", # a file in the workspace root, where the gazelle will be run
)
</code></pre></div>
<p dir="auto">However, please note that gazelle_test cannot be cached.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Usage</h2><a id="user-content-usage" class="anchor" aria-label="Permalink: Usage" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Command line</h3><a id="user-content-command-line" class="anchor" aria-label="Permalink: Command line" href="#command-line"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In most cases, you'll invoke Gazelle through Bazel using the <code>gazelle</code> rule:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="bazel run //:gazelle"><pre class="notranslate"><code>bazel run //:gazelle
</code></pre></div>
<p dir="auto">To run Gazelle in specific directories, or with additional flags:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="bazel run //:gazelle -- [flags...] [directories...]"><pre class="notranslate"><code>bazel run //:gazelle -- [flags...] [directories...]
</code></pre></div>
<p dir="auto">If you build and install a Gazelle binary, you can also invoke it directly without <code>bazel run</code>.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="gazelle [fix|update] [flags...] [directories...]"><pre class="notranslate"><code>gazelle [fix|update] [flags...] [directories...]
</code></pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Configuration directives</h3><a id="user-content-configuration-directives" class="anchor" aria-label="Permalink: Configuration directives" href="#configuration-directives"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Gazelle can be configured with <em>directives</em>, which are written as top-level comments in build files. Most options that can be set on the command line can also be set using directives. Some options can only be set with directives.</p>
<p dir="auto">Directive comments have the form <code># gazelle:key value</code>. For example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_go//go:def.bzl&quot;, &quot;go_library&quot;)

# gazelle:prefix github.com/example/project
# gazelle:build_file_name BUILD,BUILD.bazel

go_library(
    name = &quot;go_default_library&quot;,
    srcs = [&quot;example.go&quot;],
    importpath = &quot;github.com/example/project&quot;,
    visibility = [&quot;//visibility:public&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_go//go:def.bzl"</span>, <span class="pl-s">"go_library"</span>)

<span class="pl-c"># gazelle:prefix github.com/example/project</span>
<span class="pl-c"># gazelle:build_file_name BUILD,BUILD.bazel</span>

<span class="pl-en">go_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"go_default_library"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"example.go"</span>],
    <span class="pl-s1">importpath</span> <span class="pl-c1">=</span> <span class="pl-s">"github.com/example/project"</span>,
    <span class="pl-s1">visibility</span> <span class="pl-c1">=</span> [<span class="pl-s">"//visibility:public"</span>],
)</pre></div>
<p dir="auto">Directives apply in the directory where they are set <em>and</em> in subdirectories. This means, for example, if you set <code># gazelle:prefix</code> in the build file in your project's root directory, it affects your whole project. If you set it in a subdirectory, it only affects rules in that subtree.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Reference</h3><a id="user-content-reference" class="anchor" aria-label="Permalink: Reference" href="#reference"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">For a full reference on Gazelle's configuration directives, flags, and rules, see the following pages:</p>
<ul dir="auto">
<li><a href="gazelle-reference.md">Configuration and command line reference</a></li>
<li><a href="language/go/reference.md">Go reference</a></li>
<li><a href="language/proto/reference.md">Proto reference</a></li>
<li><a href="reference.md">Rule reference</a> (for <code>gazelle</code> and <code>gazelle_binary</code> rules)</li>
</ul>
<p dir="auto">Extensions defined outside this repo provide their own references.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Lazy indexing in <code>fix</code> and <code>update</code></h3><a id="user-content-lazy-indexing-in-fix-and-update" class="anchor" aria-label="Permalink: Lazy indexing in fix and update" href="#lazy-indexing-in-fix-and-update"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">By default, <code>fix</code> and <code>update</code> read all build files in a repo to build an index of library rules (see <a href="#dependency-resolution">Dependency resolution</a>) when Gazelle starts. This can take a long time on a large repo. To avoid this problem, Gazelle can lazily index specific directories, with help from extensions that support lazy indexing.</p>
<p dir="auto">To configure lazy indexing with Go, add <code>go_search</code> directives like this:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# gazelle:go_search third_party/go
# gazelle:go_search replace/b example.com/b"><pre><span class="pl-c"># gazelle:go_search third_party/go</span>
<span class="pl-c"># gazelle:go_search replace/b example.com/b</span></pre></div>
<p dir="auto">These directives point to directories that contain Go code outside the current module, with an optional package prefix. <code>go_search</code> directives are not necessary if you're following regular Go module conventions or are using a Go <code>vendor</code> directory.</p>
<p dir="auto">To configure lazy indexing with protobuf, add <code>proto_search</code> directives like this:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# gazelle:proto_search third_party/proto api"><pre><span class="pl-c"># gazelle:proto_search third_party/proto api</span></pre></div>
<p dir="auto">The two arguments are a prefix to remove from the import path and a prefix to add. These correspond to the <a href="https://docs.bazel.build/versions/master/be/protocol-buffer.html#proto_library.strip_import_prefix" rel="nofollow"><code>strip_import_prefix</code></a> and <a href="https://docs.bazel.build/versions/master/be/protocol-buffer.html#proto_library.import_prefix" rel="nofollow"><code>import_prefix</code></a> attributes of <a href="https://bazel.build/reference/be/protocol-buffer#proto_library" rel="nofollow"><code>proto_library</code></a>. They tell Gazelle how to transform an import path read from a .proto source file into a repo-root-relative path to a directory that may contain the imported file.</p>
<p dir="auto">To use Gazelle with lazy indexing, run with <code>-r=false -index=lazy</code>, and pass the directories to update on the command line.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="gazelle -r=false -index=lazy path/to/dir1 path/to/dir2"><pre><span class="pl-s1">gazelle</span> <span class="pl-c1">-</span><span class="pl-s1">r</span><span class="pl-c1">=</span><span class="pl-s1">false</span> <span class="pl-c1">-</span><span class="pl-s1">index</span><span class="pl-c1">=</span><span class="pl-s1">lazy</span> <span class="pl-s1">path</span><span class="pl-c1">/</span><span class="pl-s1">to</span><span class="pl-c1">/</span><span class="pl-s1">dir1</span> <span class="pl-s1">path</span><span class="pl-c1">/</span><span class="pl-s1">to</span><span class="pl-c1">/</span><span class="pl-s1">dir2</span></pre></div>
<p dir="auto">You can configure your <code>gazelle</code> Bazel target to pass these flags automatically:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@gazelle//:def.bzl&quot;, &quot;gazelle&quot;, &quot;gazelle_binary&quot;)

gazelle(
    name = &quot;gazelle&quot;,
    command = &quot;fix&quot;,
    extra_args = [&quot;-r=false&quot;, &quot;-index=lazy&quot;],
    gazelle = &quot;:gazelle_binary&quot;,
)

gazelle_binary(
    name = &quot;gazelle_binary&quot;,
    ...
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@gazelle//:def.bzl"</span>, <span class="pl-s">"gazelle"</span>, <span class="pl-s">"gazelle_binary"</span>)

<span class="pl-en">gazelle</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"gazelle"</span>,
    <span class="pl-s1">command</span> <span class="pl-c1">=</span> <span class="pl-s">"fix"</span>,
    <span class="pl-s1">extra_args</span> <span class="pl-c1">=</span> [<span class="pl-s">"-r=false"</span>, <span class="pl-s">"-index=lazy"</span>],
    <span class="pl-s1">gazelle</span> <span class="pl-c1">=</span> <span class="pl-s">":gazelle_binary"</span>,
)

<span class="pl-en">gazelle_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"gazelle_binary"</span>,
    ...
)</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Compatibility with Go</h2><a id="user-content-compatibility-with-go" class="anchor" aria-label="Permalink: Compatibility with Go" href="#compatibility-with-go"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Gazelle is compatible with supported releases of Go, per the <a href="https://golang.org/doc/devel/release.html#policy" rel="nofollow">Go Release Policy</a>. The Go Team officially supports the current and previous minor releases. Older releases are not supported and don't receive bug fixes or security updates.</p>
<p dir="auto">Gazelle may use language and library features from the oldest supported release.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Dependency resolution</h2><a id="user-content-dependency-resolution" class="anchor" aria-label="Permalink: Dependency resolution" href="#dependency-resolution"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">One of Gazelle's most important jobs is resolving library import strings (like <code>import "golang.org/x/sys/unix"</code>) to Bazel labels (like <code>@org_golang_x_sys//unix:go_default_library</code>). Gazelle follows the rules below to resolve dependencies:</p>
<ol dir="auto">
<li>If the import to be resolved is part of a standard library, no explicit dependency is written. For example, in Go, you don't need to declare that you depend on <code>"fmt"</code>.</li>
<li>If a <code># gazelle:resolve</code> directive matches the import to be resolved, the label at the end of the directive will be used.</li>
<li>If proto rule generation is enabled, special rules will be used when importing certain libraries. These rules may be disabled by adding <code># gazelle:proto disable_global</code> to a build file (this will affect subdirectories, too) or by passing <code>-proto disable_global</code> on the command line.
<ol dir="auto">
<li>Imports of Well Known Types are mapped to rules in <code>@io_bazel_rules_go//proto/wkt</code>.</li>
<li>Imports of <code>github.com/golang/protobuf/ptypes</code>, <code>descriptor</code>, and <code>jsonpb</code> are mapped to special rules in <code>@com_github_golang_protobuf</code>. See <a href="https://github.com/bazel-contrib/rules_go/blob/master/proto/core.rst#avoiding-conflicts">Avoiding conflicts with proto rules</a>.</li>
</ol>
</li>
<li>If the import to be resolved is in the library index, the import will be resolved to that library. If <code>-index=all</code>, Gazelle builds an index of library rules in the current repository before starting dependency resolution. This can take a while, since Gazelle visits every directory in the repository. If <code>-index=lazy</code>, then language extensions may hint at specific directories to visit, which can be much faster.
<ol dir="auto">
<li>For Go, the match is based on the <code>importpath</code> attribute.</li>
<li>For proto, the match is based on the <code>srcs</code> attribute.</li>
</ol>
</li>
<li>If <code>-index=none</code> and a package is imported that has the current <code>go_prefix</code> as a prefix, Gazelle generates a label following a convention. For example, if the build file in <code>//src</code> set the prefix with <code># gazelle:prefix example.com/repo/foo</code>, and you import the library <code>"example.com/repo/foo/bar</code>, the dependency will be <code>"//src/foo/bar:go_default_library"</code>.</li>
<li>Otherwise, Gazelle will use the current <code>external</code> mode to resolve the dependency.
<ol dir="auto">
<li>In <code>external</code> mode (the default), Gazelle will transform the import string into an external repository label. For example, <code>"golang.org/x/sys/unix"</code> would be resolved to <code>"@org_golang_x_sys//unix:go_default_library"</code>. Gazelle does not confirm whether the external repository is actually declared in WORKSPACE, but if there <em>is</em> a <code>go_repository</code> in WORKSPACE with a matching <code>importpath</code>, Gazelle will use its name. Gazelle does not index rules in external repositories, so it's possible the resolved dependency does not exist.</li>
<li>In <code>static</code> mode, Gazelle has the same behavior as <code>external</code> mode, except that it will not call out to the network for resolution when no matching import is found within WORKSPACE. Instead, it will skip the unknown import. This is the default mode for <code>go_repository</code> rules.</li>
<li>In <code>vendored</code> mode, Gazelle will transform the import string into a label in the vendor directory. For example, <code>"golang.org/x/sys/unix"</code> would be resolved to <code>"//vendor/golang.org/x/sys/unix:go_default_library"</code>. This mode is usually not necessary, since vendored libraries will be indexed and resolved using rule 4.</li>
</ol>
</li>
</ol>
</article></div>