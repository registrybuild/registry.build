<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-bazel-kotlin-rules" class="anchor" aria-hidden="true" tabindex="-1" href="#bazel-kotlin-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Bazel Kotlin Rules</h1>
<p dir="auto"><a href="https://buildkite.com/bazel/kotlin-postsubmit" rel="nofollow"><img src="https://camo.githubusercontent.com/21d3d6c60cf9b27e5f023f933e2130f70ab0c3ab2f555384f5b8ffffd13b50d8/68747470733a2f2f62616467652e6275696c646b6974652e636f6d2f61383836306539346137333738343931636538663530343830653336303562343965623235353863666138353162626639622e737667" alt="Build Status" data-canonical-src="https://badge.buildkite.com/a8860e94a7378491ce8f50480e3605b49eb2558cfa851bbf9b.svg" style="max-width: 100%;"></a>
<a href="https://github.com/bazelbuild/rules_kotlin/tree/master"><img src="https://camo.githubusercontent.com/4ee952f33b2e665275a87732b9e2df1a0dc10473e007d657efa2db9278a0053a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4d61696e2532304272616e63682d6d61737465722d626c75652e737667" data-canonical-src="https://img.shields.io/badge/Main%20Branch-master-blue.svg" style="max-width: 100%;"></a></p>
<h3 dir="auto"><a id="user-content-releases" class="anchor" aria-hidden="true" tabindex="-1" href="#releases"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Releases</h3>
<p dir="auto"><a href="https://github.com/bazelbuild/rules_kotlin/releases/latest"><img src="https://camo.githubusercontent.com/ef74e5c0cc9086247231dfbfe041ab989db2277028b9d3fddf775a2d04df45b7/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f762f72656c656173652f62617a656c6275696c642f72756c65735f6b6f746c696e3f646973706c61795f6e616d653d746167266c6162656c3d4c6174657374253230537461626c6525323052656c65617365" data-canonical-src="https://img.shields.io/github/v/release/bazelbuild/rules_kotlin?display_name=tag&amp;label=Latest%20Stable%20Release" style="max-width: 100%;"></a>
<br>
<a href="https://github.com/bazelbuild/rules_kotlin/releases/"><img src="https://camo.githubusercontent.com/1218bed147d2cb4d8c28972df075490e359bef786a3ea06e630792829427bb0e/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f762f72656c656173652f62617a656c6275696c642f72756c65735f6b6f746c696e3f646973706c61795f6e616d653d74616726696e636c7564655f70726572656c6561736573266c6162656c3d4c617465737425323052656c6561736525323043616e646964617465" data-canonical-src="https://img.shields.io/github/v/release/bazelbuild/rules_kotlin?display_name=tag&amp;include_prereleases&amp;label=Latest%20Release%20Candidate" style="max-width: 100%;"></a></p>
<p dir="auto">For more information about release and changelogs please see <a href="CHANGELOG.md">Changelog</a> or refer to the <a href="https://github.com/bazelbuild/rules_kotlin/releases">Github Releases</a> page.</p>
<h1 dir="auto"><a id="user-content-rules_kotlin-bazel-compatibility" class="anchor" aria-hidden="true" tabindex="-1" href="#rules_kotlin-bazel-compatibility"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><code>rules_kotlin</code> Bazel Compatibility</h1>
<ul dir="auto">
<li>HEAD: <code>5</code>, <code>6</code></li>
<li><a href="https://github.com/bazelbuild/rules_kotlin/releases/tag/v1.7.1">Release 1.7</a>: <code>4</code>, <code>5</code>, <code>6</code></li>
</ul>
<h1 dir="auto"><a id="user-content-overview" class="anchor" aria-hidden="true" tabindex="-1" href="#overview"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Overview</h1>
<p dir="auto"><strong>rules_kotlin</strong> supports the basic paradigm of <code>*_binary</code>, <code>*_library</code>, <code>*_test</code> of other Bazel
language rules. It also supports <code>jvm</code>, <code>android</code>, and <code>js</code> flavors, with the prefix <code>kt_jvm</code>
and <code>kt_js</code>, and <code>kt_android</code> typically applied to the rules.</p>
<p dir="auto">Support for kotlin's -Xfriend-paths via the <code>associates=</code> attribute in the jvm allow access to
<code>internal</code> members.</p>
<p dir="auto">Also, <code>kt_jvm_*</code> rules support the following standard <code>java_*</code> rules attributes:</p>
<ul dir="auto">
<li><code>data</code></li>
<li><code>resource_jars</code></li>
<li><code>runtime_deps</code></li>
<li><code>resources</code></li>
<li><code>resources_strip_prefix</code></li>
<li><code>exports</code></li>
</ul>
<p dir="auto">Android rules also support custom_package for <code>R.java</code> generation, <code>manifest=</code>, <code>resource_files</code>, etc.</p>
<p dir="auto">Other features:</p>
<ul dir="auto">
<li>Persistent worker support.</li>
<li>Mixed-Mode compilation (compile Java and Kotlin in one pass).</li>
<li>Configurable Kotlinc distribution and version</li>
<li>Configurable Toolchain</li>
<li>Support for all recent major Kotlin releases.</li>
</ul>
<p dir="auto">Javascript is reported to work, but is not as well maintained (at present)</p>
<h1 dir="auto"><a id="user-content-documentation" class="anchor" aria-hidden="true" tabindex="-1" href="#documentation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Documentation</h1>
<p dir="auto">Generated API documentation is available at
<a href="https://bazelbuild.github.io/rules_kotlin/kotlin" rel="nofollow">https://bazelbuild.github.io/rules_kotlin/kotlin</a>.</p>
<h1 dir="auto"><a id="user-content-quick-guide" class="anchor" aria-hidden="true" tabindex="-1" href="#quick-guide"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Quick Guide</h1>
<h2 dir="auto"><a id="user-content-workspace" class="anchor" aria-hidden="true" tabindex="-1" href="#workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><code>WORKSPACE</code></h2>
<p dir="auto">In the project's <code>WORKSPACE</code>, declare the external repository and initialize the toolchains, like
this:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_archive&quot;)

rules_kotlin_version = &quot;1.8&quot;
rules_kotlin_sha = &quot;01293740a16e474669aba5b5a1fe3d368de5832442f164e4fbfc566815a8bc3a&quot;
http_archive(
    name = &quot;io_bazel_rules_kotlin&quot;,
    urls = [&quot;https://github.com/bazelbuild/rules_kotlin/releases/download/v%s/rules_kotlin_release.tgz&quot; % rules_kotlin_version],
    sha256 = rules_kotlin_sha,
)

load(&quot;@io_bazel_rules_kotlin//kotlin:repositories.bzl&quot;, &quot;kotlin_repositories&quot;)
kotlin_repositories() # if you want the default. Otherwise see custom kotlinc distribution below

load(&quot;@io_bazel_rules_kotlin//kotlin:core.bzl&quot;, &quot;kt_register_toolchains&quot;)
kt_register_toolchains() # to use the default toolchain, otherwise see toolchains below"><pre><span class="pl-en">load</span>(<span class="pl-s">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="pl-s">"http_archive"</span>)

<span class="pl-s1">rules_kotlin_version</span> <span class="pl-c1">=</span> <span class="pl-s">"1.8"</span>
<span class="pl-s1">rules_kotlin_sha</span> <span class="pl-c1">=</span> <span class="pl-s">"01293740a16e474669aba5b5a1fe3d368de5832442f164e4fbfc566815a8bc3a"</span>
<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"io_bazel_rules_kotlin"</span>,
    <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://github.com/bazelbuild/rules_kotlin/releases/download/v%s/rules_kotlin_release.tgz"</span> <span class="pl-c1">%</span> <span class="pl-s1">rules_kotlin_version</span>],
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-s1">rules_kotlin_sha</span>,
)

<span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:repositories.bzl"</span>, <span class="pl-s">"kotlin_repositories"</span>)
<span class="pl-en">kotlin_repositories</span>() <span class="pl-c"># if you want the default. Otherwise see custom kotlinc distribution below</span>

<span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:core.bzl"</span>, <span class="pl-s">"kt_register_toolchains"</span>)
<span class="pl-en">kt_register_toolchains</span>() <span class="pl-c"># to use the default toolchain, otherwise see toolchains below</span></pre></div>
<h2 dir="auto"><a id="user-content-build-files" class="anchor" aria-hidden="true" tabindex="-1" href="#build-files"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a><code>BUILD</code> files</h2>
<p dir="auto">In your project's <code>BUILD</code> files, load the Kotlin rules and use them like so:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_kotlin//kotlin:jvm.bzl&quot;, &quot;kt_jvm_library&quot;)

kt_jvm_library(
    name = &quot;package_name&quot;,
    srcs = glob([&quot;*.kt&quot;]),
    deps = [
        &quot;//path/to/dependency&quot;,
    ],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:jvm.bzl"</span>, <span class="pl-s">"kt_jvm_library"</span>)

<span class="pl-en">kt_jvm_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"package_name"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> <span class="pl-en">glob</span>([<span class="pl-s">"*.kt"</span>]),
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"//path/to/dependency"</span>,
    ],
)</pre></div>
<h2 dir="auto"><a id="user-content-custom-toolchain" class="anchor" aria-hidden="true" tabindex="-1" href="#custom-toolchain"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Custom toolchain</h2>
<p dir="auto">To enable a custom toolchain (to configure language level, etc.)
do the following.  In a <code>&lt;workspace&gt;/BUILD.bazel</code> file define the following:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_kotlin//kotlin:core.bzl&quot;, &quot;define_kt_toolchain&quot;)

define_kt_toolchain(
    name = &quot;kotlin_toolchain&quot;,
    api_version = KOTLIN_LANGUAGE_LEVEL,  # &quot;1.1&quot;, &quot;1.2&quot;, &quot;1.3&quot;, &quot;1.4&quot;, &quot;1.5&quot; &quot;1.6&quot;, or &quot;1.7&quot;
    jvm_target = JAVA_LANGUAGE_LEVEL, # &quot;1.6&quot;, &quot;1.8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;11&quot;, &quot;12&quot;, &quot;13&quot;, &quot;15&quot;, &quot;16&quot;, or &quot;17&quot;
    language_version = KOTLIN_LANGUAGE_LEVEL,  # &quot;1.1&quot;, &quot;1.2&quot;, &quot;1.3&quot;, &quot;1.4&quot;, &quot;1.5&quot; &quot;1.6&quot;, or &quot;1.7&quot;
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:core.bzl"</span>, <span class="pl-s">"define_kt_toolchain"</span>)

<span class="pl-en">define_kt_toolchain</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"kotlin_toolchain"</span>,
    <span class="pl-s1">api_version</span> <span class="pl-c1">=</span> <span class="pl-v">KOTLIN_LANGUAGE_LEVEL</span>,  <span class="pl-c"># "1.1", "1.2", "1.3", "1.4", "1.5" "1.6", or "1.7"</span>
    <span class="pl-s1">jvm_target</span> <span class="pl-c1">=</span> <span class="pl-v">JAVA_LANGUAGE_LEVEL</span>, <span class="pl-c"># "1.6", "1.8", "9", "10", "11", "12", "13", "15", "16", or "17"</span>
    <span class="pl-s1">language_version</span> <span class="pl-c1">=</span> <span class="pl-v">KOTLIN_LANGUAGE_LEVEL</span>,  <span class="pl-c"># "1.1", "1.2", "1.3", "1.4", "1.5" "1.6", or "1.7"</span>
)</pre></div>
<p dir="auto">and then in your <code>WORKSPACE</code> file, instead of <code>kt_register_toolchains()</code> do</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="register_toolchains(&quot;//:kotlin_toolchain&quot;)"><pre><span class="pl-en">register_toolchains</span>(<span class="pl-s">"//:kotlin_toolchain"</span>)</pre></div>
<h2 dir="auto"><a id="user-content-custom-kotlinc-distribution-and-version" class="anchor" aria-hidden="true" tabindex="-1" href="#custom-kotlinc-distribution-and-version"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Custom <code>kotlinc</code> distribution (and version)</h2>
<p dir="auto">To choose a different <code>kotlinc</code> distribution (1.3 and 1.4 variants supported), do the following
in your <code>WORKSPACE</code> file (or import from a <code>.bzl</code> file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_kotlin//kotlin:repositories.bzl&quot;, &quot;kotlin_repositories&quot;, &quot;kotlinc_version&quot;)

kotlin_repositories(
    compiler_release = kotlinc_version(
        release = &quot;1.6.21&quot;, # just the numeric version
        sha256 = &quot;632166fed89f3f430482f5aa07f2e20b923b72ef688c8f5a7df3aa1502c6d8ba&quot;
    )
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:repositories.bzl"</span>, <span class="pl-s">"kotlin_repositories"</span>, <span class="pl-s">"kotlinc_version"</span>)

<span class="pl-en">kotlin_repositories</span>(
    <span class="pl-s1">compiler_release</span> <span class="pl-c1">=</span> <span class="pl-en">kotlinc_version</span>(
        <span class="pl-s1">release</span> <span class="pl-c1">=</span> <span class="pl-s">"1.6.21"</span>, <span class="pl-c"># just the numeric version</span>
        <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-s">"632166fed89f3f430482f5aa07f2e20b923b72ef688c8f5a7df3aa1502c6d8ba"</span>
    )
)</pre></div>
<h2 dir="auto"><a id="user-content-third-party-dependencies" class="anchor" aria-hidden="true" tabindex="-1" href="#third-party-dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Third party dependencies</h2>
<p dir="auto"><em>(e.g. Maven artifacts)</em></p>
<p dir="auto">Third party (external) artifacts can be brought in with systems such as <a href="https://github.com/bazelbuild/rules_jvm_external"><code>rules_jvm_external</code></a> or <a href="https://github.com/square/bazel_maven_repository"><code>bazel_maven_repository</code></a> or <a href="https://github.com/johnynek/bazel-deps"><code>bazel-deps</code></a>, but make sure the version you use doesn't naively use <code>java_import</code>, as this will cause bazel to make an interface-only (<code>ijar</code>), or ABI jar, and the native <code>ijar</code> tool does not know about kotlin metadata with respect to inlined functions, and will remove method bodies inappropriately.  Recent versions of <code>rules_jvm_external</code> and <code>bazel_maven_repository</code> are known to work with Kotlin.</p>
<h1 dir="auto"><a id="user-content-development-setup-guide" class="anchor" aria-hidden="true" tabindex="-1" href="#development-setup-guide"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Development Setup Guide</h1>
<p dir="auto">As of 1.5.0, to use the rules directly from the rules_kotlin workspace (i.e. not the release artifact)
require the use of <code>release_archive</code> repository. This repository will build and configure the current
workspace to use <code>rules_kotlin</code> in the same manner as the released binary artifact.</p>
<p dir="auto">In the project's <code>WORKSPACE</code>, change the setup:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="
# Use local check-out of repo rules (or a commit-archive from github via http_archive or git_repository)
local_repository(
    name = &quot;io_bazel_rules_kotlin&quot;,
    path = &quot;../path/to/rules_kotlin_clone/&quot;,
)

load(&quot;@io_bazel_rules_kotlin//kotlin:dependencies.bzl&quot;, &quot;kt_download_local_dev_dependencies&quot;)

kt_download_local_dev_dependencies()

load(&quot;@io_bazel_rules_kotlin//kotlin:repositories.bzl&quot;, &quot;kotlin_repositories&quot;, &quot;versions&quot;)

kotlin_repositories()

load(&quot;@io_bazel_rules_kotlin//kotlin:core.bzl&quot;, &quot;kt_register_toolchains&quot;)

kt_register_toolchains()"><pre><span class="pl-c"># Use local check-out of repo rules (or a commit-archive from github via http_archive or git_repository)</span>
<span class="pl-en">local_repository</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"io_bazel_rules_kotlin"</span>,
    <span class="pl-s1">path</span> <span class="pl-c1">=</span> <span class="pl-s">"../path/to/rules_kotlin_clone/"</span>,
)

<span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:dependencies.bzl"</span>, <span class="pl-s">"kt_download_local_dev_dependencies"</span>)

<span class="pl-en">kt_download_local_dev_dependencies</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:repositories.bzl"</span>, <span class="pl-s">"kotlin_repositories"</span>, <span class="pl-s">"versions"</span>)

<span class="pl-en">kotlin_repositories</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:core.bzl"</span>, <span class="pl-s">"kt_register_toolchains"</span>)

<span class="pl-en">kt_register_toolchains</span>()</pre></div>
<p dir="auto">To use rules_kotlin from head without cloning the repository, (caveat emptor, of course), change the
rules to this:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Download master or specific revisions
http_archive(
    name = &quot;io_bazel_rules_kotlin&quot;,
    strip_prefix = &quot;rules_kotlin-master&quot;,
    urls = [&quot;https://github.com/bazelbuild/rules_kotlin/archive/refs/heads/master.zip&quot;],
)

load(&quot;@io_bazel_rules_kotlin//kotlin:repositories.bzl&quot;, &quot;kotlin_repositories&quot;)

kotlin_repositories()

load(&quot;@io_bazel_rules_kotlin//kotlin:core.bzl&quot;, &quot;kt_register_toolchains&quot;)

kt_register_toolchains()"><pre><span class="pl-c"># Download master or specific revisions</span>
<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"io_bazel_rules_kotlin"</span>,
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_kotlin-master"</span>,
    <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://github.com/bazelbuild/rules_kotlin/archive/refs/heads/master.zip"</span>],
)

<span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:repositories.bzl"</span>, <span class="pl-s">"kotlin_repositories"</span>)

<span class="pl-en">kotlin_repositories</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:core.bzl"</span>, <span class="pl-s">"kt_register_toolchains"</span>)

<span class="pl-en">kt_register_toolchains</span>()</pre></div>
<h1 dir="auto"><a id="user-content-debugging-native-actions" class="anchor" aria-hidden="true" tabindex="-1" href="#debugging-native-actions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Debugging native actions</h1>
<p dir="auto">To attach debugger and step through native action code when using local checkout of rules_kotlin repo :</p>
<ol dir="auto">
<li>Open <code>rules_kotlin</code> project in Android Studio, using existing <code>.bazelproject</code> file as project view.</li>
<li>In terminal, build the kotlin target you want to debug, using the subcommand option, ex: <code>bazel build //lib/mylib:main_kt -s</code>. You can also use <code>bazel aquery</code> to get this info.</li>
<li>Locate the subcommand for the kotlin action you want to debug, let's say <code>KotlinCompile</code>. Note: If you don't see it, target rebuild may have been skipped (in this case <code>touch</code> one of the source .kt file to trigger rebuild).</li>
<li>Export <code>REPOSITORY_NAME</code> as specified in action env, ex : <code>export REPOSITORY_NAME=io_bazel_rules_kotlin</code></li>
<li>Copy the command line, ex : <code>bazel-out/darwin_arm64-opt-exec-2B5CBBC6/bin/external/io_bazel_rules_kotlin/src/main/kotlin/build '--flagfile=bazel-out/darwin_arm64-fastbuild/bin/lib/mylib/main_kt-kt.jar-0.params'</code></li>
<li>Change directory into the <a href="https://bazel.build/remote/output-directories#layout-diagram" rel="nofollow">execRoot</a>, normally <code>bazel-MYPROJECT</code>, available via <code>bazel info | grep execution_root</code>.</li>
<li>Add <code>--debug=5005</code> to command line to make the action wait for a debugger to attach, ex: <code>bazel-out/darwin_arm64-opt-exec-2B5CBBC6/bin/external/io_bazel_rules_kotlin/src/main/kotlin/build --debug=5005 '--flagfile=bazel-out/darwin_arm64-fastbuild/bin/lib/mylib/main_kt-kt.jar-0.params'</code>. Note: if command invokes <code>java</code> toolchain directly, use <code>-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005</code> instead.</li>
<li>You should see in output that action is waiting for debugger. Use a default <code>Remote JVM Debug</code> configuration in Android Studio, set breakpoint in kotlin action java/kt code, and attach debugger. Breakpoints should be hit.</li>
</ol>
<h1 dir="auto"><a id="user-content-kotlin-and-java-compiler-flags" class="anchor" aria-hidden="true" tabindex="-1" href="#kotlin-and-java-compiler-flags"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Kotlin and Java compiler flags</h1>
<p dir="auto">The <code>kt_kotlinc_options</code> and <code>kt_javac_options</code> rules allows passing compiler flags to kotlinc and javac.</p>
<p dir="auto">Note: Not all compiler flags are supported in all language versions. When this happens, the rules will fail.</p>
<p dir="auto">For example you can define global compiler flags by doing:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_kotlin//kotlin:core.bzl&quot;, &quot;kt_kotlinc_options&quot;, &quot;kt_javac_options&quot;, &quot;define_kt_toolchain&quot;)

kt_kotlinc_options(
    name = &quot;kt_kotlinc_options&quot;,
    kotlinc_opts = [&quot;-Xno-param-assertions&quot;],
    jvm_target = &quot;1.8&quot;,
)

kt_javac_options(
    name = &quot;kt_javac_options&quot;,
    javac_opts = [&quot;-nowarn&quot;],
)

define_kt_toolchain(
    name = &quot;kotlin_toolchain&quot;,
    kotlinc_options = &quot;//:kt_kotlinc_options&quot;,
    javac_options = &quot;//:kt_javac_options&quot;,
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:core.bzl"</span>, <span class="pl-s">"kt_kotlinc_options"</span>, <span class="pl-s">"kt_javac_options"</span>, <span class="pl-s">"define_kt_toolchain"</span>)

<span class="pl-en">kt_kotlinc_options</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"kt_kotlinc_options"</span>,
    <span class="pl-s1">kotlinc_opts</span> <span class="pl-c1">=</span> [<span class="pl-s">"-Xno-param-assertions"</span>],
    <span class="pl-s1">jvm_target</span> <span class="pl-c1">=</span> <span class="pl-s">"1.8"</span>,
)

<span class="pl-en">kt_javac_options</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"kt_javac_options"</span>,
    <span class="pl-s1">javac_opts</span> <span class="pl-c1">=</span> [<span class="pl-s">"-nowarn"</span>],
)

<span class="pl-en">define_kt_toolchain</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"kotlin_toolchain"</span>,
    <span class="pl-s1">kotlinc_options</span> <span class="pl-c1">=</span> <span class="pl-s">"//:kt_kotlinc_options"</span>,
    <span class="pl-s1">javac_options</span> <span class="pl-c1">=</span> <span class="pl-s">"//:kt_javac_options"</span>,
)</pre></div>
<p dir="auto">You can optionally override compiler flags at the target level by providing an alternative set of <code>kt_kotlinc_options</code> or <code>kt_javac_options</code> in your target definitions.</p>
<p dir="auto">Compiler flags that are passed to the rule definitions will be taken over the toolchain definition.</p>
<p dir="auto">Example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_kotlin//kotlin:core.bzl&quot;, &quot;kt_kotlinc_options&quot;, &quot;kt_javac_options&quot;)
load(&quot;@io_bazel_rules_kotlin//kotlin:jvm.bzl&quot;, &quot;kt_jvm_library&quot;)

kt_kotlinc_options(
    name = &quot;kt_kotlinc_options_for_package_name&quot;,
    kotlinc_opts = [
     &quot;-Xno-param-assertions&quot;,
     &quot;-Xopt-in=kotlin.Experimental&quot;,
     &quot;-Xopt-in=kotlin.ExperimentalStdlibApi&quot;,
    ],
)

kt_javac_options(
    name = &quot;kt_javac_options_for_package_name&quot;,
    javac_opts = [&quot;-nowarn&quot;],
)

kt_jvm_library(
    name = &quot;package_name&quot;,
    srcs = glob([&quot;*.kt&quot;]),
    kotlinc_opts = &quot;//:kt_kotlinc_options_for_package_name&quot;,
    javac_opts = &quot;//:kt_javac_options_for_package_name&quot;,
    deps = [&quot;//path/to/dependency&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:core.bzl"</span>, <span class="pl-s">"kt_kotlinc_options"</span>, <span class="pl-s">"kt_javac_options"</span>)
<span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:jvm.bzl"</span>, <span class="pl-s">"kt_jvm_library"</span>)

<span class="pl-en">kt_kotlinc_options</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"kt_kotlinc_options_for_package_name"</span>,
    <span class="pl-s1">kotlinc_opts</span> <span class="pl-c1">=</span> [
     <span class="pl-s">"-Xno-param-assertions"</span>,
     <span class="pl-s">"-Xopt-in=kotlin.Experimental"</span>,
     <span class="pl-s">"-Xopt-in=kotlin.ExperimentalStdlibApi"</span>,
    ],
)

<span class="pl-en">kt_javac_options</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"kt_javac_options_for_package_name"</span>,
    <span class="pl-s1">javac_opts</span> <span class="pl-c1">=</span> [<span class="pl-s">"-nowarn"</span>],
)

<span class="pl-en">kt_jvm_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"package_name"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> <span class="pl-en">glob</span>([<span class="pl-s">"*.kt"</span>]),
    <span class="pl-s1">kotlinc_opts</span> <span class="pl-c1">=</span> <span class="pl-s">"//:kt_kotlinc_options_for_package_name"</span>,
    <span class="pl-s1">javac_opts</span> <span class="pl-c1">=</span> <span class="pl-s">"//:kt_javac_options_for_package_name"</span>,
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [<span class="pl-s">"//path/to/dependency"</span>],
)</pre></div>
<p dir="auto">Additionally, you can add options for both tracing and timing of the bazel build using the <code>kt_trace</code> and <code>kt_timings</code> flags, for example:</p>
<ul dir="auto">
<li><code>bazel build --define=kt_trace=1</code></li>
<li><code>bazel build --define=kt_timings=1</code></li>
</ul>
<p dir="auto"><code>kt_trace=1</code> will allow you to inspect the full kotlinc commandline invocation, while <code>kt_timings=1</code> will report the high level time taken for each step.</p>
<h1 dir="auto"><a id="user-content-ksp-kotlin-symbol-processing" class="anchor" aria-hidden="true" tabindex="-1" href="#ksp-kotlin-symbol-processing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>KSP (Kotlin Symbol Processing)</h1>
<p dir="auto">KSP is officially supported as of <code>rules_kotlin</code> 1.8 and can be declared using the new
<code>kt_ksp_plugin</code> rule.</p>
<p dir="auto">A few things to note:</p>
<ul dir="auto">
<li>As of now <code>rules_kotlin</code> only supports KSP plugins that generate Kotlin code.</li>
<li>KSP is <a href="https://github.com/google/ksp/issues/1385" data-hovercard-type="issue" data-hovercard-url="/google/ksp/issues/1385/hovercard">not yet thread safe</a> and will likely fail if you are using it in a build that has multiplex workers enabled. To work around this add the following flag to your Bazelrc:
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="build --experimental_worker_max_multiplex_instances=KotlinKsp=1"><pre class="notranslate"><code>build --experimental_worker_max_multiplex_instances=KotlinKsp=1
</code></pre></div>
</li>
</ul>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_kotlin//kotlin:core.bzl&quot;, &quot;kt_ksp_plugin&quot;)
load(&quot;@io_bazel_rules_kotlin//kotlin:jvm.bzl&quot;, &quot;kt_jvm_library&quot;)

kt_ksp_plugin(
    name = &quot;moshi-kotlin-codegen&quot;,
    processor_class = &quot;com.squareup.moshi.kotlin.codegen.ksp.JsonClassSymbolProcessorProvider&quot;,
    deps = [
        &quot;@maven//:com_squareup_moshi_moshi&quot;,
        &quot;@maven//:com_squareup_moshi_moshi_kotlin&quot;,
        &quot;@maven//:com_squareup_moshi_moshi_kotlin_codegen&quot;,
    ],
)

kt_jvm_library(
    name = &quot;lib&quot;,
    srcs = glob([&quot;*.kt&quot;]),
    plugins = [&quot;//:moshi-kotlin-codegen&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:core.bzl"</span>, <span class="pl-s">"kt_ksp_plugin"</span>)
<span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:jvm.bzl"</span>, <span class="pl-s">"kt_jvm_library"</span>)

<span class="pl-en">kt_ksp_plugin</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"moshi-kotlin-codegen"</span>,
    <span class="pl-s1">processor_class</span> <span class="pl-c1">=</span> <span class="pl-s">"com.squareup.moshi.kotlin.codegen.ksp.JsonClassSymbolProcessorProvider"</span>,
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"@maven//:com_squareup_moshi_moshi"</span>,
        <span class="pl-s">"@maven//:com_squareup_moshi_moshi_kotlin"</span>,
        <span class="pl-s">"@maven//:com_squareup_moshi_moshi_kotlin_codegen"</span>,
    ],
)

<span class="pl-en">kt_jvm_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"lib"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> <span class="pl-en">glob</span>([<span class="pl-s">"*.kt"</span>]),
    <span class="pl-s1">plugins</span> <span class="pl-c1">=</span> [<span class="pl-s">"//:moshi-kotlin-codegen"</span>],
)</pre></div>
<p dir="auto">To choose a different <code>ksp_version</code> distribution,
do the following in your <code>WORKSPACE</code> file (or import from a <code>.bzl</code> file):</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_kotlin//kotlin:repositories.bzl&quot;, &quot;kotlin_repositories&quot;, &quot;ksp_version&quot;)

kotlin_repositories(
    ksp_compiler_release = ksp_version(
        release = &quot;1.8.22-1.0.11&quot;,
        sha256 = &quot;2ce5a08fddd20ef07ac051615905453fe08c3ba3ce5afa5dc43a9b77aa64507d&quot;,
    ),
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:repositories.bzl"</span>, <span class="pl-s">"kotlin_repositories"</span>, <span class="pl-s">"ksp_version"</span>)

<span class="pl-en">kotlin_repositories</span>(
    <span class="pl-s1">ksp_compiler_release</span> <span class="pl-c1">=</span> <span class="pl-en">ksp_version</span>(
        <span class="pl-s1">release</span> <span class="pl-c1">=</span> <span class="pl-s">"1.8.22-1.0.11"</span>,
        <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-s">"2ce5a08fddd20ef07ac051615905453fe08c3ba3ce5afa5dc43a9b77aa64507d"</span>,
    ),
)</pre></div>
<h1 dir="auto"><a id="user-content-kotlin-compiler-plugins" class="anchor" aria-hidden="true" tabindex="-1" href="#kotlin-compiler-plugins"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Kotlin compiler plugins</h1>
<p dir="auto">The <code>kt_compiler_plugin</code> rule allows running Kotlin compiler plugins, such as no-arg, sam-with-receiver and allopen.</p>
<p dir="auto">For example, you can add allopen to your project like this:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_kotlin//kotlin:core.bzl&quot;, &quot;kt_compiler_plugin&quot;)
load(&quot;@io_bazel_rules_kotlin//kotlin:jvm.bzl&quot;, &quot;kt_jvm_library&quot;)

kt_compiler_plugin(
    name = &quot;open_for_testing_plugin&quot;,
    id = &quot;org.jetbrains.kotlin.allopen&quot;,
    options = {
        &quot;annotation&quot;: &quot;plugin.allopen.OpenForTesting&quot;,
    },
    deps = [
        &quot;@com_github_jetbrains_kotlin//:allopen-compiler-plugin&quot;,
    ],
)

kt_jvm_library(
    name = &quot;user&quot;,
    srcs = [&quot;User.kt&quot;], # The User class is annotated with OpenForTesting
    plugins = [
        &quot;:open_for_testing_plugin&quot;,
    ],
    deps = [
        &quot;:open_for_testing&quot;, # This contains the annotation (plugin.allopen.OpenForTesting)
    ],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:core.bzl"</span>, <span class="pl-s">"kt_compiler_plugin"</span>)
<span class="pl-en">load</span>(<span class="pl-s">"@io_bazel_rules_kotlin//kotlin:jvm.bzl"</span>, <span class="pl-s">"kt_jvm_library"</span>)

<span class="pl-en">kt_compiler_plugin</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"open_for_testing_plugin"</span>,
    <span class="pl-s1">id</span> <span class="pl-c1">=</span> <span class="pl-s">"org.jetbrains.kotlin.allopen"</span>,
    <span class="pl-s1">options</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"annotation"</span>: <span class="pl-s">"plugin.allopen.OpenForTesting"</span>,
    },
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"@com_github_jetbrains_kotlin//:allopen-compiler-plugin"</span>,
    ],
)

<span class="pl-en">kt_jvm_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"user"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"User.kt"</span>], <span class="pl-c"># The User class is annotated with OpenForTesting</span>
    <span class="pl-s1">plugins</span> <span class="pl-c1">=</span> [
        <span class="pl-s">":open_for_testing_plugin"</span>,
    ],
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        <span class="pl-s">":open_for_testing"</span>, <span class="pl-c"># This contains the annotation (plugin.allopen.OpenForTesting)</span>
    ],
)</pre></div>
<p dir="auto">Full examples of using compiler plugins can be found <a href="examples/plugin">here</a>.</p>
<h2 dir="auto"><a id="user-content-examples" class="anchor" aria-hidden="true" tabindex="-1" href="#examples"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Examples</h2>
<p dir="auto">Examples can be found in the <a href="https://github.com/bazelbuild/rules_kotlin/tree/master/examples">examples directory</a>, including usage with Android, Dagger, Node-JS, Kotlin compiler plugins, etc.</p>
<h1 dir="auto"><a id="user-content-history" class="anchor" aria-hidden="true" tabindex="-1" href="#history"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>History</h1>
<p dir="auto">These rules were initially forked from <a href="http://github.com/pubref/rules_kotlin">pubref/rules_kotlin</a>, and then re-forked from <a href="http://github.com/bazelbuild/rules_kotlin">bazelbuild/rules_kotlin</a>. They were merged back into this repository in October, 2019.</p>
<h1 dir="auto"><a id="user-content-license" class="anchor" aria-hidden="true" tabindex="-1" href="#license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>License</h1>
<p dir="auto">This project is licensed under the <a href="LICENSE">Apache 2.0 license</a>, as are all contributions</p>
<h1 dir="auto"><a id="user-content-contributing" class="anchor" aria-hidden="true" tabindex="-1" href="#contributing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Contributing</h1>
<p dir="auto">See the <a href="CONTRIBUTING.md">CONTRIBUTING</a> doc for information about how to contribute to
this project.</p>
</article></div>