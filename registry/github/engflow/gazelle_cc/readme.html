<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Gazelle C++ Extension</h1><a id="user-content-gazelle-c-extension" class="anchor" aria-label="Permalink: Gazelle C++ Extension" href="#gazelle-c-extension"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This repository contains a <a href="https://github.com/bazel-contrib/bazel-gazelle">Gazelle</a> extension for C++ projects.</p>
<p dir="auto">Gazelle is a build file generator for Bazel projects. This extension adds support for automatically generating and maintaining BUILD files for C/C++ codebases.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Installation</h2><a id="user-content-installation" class="anchor" aria-label="Permalink: Installation" href="#installation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Using Bzlmod</h3><a id="user-content-using-bzlmod" class="anchor" aria-label="Permalink: Using Bzlmod" href="#using-bzlmod"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Add the following to your <code>MODULE.bazel</code> file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel_dep(name = &quot;gazelle&quot;, version = &quot;0.42.0&quot;)
bazel_dep(name = &quot;gazelle_cc&quot;, version = &quot;0.1.0&quot;) # This extension, use the latest version

bazel_dep(name = &quot;rules_cc&quot;, version = &quot;0.1.1&quot;)"><pre><span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"gazelle"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"0.42.0"</span>)
<span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"gazelle_cc"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"0.1.0"</span>) <span class="pl-c"># This extension, use the latest version</span>

<span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_cc"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"0.1.1"</span>)</pre></div>
<p dir="auto">Add the <code>gazelle</code> task in the top-level <code>BUILD.bazel</code> file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@gazelle//:def.bzl&quot;, &quot;gazelle&quot;, &quot;gazelle_binary&quot;)

# Define a gazelle binary with a list of enabled extensions
gazelle_binary(
    name = &quot;gazelle_cc&quot;,
    languages = [
        &quot;@gazelle//language/proto&quot;,  # Optional, should be defined before cc 
        &quot;@gazelle_cc//language/cc&quot;,
    ],
)

# `gazelle` rule can be used to provide additional arguments, eg. for CI integration
gazelle(
    name = &quot;gazelle&quot;,
    gazelle = &quot;:gazelle_cc&quot;,
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@gazelle//:def.bzl"</span>, <span class="pl-s">"gazelle"</span>, <span class="pl-s">"gazelle_binary"</span>)

<span class="pl-c"># Define a gazelle binary with a list of enabled extensions</span>
<span class="pl-en">gazelle_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"gazelle_cc"</span>,
    <span class="pl-s1">languages</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"@gazelle//language/proto"</span>,  <span class="pl-c"># Optional, should be defined before cc </span>
        <span class="pl-s">"@gazelle_cc//language/cc"</span>,
    ],
)

<span class="pl-c"># `gazelle` rule can be used to provide additional arguments, eg. for CI integration</span>
<span class="pl-en">gazelle</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"gazelle"</span>,
    <span class="pl-s1">gazelle</span> <span class="pl-c1">=</span> <span class="pl-s">":gazelle_cc"</span>,
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Using WORKSPACE</h3><a id="user-content-using-workspace" class="anchor" aria-label="Permalink: Using WORKSPACE" href="#using-workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>gazelle_cc</code> is built and distributed using Bazel modules. While it can still be used with legacy <code>WORKSPACE</code> definitions—especially for users on Bazel 8.x — this setup is not the primary focus and may not receive the same level of testing. Note that Bazel has announced plans to remove support for <code>WORKSPACE</code> in version 9.0, so users are encouraged to migrate to Bazel modules when possible.</p>
<p dir="auto">For instructions how to setup <code>gazelle_cc</code> using WORKSPACEs visit <a href="./docs/workspace_setup.md">this guide</a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Custom Directives</h2><a id="user-content-custom-directives" class="anchor" aria-label="Permalink: Custom Directives" href="#custom-directives"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The extension defines the following custom directives:</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code># gazelle:cc_group [directory|unit]</code></h3><a id="user-content--gazellecc_group-directoryunit" class="anchor" aria-label="Permalink: # gazelle:cc_group [directory|unit]" href="#-gazellecc_group-directoryunit"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Controls how C++ source files are grouped into rules:</p>
<ul dir="auto">
<li><code>directory</code>: Creates one <code>cc_library</code> per directory <strong>(default)</strong></li>
<li><code>unit</code>: Creates one <code>cc_library</code>/<code>cc_test</code> per translation unit or group of cyclicly dependent translation units. Corresponding <code>.h</code> and <code>.cc</code> files are always defined in the same group</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code># gazelle:cc_group_unit_cycles [merge|warn]</code></h3><a id="user-content--gazellecc_group_unit_cycles-mergewarn" class="anchor" aria-label="Permalink: # gazelle:cc_group_unit_cycles [merge|warn]" href="#-gazellecc_group_unit_cycles-mergewarn"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Controls how to handle cyclic dependencies between translation units:</p>
<ul dir="auto">
<li><code>merge</code>: All groups forming a cycle will be merged into a single one <strong>(default)</strong></li>
<li><code>warn</code>: Don't modify rules forming a cycle, let user handle it manually</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code># gazelle:cc_generate [true|false]</code></h3><a id="user-content--gazellecc_generate-truefalse" class="anchor" aria-label="Permalink: # gazelle:cc_generate [true|false]" href="#-gazellecc_generate-truefalse"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Specifies whether Gazelle should create C/C++ specific targets, e.g. <code>cc_library</code> (default: <code>true</code>).
Setting this to <code>false</code> disables rule generation in the current directory and its subdirectories, allowing manual rule management instead.
Existing <code>cc_library</code> rules are still indexed and may be used to resolve internal dependencies.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code># gazelle:cc_generate_proto [true|false]</code></h3><a id="user-content--gazellecc_generate_proto-truefalse" class="anchor" aria-label="Permalink: # gazelle:cc_generate_proto [true|false]" href="#-gazellecc_generate_proto-truefalse"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Specifies whether Gazelle should create <code>cc_proto_library</code> targets (default: <code>true</code>).
It can override the broader <code># gazelle:proto</code> setting, letting you suppress proto-target generation specifically for C/C++ rules.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code># gazelle:cc_use_builtin_bzlmod_index [true|false]</code></h3><a id="user-content--gazellecc_use_builtin_bzlmod_index-truefalse" class="anchor" aria-label="Permalink: # gazelle:cc_use_builtin_bzlmod_index [true|false]" href="#-gazellecc_use_builtin_bzlmod_index-truefalse"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Specifies wheter Gazelle should use built-in index to resolve external dependencies provided using <code>bazel_dep</code>. See <a href="#bazel_dep">External dependencies / bazel_dep section</a> for more details.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code># gazelle:cc_indexfile &lt;path&gt;</code></h3><a id="user-content--gazellecc_indexfile-path" class="anchor" aria-label="Permalink: # gazelle:cc_indexfile &lt;path&gt;" href="#-gazellecc_indexfile-path"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Loads an index file, containing a map from header include paths to Bazel labels.
An index lets Gazelle resolve dependencies on targets outside the current project,
for example, those provided by a Bazel module or separate package manager.
Equivalently, you can use <code># gazelle:resolve</code> directives, but you can more easily
generate these mappings in bulk with an index file.
See <a href="#external-dependencies">external dependenices section</a> for instructions on
generating index files.</p>
<p dir="auto">Multiple <code>cc_indexfile</code> directives can be used, and their values are inherited by subprojects.
To clear inherited cc_indexfile values, provide an empty argument, e.g. <code># gazelle:cc_indexfile</code>.
When resolving dependencies, indexes are visited in the same order as the corresponding <code>cc_indexfile</code> definitions.</p>
<p dir="auto">The argument must be a repository-root relative path.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code># gazelle:cc_search &lt;strip_include_prefix&gt; &lt;include_prefix&gt;</code></h3><a id="user-content--gazellecc_search-strip_include_prefix-include_prefix" class="anchor" aria-label="Permalink: # gazelle:cc_search &lt;strip_include_prefix&gt; &lt;include_prefix&gt;" href="#-gazellecc_search-strip_include_prefix-include_prefix"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Lazy indexing may be enabled with the Gazelle arguments <code>-index=lazy</code> and <code>-r=false</code>. When enabled, Gazelle only indexes libraries for dependency resolution in specific directories, based on configuration directives and the included headers it sees. This dramatically speeds up Gazelle when run in specific directories, compared with indexing the whole repository.</p>
<p dir="auto">The <code>cc_search</code> directive configures Gazelle for C++ lazy indexing, adding a rule that translates header paths into directories to search.</p>
<p dir="auto">For example, suppose you have a library in the directory <code>third_party/foo/</code> with the label <code>//third_party/foo:foo</code>. It has a header file in <code>third_party/foo/inc/foo.h</code> that you include from your main source code as <code>foo/foo.h</code>. The library's <code>cc_library</code> target might be written as:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="cc_library(
    name = &quot;foo&quot;,
    hdrs = [&quot;inc/foo.h&quot;],
    strip_include_prefix = &quot;third_party/foo/inc&quot;,
    include_prefix = &quot;foo&quot;,
    visibility = [&quot;//visibility:public&quot;],
)"><pre><span class="pl-en">cc_library</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"foo"</span>,
    <span class="pl-s1">hdrs</span> <span class="pl-c1">=</span> [<span class="pl-s">"inc/foo.h"</span>],
    <span class="pl-s1">strip_include_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"third_party/foo/inc"</span>,
    <span class="pl-s1">include_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"foo"</span>,
    <span class="pl-s1">visibility</span> <span class="pl-c1">=</span> [<span class="pl-s">"//visibility:public"</span>],
)</pre></div>
<p dir="auto">You can tell Gazelle where to find this library using the directive:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# gazelle:cc_search foo third_party/foo"><pre class="notranslate"><code># gazelle:cc_search foo third_party/foo
</code></pre></div>
<p dir="auto">The <code>cc_search</code> directive accepts two arguments: a prefix to strip, and a prefix to add, analogous to <code>strip_include_prefix</code> and <code>include_prefix</code>. Both arguments must be clean slash-separated relative paths. Arguments may be quoted, so empty strings may be written as <code>''</code> or <code>""</code>.</p>
<p dir="auto"><code>gazelle_cc</code> first removes the prefix to strip, so <code>foo/foo.h</code> becomes <code>foo.h</code> in the example above. If the include path does not start with the prefix, the search rule is ignored. Then, <code>gazelle_cc</code> prepends the prefix to add, so <code>foo.h</code> becomes <code>third_party/foo/foo.h</code>. Finally, <code>gazelle_cc</code> trims the basename, to get the directory <code>third_party/foo</code>. Gazelle indexes all library rules in this directory, making them available for dependency resolution.</p>
<p dir="auto">You can specify <code>cc_search</code> directives multiple times. A directive applies to the directory where it's written and to subdirectories. An empty <code>cc_search</code> directive resets the list of translation rules for the current directory.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code># gazelle:cc_unresolved_deps [ignore|warn|error_fast|error]</code></h3><a id="user-content--gazellecc_unresolved_deps-ignorewarnerror_fasterror" class="anchor" aria-label="Permalink: # gazelle:cc_unresolved_deps [ignore|warn|error_fast|error]" href="#-gazellecc_unresolved_deps-ignorewarnerror_fasterror"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Controls how to react in case of unresolved <code>#include</code> directive (see <a href="#dependency-resolution">Dependency Resolution section</a>). Only quoted paths (<code>#include "..."</code>) are affected; paths in brackets (<code>#include &lt;...&gt;</code>) are treated as system includes and won't raise any warning regardless of the selected option. The following options are possible:</p>
<ul dir="auto">
<li><code>ignore</code>: Do nothing with the unresolved dependencies</li>
<li><code>warn</code>: Raise a warning on every encountered unresolved <code>#include</code> and proceed with further processing <strong>(default)</strong></li>
<li><code>error_fast</code>: Raise an error on the first encountered unresolved <code>#include</code> and immediately stop further processing with a non-zero return code; <code>BUILD</code> files won't be changed then</li>
<li><code>error</code>: Raise an error after collecting all unresolved <code>#include</code> directives and stop further processing with a non-zero return code; <code>BUILD</code> files won't be changed then</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code># gazelle:cc_platform &lt;os&gt; &lt;arch&gt; &lt;constraint_label&gt; [&lt;macro&gt;=&lt;value&gt; …]</code></h3><a id="user-content--gazellecc_platform-os-arch-constraint_label-macrovalue-" class="anchor" aria-label="Permalink: # gazelle:cc_platform &lt;os&gt; &lt;arch&gt; &lt;constraint_label&gt; [&lt;macro&gt;=&lt;value&gt; …]" href="#-gazellecc_platform-os-arch-constraint_label-macrovalue-"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Tells gazelle_cc to emit a platform-aware <code>select()</code> statement for header dependencies whose <code>#include</code> directives are wrapped in pre-processor conditions (<code>#if</code>, <code>#ifdef</code>, etc).</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;os&gt;</code></td>
<td>Operating-system that identifies the platform (e.g. <code>linux</code>, <code>darwin</code>).<br>Valid values follow the constraint settings in <a href="https://github.com/bazelbuild/platforms/blob/1.0.0/os/BUILD"><code>@platforms//os</code></a>.<br>This value combined with <code>&lt;arch&gt;</code> is also used to setup default, well known platform specific macro definitions, e.g. <code>_WIN32</code>, <code>__APPLE__</code>, <code>__unix__</code></td>
</tr>
<tr>
<td><code>&lt;arch&gt;</code></td>
<td>The CPU architecture that identifies the platform (e.g. <code>amd64</code>, <code>aarch64</code>).Valid values follow the constraint settings in  <a href="https://github.com/bazelbuild/platforms/blob/1.0.0/cpu/BUILD"><code>@platforms//cpu</code></a>.</td>
</tr>
<tr>
<td><code>&lt;constraint_label&gt;</code></td>
<td>A Bazel label that will be used inside the generated <code>select()</code> for this platform.</td>
</tr>
<tr>
<td><code>[&lt;macro&gt;=&lt;value&gt;]</code></td>
<td>Optional compile-time macros that are <strong>always</strong> true on this platform.<br>Only integer literals are allowed. A bare identifier (e.g. <code>TARGET_OS_MAC</code>) is treated as <code>&lt;macro&gt;=1</code>.</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">Example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# BUILD.bazel
# gazelle:cc_platform windows x86_64 @platforms//os:windows
# gazelle:cc_platform osx aarch64 //platforms/macos_arm USING_MAC USING_ARM64=1"><pre><span class="pl-c"># BUILD.bazel</span>
<span class="pl-c"># gazelle:cc_platform windows x86_64 @platforms//os:windows</span>
<span class="pl-c"># gazelle:cc_platform osx aarch64 //platforms/macos_arm USING_MAC USING_ARM64=1</span></pre></div>
<div class="highlight highlight-source-c notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="// source.cc
#include &quot;shared.h&quot;
#if defined(_WIN32)
   #include &quot;win_impl.h&quot;
#elif USING_MAC
   #include &quot;mac_impl.h&quot;
#else
   #include &quot;unix_impl.h&quot;
#endif"><pre><span class="pl-c">// source.cc</span>
<span class="pl-k">#include</span> <span class="pl-s">"shared.h"</span>
<span class="pl-k">#if</span> defined(<span class="pl-s1">_WIN32</span>)
   <span class="pl-k">#include</span> <span class="pl-s">"win_impl.h"</span>
<span class="pl-k">#elif</span> <span class="pl-c1">USING_MAC</span>
   <span class="pl-k">#include</span> <span class="pl-s">"mac_impl.h"</span>
<span class="pl-k">#else</span>
   <span class="pl-k">#include</span> <span class="pl-s">"unix_impl.h"</span>
<span class="pl-k">#endif</span></pre></div>
<p dir="auto">Running the <code>gazelle_cc</code> would emit</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="cc_library(
   name = &quot;source&quot;,
   srcs = [&quot;source.cc&quot;],
   implementation_deps = [&quot;:shared&quot;] + select({
      &quot;@platforms//os:windows&quot;: [&quot;:win_impl&quot;],
      &quot;//platforms:macos_arm&quot;:  [&quot;:mac_impl&quot;],
      &quot;//conditions:default&quot;:   [&quot;:unix_impl&quot;],
   })
)"><pre><span class="pl-en">cc_library</span>(
   <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"source"</span>,
   <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [<span class="pl-s">"source.cc"</span>],
   <span class="pl-s1">implementation_deps</span> <span class="pl-c1">=</span> [<span class="pl-s">":shared"</span>] <span class="pl-c1">+</span> <span class="pl-en">select</span>({
      <span class="pl-s">"@platforms//os:windows"</span>: [<span class="pl-s">":win_impl"</span>],
      <span class="pl-s">"//platforms:macos_arm"</span>:  [<span class="pl-s">":mac_impl"</span>],
      <span class="pl-s">"//conditions:default"</span>:   [<span class="pl-s">":unix_impl"</span>],
   })
)</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Rules for target rule selection</h2><a id="user-content-rules-for-target-rule-selection" class="anchor" aria-label="Permalink: Rules for target rule selection" href="#rules-for-target-rule-selection"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The extension automatically selects the appropriate rule type based on the following criteria:</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Rule Type Selection</h3><a id="user-content-rule-type-selection" class="anchor" aria-label="Permalink: Rule Type Selection" href="#rule-type-selection"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ol dir="auto">
<li>
<p dir="auto"><strong>cc_library</strong>: Created for:</p>
<ul dir="auto">
<li>Header files (<code>.h</code>, <code>.hh</code>, <code>.hpp</code>, <code>.hxx</code>)</li>
<li>Source files that don't contain a <code>main()</code> function and aren't test files</li>
<li>Pregenerated <code>.pb.h</code> files in case when generation of <code>cc_proto_library</code> rules is disabled <code># gazelle:proto [legacy|disable|disable_global]</code></li>
</ul>
</li>
<li>
<p dir="auto"><strong>cc_binary</strong>: Created for:</p>
<ul dir="auto">
<li>Source files containing a <code>main()</code> function</li>
<li>Main function signature is detected only based on the source file content, it does not handle custom macros wrapping the <code>main</code> method</li>
</ul>
</li>
<li>
<p dir="auto"><strong>cc_test</strong>: Created for:</p>
<ul dir="auto">
<li>Files with names starting with <code>test</code> or ending with <code>test</code> suffix (excluding file extension)</li>
</ul>
</li>
<li>
<p dir="auto"><strong>cc_proto_library</strong>: Created for:</p>
<ul dir="auto">
<li>Each corresponding <code>proto_library</code> rule generated by <code>"@gazelle//language/proto</code></li>
<li>Generated only if <code>cc_proto_library</code> rules are enabled generation of rules, that is <code># gazelle:proto [default|file|package]</code></li>
</ul>
</li>
</ol>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Source Grouping</h3><a id="user-content-source-grouping" class="anchor" aria-label="Permalink: Source Grouping" href="#source-grouping"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Sources are grouped according to the <code>cc_group</code> directive:</p>
<ul dir="auto">
<li><strong>directory mode</strong>: All source files in a directory are grouped based on their kind. Generated <code>BUILD.bazel</code> would contain at most only one rule of <code>cc_library</code> and <code>cc_test</code> kind.</li>
<li><strong>unit mode</strong>: Files are grouped based on their dependencies:
<ul dir="auto">
<li>Header files and their corresponding implementation files are grouped together</li>
<li>Files with mutual dependencies form a single group</li>
<li>Cyclic dependencies are handled according to the <code>cc_group_unit_cycles</code> directive</li>
<li>The generated <code>BUILD.bazel</code> would contain multiple <code>cc_library</code> / <code>cc_test</code> rules, one for each group.</li>
</ul>
</li>
</ul>
<p dir="auto">The <code>cc_binary</code> rule is always generated once per found translation unit containing a <code>main</code> method</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Dependency Resolution</h2><a id="user-content-dependency-resolution" class="anchor" aria-label="Permalink: Dependency Resolution" href="#dependency-resolution"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Dependency resolution between both internal and external dependencies is based only on <code>#include</code> directives used in sources. Gazelle C++ extension parses the C/C++ source files to extract required information using preprocessor directives.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Internal dependencies</h3><a id="user-content-internal-dependencies" class="anchor" aria-label="Permalink: Internal dependencies" href="#internal-dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Every build target managed by Gazelle C++ extension registers information about the header files defined in <code>hdrs</code> attribute of each <code>cc_library</code> rule. It allows one to create an index of fully-qualified paths relative to the root directory of the repository.</p>
<p dir="auto">Each source file path extracted from <code>#include</code> directives is looked up in the index, if a target rule could be found it would be added to the list of rule dependencies.
In case of source-file relative includes the path is resolved based on the directory defining the source before the lookup.</p>
<p dir="auto">Rules/subdirectories that are not managed by the Gazelle do not populate the internal dependencies index and would not be automatically resolved. Gazelle can be instructed to use user defined resolution rules to work around this limitation</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# gazelle:resolve cc path/to/my_include.h //target/defining:library"><pre><span class="pl-c"># gazelle:resolve cc path/to/my_include.h //target/defining:library</span></pre></div>
<p dir="auto">would allow to resolve includes in your sources</p>
<div class="highlight highlight-source-c notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="#include &quot;path/to/my_include.h&quot; // Resolves to //target/defining:library
#include &quot;some/other/lib.hpp&quot;   // Unresolved, not dependency would be added"><pre><span class="pl-k">#include</span> <span class="pl-s">"path/to/my_include.h"</span> <span class="pl-c">// Resolves to //target/defining:library</span>
<span class="pl-k">#include</span> <span class="pl-s">"some/other/lib.hpp"</span>   <span class="pl-c">// Unresolved, not dependency would be added</span></pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">External dependencies</h3><a id="user-content-external-dependencies" class="anchor" aria-label="Permalink: External dependencies" href="#external-dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">External dependencies are resolved using similar mechanism as <a href="#internal-dependencies">internal dependencies</a>, but requiring always a fully-qualified path to the rule, based on <code>includes</code> and prefixes defined by library authors.</p>
<p dir="auto">The knowledge about the headers and their defining rules of external repositories is limited and depends on the used package manager.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto"><code>bazel_dep</code></h4><a id="user-content-bazel_dep" class="anchor" aria-label="Permalink: bazel_dep" href="#bazel_dep"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Gazelle C++ extension is using a <a href="./language/cc/bzldep-index.json">built-in index</a> created based on all the <code>cc_library</code> rules found in <a href="https://registry.bazel.build/" rel="nofollow">Bazel Central Registry</a> repositories.
The usage of built-in index can be controlled using <code># gazelle:cc_use_builtin_bzlmod_index &lt;true|false&gt;</code> directive.</p>
<p dir="auto">Currently that's the recommended way of defining external dependencies</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# MODULE.bazel
bazel_dep(name = &quot;googletest&quot;, version = &quot;1.16.0&quot;)
bazel_dep(name = &quot;fmt&quot;, version = &quot;11.1.4&quot;, repo_name = &quot;fmt_repo&quot;)"><pre><span class="pl-c"># MODULE.bazel</span>
<span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"googletest"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"1.16.0"</span>)
<span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"fmt"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"11.1.4"</span>, <span class="pl-s1">repo_name</span> <span class="pl-c1">=</span> <span class="pl-s">"fmt_repo"</span>)</pre></div>
<div class="highlight highlight-source-c++ notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="// source.cc
#include &quot;gmock/gmock.h&quot;          // Resolved to @googletest//:gtest
#include &lt;gmock/gmock-matchers.h&gt; // Resolved to @googletest//:gtest
#include &quot;fmt/core.h&quot;             // Resolved to @fmt_repo//:fmt
#include &quot;boost/chrono.hpp&quot;       // Warning: defined in @boost.chrono//:boost.chrono but not added as bazel_dep"><pre><span class="pl-c"><span class="pl-c">//</span> source.cc</span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">"</span>gmock/gmock.h<span class="pl-pds">"</span></span>          <span class="pl-c"><span class="pl-c">//</span> Resolved to @googletest//:gtest</span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">&lt;</span>gmock/gmock-matchers.h<span class="pl-pds">&gt;</span></span> <span class="pl-c"><span class="pl-c">//</span> Resolved to @googletest//:gtest</span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">"</span>fmt/core.h<span class="pl-pds">"</span></span>             <span class="pl-c"><span class="pl-c">//</span> Resolved to @fmt_repo//:fmt</span>
#<span class="pl-k">include</span> <span class="pl-s"><span class="pl-pds">"</span>boost/chrono.hpp<span class="pl-pds">"</span></span>       <span class="pl-c"><span class="pl-c">//</span> Warning: defined in @boost.chrono//:boost.chrono but not added as bazel_dep</span></pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto"><code>conan</code></h4><a id="user-content-conan" class="anchor" aria-label="Permalink: conan" href="#conan"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Resolving external dependencies managed by <a href="https://docs.conan.io/2/integrations/bazel.html" rel="nofollow">Conan</a> requires creation of index by the user using <code>@gazelle_cc//index/conan</code> binary.</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="conan profile detect 
conan install . --build=missing
bazel run @gazelle_cc//index/conan -- --output=conan.ccindex"><pre>conan profile detect 
conan install <span class="pl-c1">.</span> --build=missing
bazel run @gazelle_cc//index/conan -- --output=conan.ccindex</pre></div>
<p dir="auto">The resulting index needs to be added to Gazelle directive in top-level <code>BUILD</code> file.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# gazelle:cc_indexfile conan.ccindex"><pre><span class="pl-c"># gazelle:cc_indexfile conan.ccindex</span></pre></div>
<p dir="auto">Additional options for <code>@gazelle_cc//index/conan</code>:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Flag</th>
<th>Default</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>--output=&lt;path&gt;</td>
<td>./output.ccidx</td>
<td>Output file for created index</td>
</tr>
<tr>
<td>--install</td>
<td>false</td>
<td>Should conan profile detection and installation be done automatically before indexing</td>
</tr>
<tr>
<td>--conanDir=&lt;path&gt;</td>
<td>./conan</td>
<td>Controls the paths contains conan specific and external dependencies definitions. Typically created during <code>conan install .</code> invocation</td>
</tr>
<tr>
<td>--verbose</td>
<td>false</td>
<td>Enable verbose logging and debug information</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto"><code>rules_foreign_cc</code></h4><a id="user-content-rules_foreign_cc" class="anchor" aria-label="Permalink: rules_foreign_cc" href="#rules_foreign_cc"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Resolving external dependencies managed by <a href="https://github.com/bazel-contrib/rules_foreign_cc">rules_foreign_cc</a> requires creation of index by the user using <code>@gazelle_cc//index/rules_foreign_cc</code> binary. It would use <code>bazel query</code> to find definitions of <code>rules_foreign_cc</code> rules, eg. <code>cmake</code> and would use their assigned sources and rules to create an index.</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel run @gazelle_cc//index/rules_foreign_cc -- --output=foreign.ccindex"><pre>bazel run @gazelle_cc//index/rules_foreign_cc -- --output=foreign.ccindex</pre></div>
<p dir="auto">The resulting index needs to be added to Gazelle directive in top-level <code>BUILD</code> file.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# gazelle:cc_indexfile foreign.ccindex"><pre><span class="pl-c"># gazelle:cc_indexfile foreign.ccindex</span></pre></div>
<p dir="auto">Additional options for <code>@gazelle_cc//index/rules_foreign_cc</code>:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Flag</th>
<th>Default</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td>--output=&lt;path&gt;</td>
<td>./output.ccidx</td>
<td>Output file for created index</td>
</tr>
<tr>
<td>--verbose</td>
<td>false</td>
<td>Enable verbose logging and debug information</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Other package managers</h4><a id="user-content-other-package-managers" class="anchor" aria-label="Permalink: Other package managers" href="#other-package-managers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Other package managers like <a href="https://vcpkg.io/en/" rel="nofollow">vcpkg</a> are currently not yet supported. Please create an issue in this repository if you need additional integrations.</p>
<p dir="auto">These can still be used by defining a manual mapping between header and defining rules using <code># gazelle:resolve</code> directives</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">C++20 Modules support</h2><a id="user-content-c20-modules-support" class="anchor" aria-label="Permalink: C++20 Modules support" href="#c20-modules-support"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">C++20 modules are currently not supported, but are planned to be introduced in the future.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Example Usage</h2><a id="user-content-example-usage" class="anchor" aria-label="Permalink: Example Usage" href="#example-usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Here's an example of how to use the extension in your C++ project:</p>
<ol dir="auto">
<li>Provide the default configuration in <code>BUILD.bazel</code> created in <a href="#installation">installation step</a> and provide configuration for gazelle (optional):</li>
</ol>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="## Exclude following subtrees from being managed by gazelle. Be aware that it also prevents other targets from automatic dependency resolution in these modules using gazelle
# gazelle:exclude third-party
# gazelle:exclude examples/usage

## Define how the cc sources should be managed, use `unit` for small file-based targets. 
# gazelle:cc_group unit

## Warn if there are some unresolved cyclic dependencies between source files
# gazelle:cc_group_unit_cycles warn

## Overwrite how some C/C++ includes should be resolved  
# gazelle:resolve cc gtest/gtest.h @googletest//:gtest_main
# gazelle:resolve cc fmt.h @googletest//:gtest_main"><pre><span class="pl-c">## Exclude following subtrees from being managed by gazelle. Be aware that it also prevents other targets from automatic dependency resolution in these modules using gazelle</span>
<span class="pl-c"># gazelle:exclude third-party</span>
<span class="pl-c"># gazelle:exclude examples/usage</span>

<span class="pl-c">## Define how the cc sources should be managed, use `unit` for small file-based targets. </span>
<span class="pl-c"># gazelle:cc_group unit</span>

<span class="pl-c">## Warn if there are some unresolved cyclic dependencies between source files</span>
<span class="pl-c"># gazelle:cc_group_unit_cycles warn</span>

<span class="pl-c">## Overwrite how some C/C++ includes should be resolved  </span>
<span class="pl-c"># gazelle:resolve cc gtest/gtest.h @googletest//:gtest_main</span>
<span class="pl-c"># gazelle:resolve cc fmt.h @googletest//:gtest_main</span></pre></div>
<ol start="2" dir="auto">
<li>Run Gazelle to generate BUILD files:</li>
</ol>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel run //:gazelle"><pre>bazel run //:gazelle</pre></div>
<p dir="auto">This will:</p>
<ul dir="auto">
<li>Scan your C/C++ source files</li>
<li>Generate appropriate <code>cc_library</code>, <code>cc_proto_library</code>, <code>cc_binary</code>, and <code>cc_test</code> rules</li>
<li>Handle dependencies automatically</li>
<li>Group source files according to your directives</li>
</ul>
<p dir="auto">After running Gazelle, it will generate appropriate BUILD files with dependencies and visibility settings.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Contributing</h2><a id="user-content-contributing" class="anchor" aria-label="Permalink: Contributing" href="#contributing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">See <a href="CONTRIBUTING.md">CONTRIBUTING.md</a> for instructions on how to contribute to this project.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">License</h2><a id="user-content-license" class="anchor" aria-label="Permalink: License" href="#license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This project is licensed under the Apache License 2.0 - see the <a href="./LICENSE">LICENSE</a> file for details.</p>
</article></div>