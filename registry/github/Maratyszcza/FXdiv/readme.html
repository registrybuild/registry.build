<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">FXdiv</h1><a id="user-content-fxdiv" class="anchor" aria-label="Permalink: FXdiv" href="#fxdiv"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://github.com/Maratyszcza/FXdiv/blob/master/LICENSE"><img src="https://camo.githubusercontent.com/e01d410fbc7e0f75382a3c6a3c0f3d8da9b16a65d4ac0b4d5062965be690b689/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d4d49542532304c6963656e73652d626c75652e737667" alt="MIT License" data-canonical-src="https://img.shields.io/badge/License-MIT%20License-blue.svg" style="max-width: 100%;"></a>
<a href="https://travis-ci.org/Maratyszcza/FXdiv" rel="nofollow"><img src="https://camo.githubusercontent.com/72fd4a408c8a8ba54128ac5b892315a70dfc22334cd5ab26d26f41f4e03911a6/68747470733a2f2f696d672e736869656c64732e696f2f7472617669732f4d6172617479737a637a612f46586469762e737667" alt="Build Status" data-canonical-src="https://img.shields.io/travis/Maratyszcza/FXdiv.svg" style="max-width: 100%;"></a></p>
<p dir="auto">Header-only library for division via fixed-point multiplication by inverse</p>
<p dir="auto">On modern CPUs and GPUs integer division is several times slower than multiplication. FXdiv implements an algorithm to replace an integer division with a multiplication and two shifts. This algorithm improves performance when an application performs repeated divisions by the same divisor.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Features</h2><a id="user-content-features" class="anchor" aria-label="Permalink: Features" href="#features"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Integer division for <code>uint32_t</code>, <code>uint64_t</code>, and <code>size_t</code></li>
<li>Header-only library, no installation or build required</li>
<li>Compatible with C99, C++, OpenCL, and CUDA</li>
<li>Uses platform-specific compiler intrinsics for optimal performance</li>
<li>Covered with unit tests and microbenchmarks</li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Example</h2><a id="user-content-example" class="anchor" aria-label="Permalink: Example" href="#example"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="highlight highlight-source-c notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="#include &lt;fxdiv.h&gt;

/* Division of array by a constant: reference implementation */
void divide_array_c(size_t length, uint32_t array[], uint32_t divisor) {
  for (size_t i = 0; i &lt; length; i++) {
    array[i] /= divisor;
  }
}

/* Division of array by a constant: implementation with FXdiv */
void divide_array_fxdiv(size_t length, uint32_t array[], uint32_t divisor) {
  const struct fxdiv_divisor_uint32_t precomputed_divisor =
    fxdiv_init_uint32_t(divisor);
  for (size_t i = 0; i &lt; length; i++) {
    array[i] = fxdiv_quotient_uint32_t(array[i], precomputed_divisor);
  }
}"><pre><span class="pl-k">#include</span> <span class="pl-s">&lt;fxdiv.h&gt;</span>

<span class="pl-c">/* Division of array by a constant: reference implementation */</span>
<span class="pl-smi">void</span> <span class="pl-en">divide_array_c</span>(<span class="pl-smi">size_t</span> <span class="pl-s1">length</span>, <span class="pl-smi">uint32_t</span> <span class="pl-s1">array</span>[], <span class="pl-smi">uint32_t</span> <span class="pl-s1">divisor</span>) {
  <span class="pl-k">for</span> (<span class="pl-smi">size_t</span> <span class="pl-s1">i</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span>; <span class="pl-s1">i</span> <span class="pl-c1">&lt;</span> <span class="pl-s1">length</span>; <span class="pl-s1">i</span><span class="pl-c1">++</span>) {
    <span class="pl-s1">array</span>[<span class="pl-s1">i</span>] /= <span class="pl-s1">divisor</span>;
  }
}

<span class="pl-c">/* Division of array by a constant: implementation with FXdiv */</span>
<span class="pl-smi">void</span> <span class="pl-en">divide_array_fxdiv</span>(<span class="pl-smi">size_t</span> <span class="pl-s1">length</span>, <span class="pl-smi">uint32_t</span> <span class="pl-s1">array</span>[], <span class="pl-smi">uint32_t</span> <span class="pl-s1">divisor</span>) {
  <span class="pl-k">const</span> <span class="pl-k">struct</span> <span class="pl-smi">fxdiv_divisor_uint32_t</span> <span class="pl-s1">precomputed_divisor</span> <span class="pl-c1">=</span>
    <span class="pl-en">fxdiv_init_uint32_t</span>(<span class="pl-s1">divisor</span>);
  <span class="pl-k">for</span> (<span class="pl-smi">size_t</span> <span class="pl-s1">i</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span>; <span class="pl-s1">i</span> <span class="pl-c1">&lt;</span> <span class="pl-s1">length</span>; <span class="pl-s1">i</span><span class="pl-c1">++</span>) {
    <span class="pl-s1">array</span>[<span class="pl-s1">i</span>] <span class="pl-c1">=</span> <span class="pl-en">fxdiv_quotient_uint32_t</span>(<span class="pl-s1">array</span>[<span class="pl-s1">i</span>], <span class="pl-s1">precomputed_divisor</span>);
  }
}</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Status</h2><a id="user-content-status" class="anchor" aria-label="Permalink: Status" href="#status"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Currently working features:</p>
<table>
<thead>
<tr>
<th>Platform</th>
<th align="center">uint32_t</th>
<th align="center">uint64_t</th>
<th align="center">size_t</th>
</tr>
</thead>
<tbody>
<tr>
<td>x86-64 gcc</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>x86-64 clang</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>x86-64 MSVC</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>x86 gcc</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>x86 clang</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>x86 MSVC</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>ARMv7 gcc</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>ARMv7 clang</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>ARMv7 MSVC*</td>
<td align="center">Compiles</td>
<td align="center">Compiles</td>
<td align="center">Compiles</td>
</tr>
<tr>
<td>ARM64 gcc</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>ARM64 clang</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>ARM64 MSVC*</td>
<td align="center">Compiles</td>
<td align="center">Compiles</td>
<td align="center">Compiles</td>
</tr>
<tr>
<td>PPC64 gcc</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>WAsm clang</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>Asm.js clang</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>PNaCl clang</td>
<td align="center">Works</td>
<td align="center">Works</td>
<td align="center">Works</td>
</tr>
<tr>
<td>CUDA</td>
<td align="center">Untested</td>
<td align="center">Untested</td>
<td align="center">Untested</td>
</tr>
<tr>
<td>OpenCL</td>
<td align="center">Untested</td>
<td align="center">Untested</td>
<td align="center">Untested</td>
</tr>
</tbody>
</table>
<p dir="auto">*ARMv7 and ARM64 builds with MSVC are presumed to work, but were only verified to compile successfully</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">References</h2><a id="user-content-references" class="anchor" aria-label="Permalink: References" href="#references"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Granlund, Torbj√∂rn, and Peter L. Montgomery. "Division by invariant integers using multiplication." In ACM SIGPLAN Notices, vol. 29, no. 6, pp. 61-72. ACM, 1994. Available: <a href="https://gmplib.org/~tege/divcnst-pldi94.pdf" rel="nofollow">gmplib.org/~tege/divcnst-pldi94.pdf</a></li>
</ul>
</article></div>