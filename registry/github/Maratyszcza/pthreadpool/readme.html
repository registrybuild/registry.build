<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">pthreadpool</h1><a id="user-content-pthreadpool" class="anchor" aria-label="Permalink: pthreadpool" href="#pthreadpool"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://github.com/Maratyszcza/pthreadpool/blob/master/LICENSE"><img src="https://camo.githubusercontent.com/a2645b9f4ff9a17425d9da54670d27ac353a168cb8375a3e9bf34d394bb149ab/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4c6963656e73652d425344253230322d2d436c6175736525323025323253696d706c69666965642532322532304c6963656e73652d626c75652e737667" alt="BSD (2 clause) License" data-canonical-src="https://img.shields.io/badge/License-BSD%202--Clause%20%22Simplified%22%20License-blue.svg" style="max-width: 100%;"></a>
<a href="https://travis-ci.org/Maratyszcza/pthreadpool" rel="nofollow"><img src="https://camo.githubusercontent.com/2c163781e7b76eb0de9c7ad9b1793fcab188561e59fcd06dddea80e8b0ef9cb8/68747470733a2f2f696d672e736869656c64732e696f2f7472617669732f4d6172617479737a637a612f70746872656164706f6f6c2e737667" alt="Build Status" data-canonical-src="https://img.shields.io/travis/Maratyszcza/pthreadpool.svg" style="max-width: 100%;"></a></p>
<p dir="auto"><strong>pthreadpool</strong> is a portable and efficient thread pool implementation.
It provides similar functionality to <code>#pragma omp parallel for</code>, but with additional features.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Features:</h2><a id="user-content-features" class="anchor" aria-label="Permalink: Features:" href="#features"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>C interface (C++-compatible).</li>
<li>1D-6D loops with step parameters.</li>
<li>Run on user-specified or auto-detected number of threads.</li>
<li>Work-stealing scheduling for efficient work balancing.</li>
<li>Wait-free synchronization of work items.</li>
<li>Compatible with Linux (including Android), macOS, iOS, Windows, Emscripten environments.</li>
<li>100% unit tests coverage.</li>
<li>Throughput and latency microbenchmarks.</li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Example</h2><a id="user-content-example" class="anchor" aria-label="Permalink: Example" href="#example"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The following example demonstates using the thread pool for parallel addition of two arrays:</p>
<div class="highlight highlight-source-c notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="static void add_arrays(struct array_addition_context* context, size_t i) {
  context-&gt;sum[i] = context-&gt;augend[i] + context-&gt;addend[i];
}

#define ARRAY_SIZE 4

int main() {
  double augend[ARRAY_SIZE] = { 1.0, 2.0, 4.0, -5.0 };
  double addend[ARRAY_SIZE] = { 0.25, -1.75, 0.0, 0.5 };
  double sum[ARRAY_SIZE];

  pthreadpool_t threadpool = pthreadpool_create(0);
  assert(threadpool != NULL);

  const size_t threads_count = pthreadpool_get_threads_count(threadpool);
  printf(&quot;Created thread pool with %zu threads\n&quot;, threads_count);

  struct array_addition_context context = { augend, addend, sum };
  pthreadpool_parallelize_1d(threadpool,
    (pthreadpool_task_1d_t) add_arrays,
    (void*) &amp;context,
    ARRAY_SIZE,
    PTHREADPOOL_FLAG_DISABLE_DENORMALS /* flags */);

  pthreadpool_destroy(threadpool);
  threadpool = NULL;

  printf(&quot;%8s\t%.2lf\t%.2lf\t%.2lf\t%.2lf\n&quot;, &quot;Augend&quot;,
    augend[0], augend[1], augend[2], augend[3]);
  printf(&quot;%8s\t%.2lf\t%.2lf\t%.2lf\t%.2lf\n&quot;, &quot;Addend&quot;,
    addend[0], addend[1], addend[2], addend[3]);
  printf(&quot;%8s\t%.2lf\t%.2lf\t%.2lf\t%.2lf\n&quot;, &quot;Sum&quot;,
    sum[0], sum[1], sum[2], sum[3]);

  return 0;
}"><pre><span class="pl-k">static</span> <span class="pl-smi">void</span> <span class="pl-en">add_arrays</span>(<span class="pl-k">struct</span> <span class="pl-smi">array_addition_context</span><span class="pl-c1">*</span> <span class="pl-s1">context</span>, <span class="pl-smi">size_t</span> <span class="pl-s1">i</span>) {
  <span class="pl-s1">context</span><span class="pl-c1">-&gt;</span><span class="pl-c1">sum</span>[<span class="pl-s1">i</span>] <span class="pl-c1">=</span> <span class="pl-s1">context</span><span class="pl-c1">-&gt;</span><span class="pl-c1">augend</span>[<span class="pl-s1">i</span>] <span class="pl-c1">+</span> <span class="pl-s1">context</span><span class="pl-c1">-&gt;</span><span class="pl-c1">addend</span>[<span class="pl-s1">i</span>];
}

<span class="pl-k">#define</span> <span class="pl-c1">ARRAY_SIZE</span> 4

<span class="pl-smi">int</span> <span class="pl-en">main</span>() {
  <span class="pl-smi">double</span> <span class="pl-s1">augend</span>[<span class="pl-c1">ARRAY_SIZE</span>] <span class="pl-c1">=</span> { <span class="pl-c1">1.0</span>, <span class="pl-c1">2.0</span>, <span class="pl-c1">4.0</span>, <span class="pl-c1">-5.0</span> };
  <span class="pl-smi">double</span> <span class="pl-s1">addend</span>[<span class="pl-c1">ARRAY_SIZE</span>] <span class="pl-c1">=</span> { <span class="pl-c1">0.25</span>, <span class="pl-c1">-1.75</span>, <span class="pl-c1">0.0</span>, <span class="pl-c1">0.5</span> };
  <span class="pl-smi">double</span> <span class="pl-s1">sum</span>[<span class="pl-c1">ARRAY_SIZE</span>];

  <span class="pl-smi">pthreadpool_t</span> <span class="pl-s1">threadpool</span> <span class="pl-c1">=</span> <span class="pl-en">pthreadpool_create</span>(<span class="pl-c1">0</span>);
  <span class="pl-en">assert</span>(<span class="pl-s1">threadpool</span> <span class="pl-c1">!=</span> <span class="pl-c1">NULL</span>);

  <span class="pl-k">const</span> <span class="pl-smi">size_t</span> <span class="pl-s1">threads_count</span> <span class="pl-c1">=</span> <span class="pl-en">pthreadpool_get_threads_count</span>(<span class="pl-s1">threadpool</span>);
  <span class="pl-en">printf</span>(<span class="pl-s">"Created thread pool with %zu threads\n"</span>, <span class="pl-s1">threads_count</span>);

  <span class="pl-k">struct</span> <span class="pl-smi">array_addition_context</span> <span class="pl-s1">context</span> <span class="pl-c1">=</span> { <span class="pl-s1">augend</span>, <span class="pl-s1">addend</span>, <span class="pl-s1">sum</span> };
  <span class="pl-en">pthreadpool_parallelize_1d</span>(<span class="pl-s1">threadpool</span>,
    (<span class="pl-smi">pthreadpool_task_1d_t</span>) <span class="pl-s1">add_arrays</span>,
    (<span class="pl-smi">void</span><span class="pl-c1">*</span>) <span class="pl-c1">&amp;</span><span class="pl-s1">context</span>,
    <span class="pl-c1">ARRAY_SIZE</span>,
    <span class="pl-c1">PTHREADPOOL_FLAG_DISABLE_DENORMALS</span> <span class="pl-c">/* flags */</span>);

  <span class="pl-en">pthreadpool_destroy</span>(<span class="pl-s1">threadpool</span>);
  <span class="pl-s1">threadpool</span> <span class="pl-c1">=</span> <span class="pl-c1">NULL</span>;

  <span class="pl-en">printf</span>(<span class="pl-s">"%8s\t%.2lf\t%.2lf\t%.2lf\t%.2lf\n"</span>, <span class="pl-s">"Augend"</span>,
    <span class="pl-s1">augend</span>[<span class="pl-c1">0</span>], <span class="pl-s1">augend</span>[<span class="pl-c1">1</span>], <span class="pl-s1">augend</span>[<span class="pl-c1">2</span>], <span class="pl-s1">augend</span>[<span class="pl-c1">3</span>]);
  <span class="pl-en">printf</span>(<span class="pl-s">"%8s\t%.2lf\t%.2lf\t%.2lf\t%.2lf\n"</span>, <span class="pl-s">"Addend"</span>,
    <span class="pl-s1">addend</span>[<span class="pl-c1">0</span>], <span class="pl-s1">addend</span>[<span class="pl-c1">1</span>], <span class="pl-s1">addend</span>[<span class="pl-c1">2</span>], <span class="pl-s1">addend</span>[<span class="pl-c1">3</span>]);
  <span class="pl-en">printf</span>(<span class="pl-s">"%8s\t%.2lf\t%.2lf\t%.2lf\t%.2lf\n"</span>, <span class="pl-s">"Sum"</span>,
    <span class="pl-s1">sum</span>[<span class="pl-c1">0</span>], <span class="pl-s1">sum</span>[<span class="pl-c1">1</span>], <span class="pl-s1">sum</span>[<span class="pl-c1">2</span>], <span class="pl-s1">sum</span>[<span class="pl-c1">3</span>]);

  <span class="pl-k">return</span> <span class="pl-c1">0</span>;
}</pre></div>
</article></div>