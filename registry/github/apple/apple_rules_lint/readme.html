<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 dir="auto"><a id="user-content-apple_rules_lint" class="anchor" aria-hidden="true" href="#apple_rules_lint"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>apple_rules_lint</h1>
<p dir="auto">A linting framework for Bazel</p>
<h2 dir="auto"><a id="user-content-users" class="anchor" aria-hidden="true" href="#users"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Users</h2>
<p dir="auto">You must load and configure the linting framework before anything else.
This is because later rulesets that depend on the linting framework will
attempt to ensure that linters are configured by registering no-op
implmentations of lint configs. You can do this by:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# WORKSPACE

load(&quot;@apple_rules_lint//lint:repositories.bzl&quot;, &quot;lint_deps&quot;)

lint_deps()

load(&quot;@apple_rules_lint//lint:setup.bzl&quot;, &quot;lint_setup&quot;)

lint_setup({
    &quot;java-checkstyle&quot;: &quot;//your:checkstyle-config&quot;,
})"><pre lang="py" class="notranslate"><code># WORKSPACE

load("@apple_rules_lint//lint:repositories.bzl", "lint_deps")

lint_deps()

load("@apple_rules_lint//lint:setup.bzl", "lint_setup")

lint_setup({
    "java-checkstyle": "//your:checkstyle-config",
})
</code></pre></div>
<p dir="auto">Alternatively, using Bzlmod:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# MODULE.bazel
bazel_dep(name = &quot;apple_rules_lint&quot;, version = &quot;0.1.1&quot;)

linter = use_extension(&quot;@apple_rules_lint//lint:extensions.bzl&quot;, &quot;linter&quot;)
linter.configure(name = &quot;java-checkstyle&quot;, config = &quot;//your:checkstyle-config&quot;)"><pre lang="py" class="notranslate"><code># MODULE.bazel
bazel_dep(name = "apple_rules_lint", version = "0.1.1")

linter = use_extension("@apple_rules_lint//lint:extensions.bzl", "linter")
linter.configure(name = "java-checkstyle", config = "//your:checkstyle-config")
</code></pre></div>
<p dir="auto">You may override specific lint configurations on a per-package basis by:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# BUILD.bazel

load(&quot;@apple_rules_lint//lint:defs.bzl&quot;, &quot;package_lint_config&quot;)

package_lint_config({
    &quot;java-checkstyle&quot;: &quot;:alternative-checkstyle-config&quot;,
})"><pre lang="py" class="notranslate"><code># BUILD.bazel

load("@apple_rules_lint//lint:defs.bzl", "package_lint_config")

package_lint_config({
    "java-checkstyle": ":alternative-checkstyle-config",
})
</code></pre></div>
<h3 dir="auto"><a id="user-content-api-documentation" class="anchor" aria-hidden="true" href="#api-documentation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>API Documentation</h3>
<p dir="auto">Can be found in <a href="api.md">the api docs</a></p>
<h2 dir="auto"><a id="user-content-ruleset-authors" class="anchor" aria-hidden="true" href="#ruleset-authors"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Ruleset Authors</h2>
<h3 dir="auto"><a id="user-content-workspace-setup" class="anchor" aria-hidden="true" href="#workspace-setup"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>WORKSPACE setup</h3>
<p dir="auto">To add linter support to your repo, add this to...</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# repositories.bzl
load(&quot;@apple_rules_lint//lint:repositories.bzl&quot;, &quot;lint_deps&quot;)

lint_deps()"><pre lang="py" class="notranslate"><code># repositories.bzl
load("@apple_rules_lint//lint:repositories.bzl", "lint_deps")

lint_deps()
</code></pre></div>
<p dir="auto">Then add this to...</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# setup.bzl
load(&quot;@apple_rules_lint//lint:setup.bzl&quot;, &quot;ruleset_lint_setup&quot;)

ruleset_lint_setup()"><pre lang="py" class="notranslate"><code># setup.bzl
load("@apple_rules_lint//lint:setup.bzl", "ruleset_lint_setup")

ruleset_lint_setup()
</code></pre></div>
<h3 dir="auto"><a id="user-content-bzlmod-setup" class="anchor" aria-hidden="true" href="#bzlmod-setup"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Bzlmod setup</h3>
<p dir="auto">Add:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# MODULE.bazel

bazel_dep(name = &quot;apple_rules_lint&quot;, version = &quot;0.1.1&quot;)

linter = use_extension(&quot;@apple_rules_lint//lint:extensions.bzl&quot;, &quot;linter&quot;)
linter.register(name = &quot;java-checkstyle&quot;)"><pre lang="py" class="notranslate"><code># MODULE.bazel

bazel_dep(name = "apple_rules_lint", version = "0.1.1")

linter = use_extension("@apple_rules_lint//lint:extensions.bzl", "linter")
linter.register(name = "java-checkstyle")
</code></pre></div>
<h3 dir="auto"><a id="user-content-getting-the-configured-config-for-a-linter" class="anchor" aria-hidden="true" href="#getting-the-configured-config-for-a-linter"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Getting the configured config for a linter</h3>
<p dir="auto">To obtain the currently configured config for a ruleset, use:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# your_rules.bzl

load(&quot;@apple_rules_lint//lint:defs.bzl&quot;, &quot;get_lint_config&quot;)

config = get_lint_config(&quot;java-checkstyle&quot;, tags)
if config != None:
    # set up lint targets
    pass"><pre lang="py" class="notranslate"><code># your_rules.bzl

load("@apple_rules_lint//lint:defs.bzl", "get_lint_config")

config = get_lint_config("java-checkstyle", tags)
if config != None:
    # set up lint targets
    pass
</code></pre></div>
<p dir="auto">Where <code>tags</code> are the tags of the rule to check.</p>
<h1 dir="auto"><a id="user-content-integrating-apple_rules_lint-with-your-rulesets" class="anchor" aria-hidden="true" href="#integrating-apple_rules_lint-with-your-rulesets"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a>Integrating <code>apple_rules_lint</code> With Your Rulesets</h1>
<p dir="auto">For the sake of this example, we'll show how <code>apple_rules_lint</code> is
integrated with the Selenium project, but the same process can be
followed for any linter:</p>
<ol dir="auto">
<li>
<p dir="auto">Wrap the linter with a <code>_test</code> rule, so you can run them with bazel
test. In Selenium, this is the
<a href="https://github.com/SeleniumHQ/selenium/blob/selenium-4.0.0-beta-1/java/private/spotbugs.bzl">spotbugs_test</a></p>
</li>
<li>
<p dir="auto">It is recommended, but not required, that your test return a <code>LinterInfo</code>
so that other tooling can detect whether this is a lint test.</p>
</li>
<li>
<p dir="auto">Create a config rule or a marker rule of some sort. For example,
<a href="https://github.com/SeleniumHQ/selenium/blob/selenium-4.0.0-beta-1/java/private/spotbugs_config.bzl">spotbugs_config</a></p>
</li>
<li>
<p dir="auto">Pick a "well known" name: <code>lang-tool</code> seems to work well (such as
<code>java-spotbugs</code>, but you might have <code>go-gofmt</code> or <code>py-black</code>)</p>
</li>
<li>
<p dir="auto">Create a macro that uses
<a href="./api.md#get_lint_config">get_lint_config</a> to look up the config
for you. If that's present, create a new instance of your test
rule. You can see this in action
<a href="https://github.com/SeleniumHQ/selenium/blob/selenium-4.0.0-beta-1/java/private/library.bzl">here</a>.</p>
</li>
<li>
<p dir="auto">As you write code, make sure your macro is called. If you're a
ruleset author, this can be as lightweight as exporting the macro created
above as the default way to call your rules.</p>
</li>
<li>
<p dir="auto">...</p>
</li>
<li>
<p dir="auto">Profit!</p>
</li>
</ol>
<p dir="auto">Users can then use the "well known" name to point to an instance of
the config rule in their <code>WORKSPACE</code> files:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="lint_setup({
    &quot;java-spotbugs&quot;: &quot;//java:spotbugs-config&quot;,
})"><pre lang="starlark" class="notranslate"><code>lint_setup({
    "java-spotbugs": "//java:spotbugs-config",
})
</code></pre></div>
</article></div>