<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Bazel Rules for Maven Repositories</h1><a id="user-content-bazel-rules-for-maven-repositories" class="anchor" aria-label="Permalink: Bazel Rules for Maven Repositories" href="#bazel-rules-for-maven-repositories"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">A bazel ruleset creating an idiomatic bazel representation of a maven repository using a
pinned list of artifacts.</p>
<p dir="auto">Release: <code>1.2.0</code> <br>
Prerelease: <code>2.0.0-alpha-5</code></p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th>Version</th>
<th>Sha</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://github.com/square/bazel_maven_repository/archive/1.2.0.zip">Release 1.2.0</a></td>
<td><code>9e23155895d2bfc60b35d2dfd88c91701892a7efba5afacdf00cebc0982229fe</code></td>
</tr>
<tr>
<td><a href="https://github.com/square/bazel_maven_repository/archive/2.0.0-alpha-5.zip">Prerelease 2.0.0-alpha-5</a></td>
<td><code>fde80cafa02a2c034cc8086c158f500e7b6ceb16d251273a6cc82f1c0723e0e8</code></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><strong><a href="http://tableofcontent.eu" rel="nofollow">Table of Contents</a></strong></p>
<ul dir="auto">
<li><a href="#overview">Overview</a></li>
<li><a href="#supported-types">Supported Types</a></li>
<li><a href="#inter-artifact-dependencies">Inter-artifact dependencies</a></li>
<li><a href="#coordinate-translation">Coordinate Translation</a></li>
<li><a href="#artifact-configuration">Artifact Configuration</a>
<ul dir="auto">
<li><a href="#sha-verification">Sha verification</a></li>
<li><a href="#testonly">Testonly</a></li>
<li><a href="#exclude">Exclude</a></li>
<li><a href="#include">Include</a></li>
<li><a href="#deps">Deps</a></li>
<li><a href="#substitution-of-build-targets">Substitution of build targets</a></li>
</ul>
</li>
<li><a href="#caching">Caching</a></li>
</ul>
<ul dir="auto">
<li><a href="#limitations">Limitations</a>
<ul dir="auto">
<li><a href="#other-usage-notes">Other Usage Notes</a>
<ul dir="auto">
<li><a href="#caches">Caches</a></li>
<li><a href="#clogged-workspace-files">Clogged WORKSPACE files</a></li>
<li><a href="#kotlin">Kotlin</a></li>
</ul>
</li>
<li><a href="#license">License</a></li>
</ul>
</li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Overview</h2><a id="user-content-overview" class="anchor" aria-label="Permalink: Overview" href="#overview"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><strong>Bazel Rules for Maven Repositories</strong> allow the specification of a list of artifacts which
constitute maven repository's universe of deps, and exposes these artifacts via a bazel <em>external workspace</em>.  The name of the repository specification rule becomes the repository name in Bazel.
For instance the following specification:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="MAVEN_REPOSITORY_RULES_VERSION = &quot;1.2.0&quot;
MAVEN_REPOSITORY_RULES_SHA = &quot;9e23155895d2bfc60b35d2dfd88c91701892a7efba5afacdf00cebc0982229fe&quot;
http_archive(
    name = &quot;maven_repository_rules&quot;,
    urls = [&quot;https://github.com/square/bazel_maven_repository/archive/%s.zip&quot; % MAVEN_REPOSITORY_RULES_VERSION],
    type = &quot;zip&quot;,
    strip_prefix = &quot;bazel_maven_repository-%s&quot; % MAVEN_REPOSITORY_RULES_VERSION,
    sha256 = MAVEN_REPOSITORY_RULES_SHA,
)
load(&quot;@maven_repository_rules//maven:maven.bzl&quot;, &quot;maven_repository_specification&quot;)
maven_repository_specification(
    name = &quot;maven&quot;,
    artifacts = {
        &quot;com.google.guava:guava:25.0-jre&quot;: { &quot;sha256&quot;: &quot;3fd4341776428c7e0e5c18a7c10de129475b69ab9d30aeafbb5c277bb6074fa9&quot; },
    }
)"><pre><span class="pl-v">MAVEN_REPOSITORY_RULES_VERSION</span> <span class="pl-c1">=</span> <span class="pl-s">"1.2.0"</span>
<span class="pl-v">MAVEN_REPOSITORY_RULES_SHA</span> <span class="pl-c1">=</span> <span class="pl-s">"9e23155895d2bfc60b35d2dfd88c91701892a7efba5afacdf00cebc0982229fe"</span>
<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"maven_repository_rules"</span>,
    <span class="pl-s1">urls</span> <span class="pl-c1">=</span> [<span class="pl-s">"https://github.com/square/bazel_maven_repository/archive/%s.zip"</span> <span class="pl-c1">%</span> <span class="pl-v">MAVEN_REPOSITORY_RULES_VERSION</span>],
    <span class="pl-s1">type</span> <span class="pl-c1">=</span> <span class="pl-s">"zip"</span>,
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"bazel_maven_repository-%s"</span> <span class="pl-c1">%</span> <span class="pl-v">MAVEN_REPOSITORY_RULES_VERSION</span>,
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-v">MAVEN_REPOSITORY_RULES_SHA</span>,
)
<span class="pl-en">load</span>(<span class="pl-s">"@maven_repository_rules//maven:maven.bzl"</span>, <span class="pl-s">"maven_repository_specification"</span>)
<span class="pl-en">maven_repository_specification</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"maven"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"com.google.guava:guava:25.0-jre"</span>: { <span class="pl-s">"sha256"</span>: <span class="pl-s">"3fd4341776428c7e0e5c18a7c10de129475b69ab9d30aeafbb5c277bb6074fa9"</span> },
    }
)</pre></div>
<p dir="auto">... results in deps of the format <code>@maven//com/google/guava:guava</code> (which can be abbreviated to
<code>@maven//com/google/guava</code>)</p>
<p dir="auto">Dependency versions are resolved in the single artifact list.  Only one version is permitted within
a repository.</p>
<blockquote>
<p dir="auto">Note: bazel_maven_repository has no workspace dependencies, so adding it to your project will not
result in any additional bazel repositories to be fetched. However, you specify .aars in your list,
you will need the <code>rules_android</code> to be declared in your <code>WORKSPACE</code></p>
</blockquote>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Supported Types</h2><a id="user-content-supported-types" class="anchor" aria-label="Permalink: Supported Types" href="#supported-types"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Currently <code>.aar</code> and <code>.jar</code> artifacts are supported.  OSGI bundles are supported by assuming they
are normal <code>.jar</code> artifacts (which they are, just have a packaging property of <code>bundle</code> and some
extra metadata in <code>META-INF</code> of the <code>.jar</code> file).</p>
<p dir="auto"><code>.aar</code> artifacts should be specified as <code>"some.group:some-artifact:1.0:aar"</code> (just append <code>:aar</code>
onto the artifact spec string).</p>
<p dir="auto">For any other types, please file a feature request, or supply a pull request.  So long as there
exists a proper bazel import or library rule to bring the artifact's file into bazel's dependency
graph, it should be possible to support it.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Inter-artifact dependencies</h2><a id="user-content-inter-artifact-dependencies" class="anchor" aria-label="Permalink: Inter-artifact dependencies" href="#inter-artifact-dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This rule will, in the generated repository, infer inter-artifact dependencies from pom.xml files
of those artifacts (pulling in only <code>compile</code> and <code>runtime</code> dependencies, and avoiding any
<code>systemPath</code> dependencies).  This avoids the bazel user having to over-specify the full set of
dependency jars.</p>
<p dir="auto">All artifacts, even if only transitively depended, must be specified with a pinned version in the
<code>artifacts</code> dictionary. Any artifacts discovered in the inferred dependency search, which are not
present in the main rule's artifact list will be flagged and the build will fail with an error. The
error output should suggest configuration to either pin them or exclude them.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Coordinate Translation</h2><a id="user-content-coordinate-translation" class="anchor" aria-label="Permalink: Coordinate Translation" href="#coordinate-translation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Translation from maven group/artifact coordinates to bazel package/target coordinates is naive but
orderly.  The logic mirrors the layout of a maven repository, with groupId elements (separated by
<code>.</code>) turning into a package hierarchy, and the artifactId turning into a bazel target.</p>
<p dir="auto">For example: <code>com.google.dagger:dagger-compiler:2.16</code> turns into <code>@maven//com/google/dagger:dagger</code>,
and <code>javax.inject:javax.inject:1</code> becomes <code>@maven//javax/inject:javax_inject</code> (since <code>.</code> is not a
valid character for a target).</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Artifact Configuration</h2><a id="user-content-artifact-configuration" class="anchor" aria-label="Permalink: Artifact Configuration" href="#artifact-configuration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Sha verification</h3><a id="user-content-sha-verification" class="anchor" aria-label="Permalink: Sha verification" href="#sha-verification"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Artifacts with SHA256 checksums can be added to <code>artifacts</code>, in the form:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="    artifacts = {
        &quot;com.google.guava:guava:25.0-jre&quot;: { &quot;sha256&quot;: &quot;3fd4341776428c7e0e5c18a7c10de129475b69ab9d30aeafbb5c277bb6074fa9&quot; },
    }"><pre class="notranslate"><code>    artifacts = {
        "com.google.guava:guava:25.0-jre": { "sha256": "3fd4341776428c7e0e5c18a7c10de129475b69ab9d30aeafbb5c277bb6074fa9" },
    }
</code></pre></div>
<p dir="auto">Artifacts without SHA headers should configured as insecure, like so:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="    artifacts = {
        &quot;com.google.guava:guava:25.0-jre&quot;: { &quot;insecure&quot;: True },
    }"><pre class="notranslate"><code>    artifacts = {
        "com.google.guava:guava:25.0-jre": { "insecure": True },
    }
</code></pre></div>
<p dir="auto">The rules will reject artifacts without SHAs are not marked as "insecure".</p>
<blockquote>
<p dir="auto">Note: These rules cannot validate that the checksum is the right one, only that the one supplied
in configuration matches the checksum of the file downloaded.  It is the responsibility of the
maintainer to use proper security practices and obtain the expected checksum from a trusted source.</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Testonly</h3><a id="user-content-testonly" class="anchor" aria-label="Permalink: Testonly" href="#testonly"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">An artifact can be declared testonly - this forces the <code>testonly = True</code> flag for the generated target
to be set, requiring that this artifact only be used by other testonly rules (e.g. test-libraries with
<code>testonly = true</code> also set, or <code>*_test</code> rules.)</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_repository_specification(
    name = &quot;maven&quot;,
    artifacts = {
        &quot;com.google.truth:truth:1.0&quot;: {&quot;insecure&quot;: True, &quot;testonly&quot;: True},
        # ... all the other deps.
    },
)"><pre><span class="pl-en">maven_repository_specification</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"maven"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"com.google.truth:truth:1.0"</span>: {<span class="pl-s">"insecure"</span>: <span class="pl-c1">True</span>, <span class="pl-s">"testonly"</span>: <span class="pl-c1">True</span>},
        <span class="pl-c"># ... all the other deps.</span>
    },
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Exclude</h3><a id="user-content-exclude" class="anchor" aria-label="Permalink: Exclude" href="#exclude"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<blockquote>
<p dir="auto">Since 2.0.0</p>
</blockquote>
<p dir="auto">An artifact can have some (or all) of its direct dependencies pruned by use of the <code>exclude</code> property.
For instance:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_repository_specification(
    name = &quot;maven&quot;,
    artifacts = {
        &quot;com.google.truth:truth:1.0&quot;: {
            &quot;insecure&quot;: True,
            &quot;exclude&quot;: [&quot;com.google.auto.value:auto-value-annotations&quot;],
        },
        # ... all the other deps.
    },
)"><pre><span class="pl-en">maven_repository_specification</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"maven"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"com.google.truth:truth:1.0"</span>: {
            <span class="pl-s">"insecure"</span>: <span class="pl-c1">True</span>,
            <span class="pl-s">"exclude"</span>: [<span class="pl-s">"com.google.auto.value:auto-value-annotations"</span>],
        },
        <span class="pl-c"># ... all the other deps.</span>
    },
)</pre></div>
<p dir="auto">This results in truth omitting a dependency on the auto-value annotations - useful to avoid
dependencies not specified as <code>&lt;optional&gt;true&lt;/optional&gt;</code> in the pom.xml, but which are not necessary
for correct operation of the artifact.  A good example of this would be robolectric, which contains
dependencies on a lot of maven download code which is not needed in a bazel build.</p>
<blockquote>
<p dir="auto">Note: This feature is incompatible with <code>"deps": [...]</code> and <code>"build_snippets": "..."</code> mechanisms.</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Include</h3><a id="user-content-include" class="anchor" aria-label="Permalink: Include" href="#include"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<blockquote>
<p dir="auto">Since 2.0.0</p>
</blockquote>
<p dir="auto">An artifact can have additional dependencies added using the <code>include</code> property. For instance:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_repository_specification(
    name = &quot;maven&quot;,
    artifacts = {
        &quot;com.helpshift:android-helpshift-aar:7.8.0&quot;: {
            &quot;insecure&quot;: True,
            &quot;include&quot;: [
                # Bazel dependencies 
                &quot;@//some/local/dependency&quot;, # in the root workspace of this build
                &quot;@some_workspace//some/other/dep&quot;, # in some external workspace of this build

                # While theoretically in the root workspace, because this occurs inside the maven
                # workspace maven may interpret this as being inside the @maven workspace. Use
                # the @// prefix to force it into the root workspace
                &quot;//some/local/dependency&quot;,

                # Useful for referencing some custom thing added by a snippet on another artifact.
                &quot;:some_target_in_the_same_package&quot;,

                # Maven artifact coordinates, which will be interpreted relative to the presently
                # configured maven workspace. These will also result in errors if their versioned
                # artifacts have not been pinned in the artifact dictionary.
                &quot;androidx.cardview:cardview&quot;,
                &quot;androidx.recyclerview:recyclerview&quot;,
                &quot;com.google.android.material:material&quot;,
            ]
        },
        # ... all the other deps.
    },
)"><pre><span class="pl-en">maven_repository_specification</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"maven"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"com.helpshift:android-helpshift-aar:7.8.0"</span>: {
            <span class="pl-s">"insecure"</span>: <span class="pl-c1">True</span>,
            <span class="pl-s">"include"</span>: [
                <span class="pl-c"># Bazel dependencies </span>
                <span class="pl-s">"@//some/local/dependency"</span>, <span class="pl-c"># in the root workspace of this build</span>
                <span class="pl-s">"@some_workspace//some/other/dep"</span>, <span class="pl-c"># in some external workspace of this build</span>

                <span class="pl-c"># While theoretically in the root workspace, because this occurs inside the maven</span>
                <span class="pl-c"># workspace maven may interpret this as being inside the @maven workspace. Use</span>
                <span class="pl-c"># the @// prefix to force it into the root workspace</span>
                <span class="pl-s">"//some/local/dependency"</span>,

                <span class="pl-c"># Useful for referencing some custom thing added by a snippet on another artifact.</span>
                <span class="pl-s">":some_target_in_the_same_package"</span>,

                <span class="pl-c"># Maven artifact coordinates, which will be interpreted relative to the presently</span>
                <span class="pl-c"># configured maven workspace. These will also result in errors if their versioned</span>
                <span class="pl-c"># artifacts have not been pinned in the artifact dictionary.</span>
                <span class="pl-s">"androidx.cardview:cardview"</span>,
                <span class="pl-s">"androidx.recyclerview:recyclerview"</span>,
                <span class="pl-s">"com.google.android.material:material"</span>,
            ]
        },
        <span class="pl-c"># ... all the other deps.</span>
    },
)</pre></div>
<p dir="auto">This results in the bazel workspace generating additional dependencies, converting maven-style
<code>some.group.id:artifactId</code> pairs to <code>@maven//some/group/id:artifactId</code> and passing bazel-style
dependencies (<code>:foo</code>, <code>//foo/bar</code>, <code>@someWorkspace//foo/bar:baz</code>) through as text, relying on
bazel itself to resolve and complain if they are incorrect.</p>
<p dir="auto">These additions are performed after automatically detected dependencies are processed (and
after excludes are processed).  It can be used to add missing deps from badly specified pom
files, or it can add-back-in optional dependencies (which are not included by default).</p>
<blockquote>
<p dir="auto">Note: This feature is incompatible with <code>"deps": [...]</code> and <code>"build_snippets": "..."</code> mechanisms.</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Deps</h3><a id="user-content-deps" class="anchor" aria-label="Permalink: Deps" href="#deps"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<blockquote>
<p dir="auto">Since 2.0.0</p>
</blockquote>
<p dir="auto">An artifact can have its dependencies entirely specified (overriding the automated detection
via maven resolution) using the <code>deps</code> property. For instance:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_repository_specification(
    name = &quot;maven&quot;,
    artifacts = {
        &quot;com.helpshift:android-helpshift-aar:7.8.0&quot;: {
            &quot;insecure&quot;: True,
            &quot;deps&quot;: [
                # Bazel dependencies 
                &quot;@//some/local/dependency&quot;, # in the root workspace of this build
                &quot;@some_workspace//some/other/dep&quot;, # in some external workspace of this build

                # While theoretically in the root workspace, because this occurs inside the maven
                # workspace maven may interpret this as being inside the @maven workspace. Use
                # the @// prefix to force it into the root workspace
                &quot;//some/local/dependency&quot;,

                # Useful for referencing some custom thing added by a snippet on another artifact.
                &quot;:some_target_in_the_same_package&quot;,

                # Maven artifact coordinates, which will be interpreted relative to the presently
                # configured maven workspace. These will also result in errors if their versioned
                # artifacts have not been pinned in the artifact dictionary.
                &quot;androidx.cardview:cardview&quot;,
                &quot;androidx.recyclerview:recyclerview&quot;,
                &quot;com.google.android.material:material&quot;,
            ]
        },
        # ... all the other deps.
    },
)"><pre><span class="pl-en">maven_repository_specification</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"maven"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"com.helpshift:android-helpshift-aar:7.8.0"</span>: {
            <span class="pl-s">"insecure"</span>: <span class="pl-c1">True</span>,
            <span class="pl-s">"deps"</span>: [
                <span class="pl-c"># Bazel dependencies </span>
                <span class="pl-s">"@//some/local/dependency"</span>, <span class="pl-c"># in the root workspace of this build</span>
                <span class="pl-s">"@some_workspace//some/other/dep"</span>, <span class="pl-c"># in some external workspace of this build</span>

                <span class="pl-c"># While theoretically in the root workspace, because this occurs inside the maven</span>
                <span class="pl-c"># workspace maven may interpret this as being inside the @maven workspace. Use</span>
                <span class="pl-c"># the @// prefix to force it into the root workspace</span>
                <span class="pl-s">"//some/local/dependency"</span>,

                <span class="pl-c"># Useful for referencing some custom thing added by a snippet on another artifact.</span>
                <span class="pl-s">":some_target_in_the_same_package"</span>,

                <span class="pl-c"># Maven artifact coordinates, which will be interpreted relative to the presently</span>
                <span class="pl-c"># configured maven workspace. These will also result in errors if their versioned</span>
                <span class="pl-c"># artifacts have not been pinned in the artifact dictionary.</span>
                <span class="pl-s">"androidx.cardview:cardview"</span>,
                <span class="pl-s">"androidx.recyclerview:recyclerview"</span>,
                <span class="pl-s">"com.google.android.material:material"</span>,
            ]
        },
        <span class="pl-c"># ... all the other deps.</span>
    },
)</pre></div>
<p dir="auto">This results in the bazel workspace ignoring the dependencies from resolved metadata, and using
the supplied list instead. It converts maven-style <code>some.group.id:artifactId</code> pairs to
<code>@maven//some/group/id:artifactId</code>.  It passes bazel-style dependencies (<code>:foo</code>, <code>//foo/bar</code>,
<code>@someWorkspace//foo/bar:baz</code>) through as text, relying on bazel itself to resolve and complain
if they are incorrect.</p>
<blockquote>
<p dir="auto">Note: This feature is incompatible with <code>"include": [...]</code> <code>"exclude": [...]</code> and
<code>"build_snippets": "..."</code> mechanisms, as it entirely takes responsibility for the deps
list.</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Substitution of build targets</h3><a id="user-content-substitution-of-build-targets" class="anchor" aria-label="Permalink: Substitution of build targets" href="#substitution-of-build-targets"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<blockquote>
<p dir="auto">Note: Because this feature entirely takes over snippet generation, it is more brittle than other
features that may address the relevant use-cases. Please prefer those features over this one,
if they can solve your problem, as it overrides a lot of validation and guarantees, and a given
snippet may become stale with version changes of the artifacts specified.</p>
<p dir="auto">It is useful, however, if you cannot address your case with other features.</p>
</blockquote>
<p dir="auto">One can provide a <code>BUILD.bazel</code> target snippet that will be substituted for the auto-generated
target implied by a maven artifact.  This is very useful for providing an
annotation-processor-exporting alternative target.  The substitution is naive, so the string needs
to be appropriate and any rules need to be correct, contain the right dependencies, etc.  To aid
that it's also possible to (on a per-package basis) substitute dependencies on a given
fully-qualified bazel target for another.</p>
<p dir="auto">A simple use-case would be to substitute a target name (e.g. "mockito-core" -&gt; "mockito") for
cleaner/easier use in bazel:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_repository_specification(
    name = &quot;maven&quot;,
    artifacts = {
        &quot;org.mockito:mockito-core:2.20.1&quot;: {
            &quot;sha256&quot;: &quot;blahblahblah&quot;,
            &quot;build_snippet&quot;: &quot;&quot;&quot;maven_jvm_artifact(name = &quot;mockito&quot;, artifact = &quot;org.mockito:mockito-core:2.20.1&quot;)&quot;&quot;&quot;,
        },
        # ... all the other deps.
    },
)"><pre><span class="pl-en">maven_repository_specification</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"maven"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"org.mockito:mockito-core:2.20.1"</span>: {
            <span class="pl-s">"sha256"</span>: <span class="pl-s">"blahblahblah"</span>,
            <span class="pl-s">"build_snippet"</span>: <span class="pl-s">"""maven_jvm_artifact(name = "mockito", artifact = "org.mockito:mockito-core:2.20.1")"""</span>,
        },
        <span class="pl-c"># ... all the other deps.</span>
    },
)</pre></div>
<p dir="auto">This would allow the following use in a <code>BUILD.bazel</code> file.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="java_test(
  name = &quot;MyTest&quot;,
  srcs = &quot;MyTest.java&quot;,
  deps = [
    # ... other deps
    &quot;@maven//org/mockito&quot; # instead of &quot;@maven//org/mockito:mockito-core&quot;
  ],
)"><pre><span class="pl-en">java_test</span>(
  <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"MyTest"</span>,
  <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> <span class="pl-s">"MyTest.java"</span>,
  <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
    <span class="pl-c"># ... other deps</span>
    <span class="pl-s">"@maven//org/mockito"</span> <span class="pl-c"># instead of "@maven//org/mockito:mockito-core"</span>
  ],
)</pre></div>
<p dir="auto">More complex use-cases are possible, such as adding substitute targets with annotation processing
<code>java_plugin</code> targets and exports.  An example with Dagger would look like this (with the basic rule
imports assumed):</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="DAGGER_PROCESSOR_SNIPPET = &quot;&quot;&quot;
# use this target
java_library(name = &quot;dagger&quot;, exports = [&quot;:dagger_api&quot;], exported_plugins = [&quot;:dagger_plugin&quot;])

# alternatively-named import of the raw dagger library.
raw_jvm_import(
    name = &quot;dagger_api&quot;,
    jars = &quot;@com_google_dagger_dagger//maven&quot;,    
)

java_plugin(
    name = &quot;dagger_plugin&quot;,
    processor_class = &quot;dagger.internal.codegen.ComponentProcessor&quot;,
    generates_api = True,
    deps = [&quot;:dagger_compiler&quot;],
)
&quot;&quot;&quot;"><pre><span class="pl-v">DAGGER_PROCESSOR_SNIPPET</span> <span class="pl-c1">=</span> <span class="pl-s">"""</span>
<span class="pl-s"># use this target</span>
<span class="pl-s">java_library(name = "dagger", exports = [":dagger_api"], exported_plugins = [":dagger_plugin"])</span>
<span class="pl-s"></span>
<span class="pl-s"># alternatively-named import of the raw dagger library.</span>
<span class="pl-s">raw_jvm_import(</span>
<span class="pl-s">    name = "dagger_api",</span>
<span class="pl-s">    jars = "@com_google_dagger_dagger//maven",    </span>
<span class="pl-s">)</span>
<span class="pl-s"></span>
<span class="pl-s">java_plugin(</span>
<span class="pl-s">    name = "dagger_plugin",</span>
<span class="pl-s">    processor_class = "dagger.internal.codegen.ComponentProcessor",</span>
<span class="pl-s">    generates_api = True,</span>
<span class="pl-s">    deps = [":dagger_compiler"],</span>
<span class="pl-s">)</span>
<span class="pl-s">"""</span></pre></div>
<p dir="auto">The above is given as a substitution in the <code>maven_repository_specification()</code> rule.  However,
since the inferred dependencies of <code>:dagger-compiler</code> would create a dependency cycle because it
includes <code>:dagger</code> as a dep, the specification rule also should include a
<code>dependency_target_substitution</code>, to ensures that the inferred rules in the generated
<code>com/google/dagger/BUILD</code> file consume <code>:dagger_api</code> instead of the wrapper replacement target, or
use <code>include</code> and <code>exclude</code> statements on the <code>com.google.dagger:dagger-compiler</code> artifact to have
it depend on the now-renamed target (see the test/test_workspace for an example of this)</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="maven_repository_specification(
    name = &quot;maven&quot;,
    artifacts = {
        &quot;com.google.dagger:dagger:2.20&quot;: {
            &quot;sha256&quot;: &quot;blahblahblah&quot;,
            &quot;build_snippet&quot;: DAGGER_PROCESSOR_SNIPPET,
        },
        &quot;com.google.dagger:dagger-compiler:2.20&quot;: { &quot;sha256&quot;: &quot;blahblahblah&quot; },
        &quot;com.google.dagger:dagger-producers:2.20&quot;: { &quot;sha256&quot;: &quot;blahblahblah&quot; },
        &quot;com.google.dagger:dagger-spi:2.20&quot;: { &quot;sha256&quot;: &quot;blahblahblah&quot; },
        &quot;com.google.code.findbugs:jsr305:3.0.2&quot;: { &quot;sha256&quot;: &quot;blahblahblah&quot; },
        # ... all the other deps.
    },
    dependency_target_substitutes = {
        &quot;com.google.dagger&quot;: {&quot;@maven//com/google/dagger:dagger&quot;: &quot;@maven//com/google/dagger:dagger_api&quot;},
    }
)"><pre><span class="pl-en">maven_repository_specification</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"maven"</span>,
    <span class="pl-s1">artifacts</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"com.google.dagger:dagger:2.20"</span>: {
            <span class="pl-s">"sha256"</span>: <span class="pl-s">"blahblahblah"</span>,
            <span class="pl-s">"build_snippet"</span>: <span class="pl-v">DAGGER_PROCESSOR_SNIPPET</span>,
        },
        <span class="pl-s">"com.google.dagger:dagger-compiler:2.20"</span>: { <span class="pl-s">"sha256"</span>: <span class="pl-s">"blahblahblah"</span> },
        <span class="pl-s">"com.google.dagger:dagger-producers:2.20"</span>: { <span class="pl-s">"sha256"</span>: <span class="pl-s">"blahblahblah"</span> },
        <span class="pl-s">"com.google.dagger:dagger-spi:2.20"</span>: { <span class="pl-s">"sha256"</span>: <span class="pl-s">"blahblahblah"</span> },
        <span class="pl-s">"com.google.code.findbugs:jsr305:3.0.2"</span>: { <span class="pl-s">"sha256"</span>: <span class="pl-s">"blahblahblah"</span> },
        <span class="pl-c"># ... all the other deps.</span>
    },
    <span class="pl-s1">dependency_target_substitutes</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"com.google.dagger"</span>: {<span class="pl-s">"@maven//com/google/dagger:dagger"</span>: <span class="pl-s">"@maven//com/google/dagger:dagger_api"</span>},
    }
)</pre></div>
<p dir="auto">Thereafter, any target with a dependency on (in this example) <code>@maven//com/google/dagger</code> will
invoke annotation processing and generate any dagger-generated code. A similar pattern could be
used for <a href="http://github.com/google/auto">AutoFactory and AutoValue</a>, configuring kotlinc
plugins, etc.</p>
<p dir="auto">Such snippet constants can be extracted into .bzl files and imported to keep the WORKSPACE file
tidy. In the future some standard templates may be offered by this project, but not until deps
validation is available, as it would be too easy to have templates' deps lists go out of date as
versions bumped, if no other validation prevented it or notified about it.</p>
<blockquote>
<p dir="auto">Note: This feature is incompatible with <code>"include": [...]</code> <code>"exclude": [...]</code> and
<code>"deps": "..."</code> mechanisms, as it entirely takes responsibility for the targets written
into the build file, and therefore, any dependencies.  It also overrides a lot of warnings.</p>
</blockquote>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Caching</h2><a id="user-content-caching" class="anchor" aria-label="Permalink: Caching" href="#caching"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><strong>Bazel Maven Repository 1.2.0 and prior:</strong>
Bazel can cache artifacts if you provide sha256 hashes.  These will make the artifacts candidates
for the "content addressable" cache, which is machine-wide, and survives even <code>bazel clean --expunge</code>.
The caveat for this is that if you put the wrong hash, and if that hash is to a file you already have
downloaded, bazel's internal download mechanism will serve that file instead of the remote file. This
can cause you to accidentally supply a wrong version, wrong artifact, or wrong kind of file if you're
not careful.  So take caution when recording the sha256 hashes, both for security and performance
reasons.  The hash will be preferred over the artifact as a way to identify the artifact, under the
hood.</p>
<p dir="auto">Pom.xml files are not cached, and will be re-downloaded when your workspace needs regenerating.</p>
<p dir="auto"><strong>Bazel Maven Repository 2.0 and later:</strong>
The rules will cache maven artifacts and metadata via the <code>~/.m2/repository</code> "local repository"
exactly as maven would.</p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Limitations</h1><a id="user-content-limitations" class="anchor" aria-label="Permalink: Limitations" href="#limitations"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>Doesn't support -SNAPSHOT dependencies (#5) (pending 2.0)</li>
<li>Doesn't support multiple versions of a dependency (by design).</li>
<li>Doesn't support multiple calls to <code>maven_repository_specification()</code> due to collisions in
the implicit fetching rules it creates. This limitation will be lifted in a version. (#6)
(pending 2.0)</li>
<li>Doesn't support -source.jar downloading and attachment. (#44) (pending 2.0)</li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Other Usage Notes</h2><a id="user-content-other-usage-notes" class="anchor" aria-label="Permalink: Other Usage Notes" href="#other-usage-notes"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Caches</h3><a id="user-content-caches" class="anchor" aria-label="Permalink: Caches" href="#caches"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Because of the nature of bazel repository/workspace operation, updating the list of artifacts
invalidates the analysis cache, and force a re-run of workspace operations (and possibly reduce
incrementality of the next build).  As of 2.0, the workspace generation is drastically faster.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Clogged WORKSPACE files</h3><a id="user-content-clogged-workspace-files" class="anchor" aria-label="Permalink: Clogged WORKSPACE files" href="#clogged-workspace-files"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">It may make sense, if one's maven universe gets big, to extract the list of artifacts into a
constant in a separate file (e.g. <code>maven_artifacts.bzl</code>) and import it.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Kotlin</h3><a id="user-content-kotlin" class="anchor" aria-label="Permalink: Kotlin" href="#kotlin"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">ijar (abi-jar) and inline functions</h4><a id="user-content-ijar-abi-jar-and-inline-functions" class="anchor" aria-label="Permalink: ijar (abi-jar) and inline functions" href="#ijar-abi-jar-and-inline-functions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Bazel Maven Repository uses a raw_jvm_import target which does <em>not</em> invoke <strong>ijar</strong> as it is
known to break Kotlin artifacts with inlined operators and inlined types.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">rules_kotlin and maven integration paths</h4><a id="user-content-rules_kotlin-and-maven-integration-paths" class="anchor" aria-label="Permalink: rules_kotlin and maven integration paths" href="#rules_kotlin-and-maven-integration-paths"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">[rules_kotlin] currently break when running in full sandbox mode (without the kotlin compilation
worker).  Specifically, it misinterprets paths in the sandbox.  Therefore, if using [rules_kotlin]
it is crucial to include <code>--strategy=KotlinCompile=worker</code> either on the command-line, or in the
project's .bazelrc or your personal .bazelrc.  Otherwise, the annotation processor will fail to
find the jar contents for annotation processors such as <code>Dagger 2</code> or <code>AutoValue</code> or <code>AutoFactory</code>.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">License</h2><a id="user-content-license" class="anchor" aria-label="Permalink: License" href="#license"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">License
Copyright 2018 Square, Inc.</p>
<p dir="auto">Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<p dir="auto"><a href="http://www.apache.org/licenses/LICENSE-2.0" rel="nofollow">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p dir="auto">Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
</article></div>