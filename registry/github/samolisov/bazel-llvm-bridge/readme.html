<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><p dir="auto"><strong>Due to the LLVM community's planes to add the Bazel build files in the project's monorepo
<a href="https://lists.llvm.org/pipermail/llvm-dev/2021-March/149220.html" rel="nofollow">[1]</a>, I see no intent for
the project.</strong></p>
<div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Bazel to the LLVM Compiler Infrastructure bridge</h1><a id="user-content-bazel-to-the-llvm-compiler-infrastructure-bridge" class="anchor-element" aria-label="Permalink: Bazel to the LLVM Compiler Infrastructure bridge" href="#bazel-to-the-llvm-compiler-infrastructure-bridge"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://docs.bazel.build/versions/master/bazel-overview.html" rel="nofollow">Bazel</a> is an open-source
build and test tool similar to Make, Maven, and Gradle. It uses a human-readable,
high-level build language. Bazel supports projects in multiple languages and builds outputs
for multiple platforms. For example, Tensorflow - end-to-end open-source platform for
machine learning - uses Bazel as the build system.</p>
<p dir="auto"><a href="https://llvm.org/" rel="nofollow">LLVM</a> is a collection of modular and reusable compiler and toolchain
technologies. The LLVM Core libraries provide a modern source- and target-independent
optimizer and code generator that makes it easy to invent a new programming language or
port an existing compiler. Also LLVM provides its own native C/C++ compiler - Clang,
debugger - LLDB, an implementation of the C++ Standard Library, and many other interesting
things. The full list of LLVM's primary sub-projects is available on the official web-site.</p>
<p dir="auto"><strong>bazel-llvm-bridge</strong> provides a bridge that let you use static libraries from a local
installation or kindly downloaded archive of LLVM in your projects when Bazel is used
as a building tool. Each library from LLVM/Clang (including the special 'headers' library
that provides LLVM's and Clang's headers) is available as a <code>@local_llvm//:llvm_&lt;library_name&gt;</code>
dependency (<code>@local_llvm//:llvm_headers</code> for the headers library), where <code>@local_llvm</code> is
the name of the used <code>llvm_configure</code>
<a href="https://docs.bazel.build/versions/master/skylark/repository_rules.html" rel="nofollow">repository rule</a>
while <code>llvm_</code>, <code>clang_</code> and <code>mlir_</code> are the default prefixes for LLVM, Clang and MLIR specific
rules, all these parameters can be configured in your <code>WORKSPACE</code>. Notice that a library will
bring also its dependencies exactly how the <em>CMake</em> build works.</p>
<p dir="auto">Platform-provided libraries such as "ncurses", "tinfo", "pthreads", "Z3" will be detected
automatically using the <code>*.cmake</code> files generated by CMake during the LLVM build process.</p>
<p dir="auto">Notice: The minimum supported version of Bazel is
<a href="https://github.com/bazelbuild/bazel/releases/tag/0.25.0"><strong>0.25.0</strong></a>.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">How to leverage the bridge in your project</h3><a id="user-content-how-to-leverage-the-bridge-in-your-project" class="anchor-element" aria-label="Permalink: How to leverage the bridge in your project" href="#how-to-leverage-the-bridge-in-your-project"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In order to use any LLVM libraries in your targets, add the following to your
<code>WORKSPACE</code> file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_archive&quot;)

http_archive(
    name = &quot;bazel_llvm_bridge&quot;,
    sha256 = &quot;0e0971ec02d5e061c2c472d185e390597a4d7842e3e457cfcda2f04c1839c05e&quot;,
    strip_prefix = &quot;bazel-llvm-bridge-release-11-05&quot;,
    url = &quot;https://github.com/samolisov/bazel-llvm-bridge/archive/release/11-05.zip&quot;,
)

load(&quot;@bazel_llvm_bridge//llvm:llvm_configure.bzl&quot;, &quot;llvm_configure&quot;)

llvm_configure(
    name = &quot;local_llvm&quot;,
    llvm_prefix = &quot;llvm_&quot;,
    clang_prefix = &quot;clang_&quot;,
    libcxx_prefix = &quot;libcxx_&quot;,
    mlir_prefix = &quot;mlir_&quot;,
    add_headers_to_deps = False,
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="pl-s">"http_archive"</span>)

<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"bazel_llvm_bridge"</span>,
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-s">"0e0971ec02d5e061c2c472d185e390597a4d7842e3e457cfcda2f04c1839c05e"</span>,
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"bazel-llvm-bridge-release-11-05"</span>,
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"https://github.com/samolisov/bazel-llvm-bridge/archive/release/11-05.zip"</span>,
)

<span class="pl-en">load</span>(<span class="pl-s">"@bazel_llvm_bridge//llvm:llvm_configure.bzl"</span>, <span class="pl-s">"llvm_configure"</span>)

<span class="pl-en">llvm_configure</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"local_llvm"</span>,
    <span class="pl-s1">llvm_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"llvm_"</span>,
    <span class="pl-s1">clang_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"clang_"</span>,
    <span class="pl-s1">libcxx_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"libcxx_"</span>,
    <span class="pl-s1">mlir_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"mlir_"</span>,
    <span class="pl-s1">add_headers_to_deps</span> <span class="pl-c1">=</span> <span class="pl-c1">False</span>,
)</pre></div>
<p dir="auto">Where <code>name</code> is whatever you want, default values for <code>llvm_prefix</code>, <code>clang_prefix</code>,
<code>libcxx_prefix</code> and <code>mlir_prefix</code> may be omitted. By default, the header libraries will be
automatically included as dependency to the generated targets (the LLVM header library to
LLVM's, Clang's and other project's targets, the Clang header library to Clang's targets, etc.)
If you would like to manually put the header libraries to dependencies, set up the
<code>add_headers_to_deps</code> attribute of the reporitory rule to <code>False</code>.</p>
<p dir="auto">The LLVM libraries are fetched from a local installation so the <code>LLVM_INSTALL_PREFIX</code>
environment variable <strong>must</strong> point to the local installation.</p>
<p dir="auto">The library's version number is matched to the version of LLVM and can be found in the
<code>release/&lt;version&gt;-&lt;build&gt;</code> tag or <code>release/&lt;version&gt;.x</code> branch. For example:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ git clone https://github.com/samolisov/bazel-llvm-bridge.git
$ git checkout release/9.x
$ git log --oneline -1"><pre>$ git clone https://github.com/samolisov/bazel-llvm-bridge.git
$ git checkout release/9.x
$ git log --oneline -1</pre></div>
<p dir="auto">shows you the latest commit in the release branch. The commit can be used as a value of the <code>commit</code>
attribute of the <code>git_repository</code> rule to checkout the compatible version of <strong>bazel-llvm-bridge</strong> for
the used version of <strong>LLVM</strong>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="git_repository(
    name = &quot;bazel_llvm_bridge&quot;,
    commit = &quot;&lt;THE LATEST COMMIT HERE&gt;&quot;,
    remote = &quot;https://github.com/samolisov/bazel-llvm-bridge.git&quot;,
)"><pre><span class="pl-en">git_repository</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"bazel_llvm_bridge"</span>,
    <span class="pl-s1">commit</span> <span class="pl-c1">=</span> <span class="pl-s">"&lt;THE LATEST COMMIT HERE&gt;"</span>,
    <span class="pl-s1">remote</span> <span class="pl-c1">=</span> <span class="pl-s">"https://github.com/samolisov/bazel-llvm-bridge.git"</span>,
)</pre></div>
<p dir="auto">Now the desired libraries can be added as dependencies (the <code>deps</code> attribute) to targets for
your libraries and binaries (through the <code>@local_llvm</code> repository):</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="cc_binary(
    name = 'llvm_bb_counter',
    srcs = [
        &quot;llvm/llvm_bb_counter.cc&quot;,
    ],
    deps = [
        &quot;@local_llvm//:llvm_headers&quot;,
        &quot;@local_llvm//:llvm_bit_reader&quot;,
    ] + if_cxx_linked([
        &quot;@local_llvm//:libcxx_shared&quot;,
        &quot;@local_llvm//:libcxx_abi_shared&quot;,
    ]),
    visibility = [&quot;//visibility:private&quot;],
)"><pre><span class="pl-en">cc_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">'llvm_bb_counter'</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"llvm/llvm_bb_counter.cc"</span>,
    ],
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"@local_llvm//:llvm_headers"</span>,
        <span class="pl-s">"@local_llvm//:llvm_bit_reader"</span>,
    ] <span class="pl-c1">+</span> <span class="pl-en">if_cxx_linked</span>([
        <span class="pl-s">"@local_llvm//:libcxx_shared"</span>,
        <span class="pl-s">"@local_llvm//:libcxx_abi_shared"</span>,
    ]),
    <span class="pl-s1">visibility</span> <span class="pl-c1">=</span> [<span class="pl-s">"//visibility:private"</span>],
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">How to build the project</h3><a id="user-content-how-to-build-the-project" class="anchor-element" aria-label="Permalink: How to build the project" href="#how-to-build-the-project"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To build your targets, do the following:</p>
<ol start="0" dir="auto">
<li>
<p dir="auto">Build from sources or download from <a href="http://releases.llvm.org/download.html" rel="nofollow">http://releases.llvm.org/download.html</a> an
archive with an LLVM package for your platform. The package must be unarchived
into a local directory.</p>
</li>
<li>
<p dir="auto">Set up the <code>LLVM_INSTALL_PREFIX</code> environment variable. The variable must
contain a path to a local LLVM installation:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ export LLVM_INSTALL_PREFIX=~/dev/llvm_master"><pre>$ <span class="pl-k">export</span> LLVM_INSTALL_PREFIX=<span class="pl-k">~</span>/dev/llvm_master</pre></div>
<p dir="auto">or, on Windows:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ set LLVM_INSTALL_PREFIX=C:\Dev\llvm_master"><pre>$ <span class="pl-c1">set</span> LLVM_INSTALL_PREFIX=C:<span class="pl-cce">\D</span>ev<span class="pl-cce">\l</span>lvm_master</pre></div>
</li>
<li>
<p dir="auto">Run the build:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ bazel build //:llvm_bb_counter"><pre>$ bazel build //:llvm_bb_counter</pre></div>
<p dir="auto">alternatively, the environment variables may be passed directly to the build
command:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ bazel build --action_env LLVM_INSTALL_PREFIX=C:\Dev\llvm_master //:clang_list_methods"><pre>$ bazel build --action_env LLVM_INSTALL_PREFIX=C:<span class="pl-cce">\D</span>ev<span class="pl-cce">\l</span>lvm_master //:clang_list_methods</pre></div>
</li>
</ol>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">How to deal with targets</h3><a id="user-content-how-to-deal-with-targets" class="anchor-element" aria-label="Permalink: How to deal with targets" href="#how-to-deal-with-targets"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <strong>bazel-llvm-bridge</strong> supports all out-of-the-box provided LLVM targets:</p>
<ul dir="auto">
<li>AArch64</li>
<li>AMDGPU</li>
<li>ARM</li>
<li>AVR</li>
<li>BPF</li>
<li>Hexagon</li>
<li>Lanai</li>
<li>Mips</li>
<li>MSP430</li>
<li>NVPTX</li>
<li>PowerPC</li>
<li>RISCV</li>
<li>Sparc</li>
<li>SystemZ</li>
<li>WebAssembly</li>
<li>X86</li>
<li>XCore</li>
</ul>
<p dir="auto">To link against a target, the user should to check whether the target is supported by the used
local installation of LLVM. A set of <code>if_has_&lt;TARGET&gt;</code> functions are provided by
<code>@local_llvm//:llvm_config.bzl</code> generated skylark file. Every function returns its first argument
when the target <code>&lt;TARGET&gt;</code> is supported, otherwise it returns the second argument. The function
is usable through the following way (see the <code>//:llvm_print_supported_targets</code> target in
the <code>examples/BUILD</code> file):</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@local_llvm//:llvm_config.bzl&quot;,
    &quot;llvm_copts&quot;,
    &quot;if_has_aarch64&quot;,
    ...
    &quot;if_has_x86&quot;)

cc_binary(
    name = &quot;llvm_print_supported_targets&quot;,
    srcs = [
        ...
    ],
    copts = llvm_copts()
        + if_has_aarch64([&quot;-DLLVM_SUPPORTS_TARGET_AARCH64&quot;])
        ...
        + if_has_x86([&quot;-DLLVM_SUPPORTS_TARGET_X86&quot;]),
    deps = if_has_aarch64([
        &quot;@local_llvm//:llvm_aarch64_asm_parser&quot;,
        &quot;@local_llvm//:llvm_aarch64_code_gen&quot;,
        &quot;@local_llvm//:llvm_aarch64_disassembler&quot;,
    ]) +
    ...
       + if_has_x86([
        &quot;@local_llvm//:llvm_x86_asm_parser&quot;,
        &quot;@local_llvm//:llvm_x86_code_gen&quot;,
        &quot;@local_llvm//:llvm_x86_disassembler&quot;,
    ])
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@local_llvm//:llvm_config.bzl"</span>,
    <span class="pl-s">"llvm_copts"</span>,
    <span class="pl-s">"if_has_aarch64"</span>,
    ...
    "<span class="pl-s1">if_has_x86</span>")

<span class="pl-en">cc_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"llvm_print_supported_targets"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [
        ...
    ],
    <span class="pl-s1">copts</span> <span class="pl-c1">=</span> <span class="pl-en">llvm_copts</span>()
        <span class="pl-c1">+</span> <span class="pl-en">if_has_aarch64</span>([<span class="pl-s">"-DLLVM_SUPPORTS_TARGET_AARCH64"</span>])
        ...
        <span class="pl-c1">+</span> <span class="pl-en">if_has_x86</span>([<span class="pl-s">"-DLLVM_SUPPORTS_TARGET_X86"</span>]),
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> <span class="pl-en">if_has_aarch64</span>([
        <span class="pl-s">"@local_llvm//:llvm_aarch64_asm_parser"</span>,
        <span class="pl-s">"@local_llvm//:llvm_aarch64_code_gen"</span>,
        <span class="pl-s">"@local_llvm//:llvm_aarch64_disassembler"</span>,
    ]) <span class="pl-c1">+</span>
    ...
       <span class="pl-c1">+</span> <span class="pl-en">if_has_x86</span>([
        <span class="pl-s">"@local_llvm//:llvm_x86_asm_parser"</span>,
        <span class="pl-s">"@local_llvm//:llvm_x86_code_gen"</span>,
        <span class="pl-s">"@local_llvm//:llvm_x86_disassembler"</span>,
    ])
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">How to deal with tablegen</h3><a id="user-content-how-to-deal-with-tablegen" class="anchor-element" aria-label="Permalink: How to deal with tablegen" href="#how-to-deal-with-tablegen"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">LLVM, Clang and MLIR are very intensive users of the <a href="https://llvm.org/docs/TableGen/" rel="nofollow">tablegen</a> tool.
For example, MLIR's Table-driven
<a href="https://github.com/llvm/llvm-project/blob/master/mlir/docs/DeclarativeRewrites.md">Declarative Rewrite Rule</a>
is based upon tablegen. Fortunately, <strong>bazel-llvm-bridge</strong> provides a rule to run the tablegen
tools for LLVM as well as for MLIR (<code>llvm-tblgen</code> and <code>mlir-tblgen</code> respectively). The rules are defined
in the <code>llvm_tablegen.bzl</code> and <code>mlir_tablegen.bzl</code> files.</p>
<p dir="auto">To run the tablegen tool, the user should define one or more targets based on the <code>&lt;prefix&gt;_tablegen</code>
rule in a BUILD file. The targets can be used by any other <code>cc_</code> ones as dependencies and also
can depend on any <code>cc_library</code> (the tablegen tool will use includes and headers provided by such
libraries). For example:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@local_llvm//:llvm_tablegen.bzl&quot;, &quot;tablegen&quot;)

cc_binary(
    name = 'llvm_print_physical_registers',
    ...
    deps = [
        ...
        &quot;:tablegen_registers&quot;,
    ],
    visibility = [&quot;//visibility:private&quot;],
)

tablegen(
    name = &quot;tablegen_registers&quot;,
    srcs = [
        &quot;llvm/target/custom_register_class.td&quot;,
    ],
    src = &quot;llvm/target/custom_register_info.td&quot;,
    out = &quot;target/custom_register_info.inc&quot;,
    opts = [&quot;-gen-register-info&quot;],
    deps = [&quot;@local_llvm//:headers&quot;],
    visibility = [&quot;//visibility:private&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@local_llvm//:llvm_tablegen.bzl"</span>, <span class="pl-s">"tablegen"</span>)

<span class="pl-en">cc_binary</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">'llvm_print_physical_registers'</span>,
    ...
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [
        ...
        ":<span class="pl-s1">tablegen_registers</span>",
    ],
    <span class="pl-s1">visibility</span> <span class="pl-c1">=</span> [<span class="pl-s">"//visibility:private"</span>],
)

<span class="pl-en">tablegen</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"tablegen_registers"</span>,
    <span class="pl-s1">srcs</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"llvm/target/custom_register_class.td"</span>,
    ],
    <span class="pl-s1">src</span> <span class="pl-c1">=</span> <span class="pl-s">"llvm/target/custom_register_info.td"</span>,
    <span class="pl-s1">out</span> <span class="pl-c1">=</span> <span class="pl-s">"target/custom_register_info.inc"</span>,
    <span class="pl-s1">opts</span> <span class="pl-c1">=</span> [<span class="pl-s">"-gen-register-info"</span>],
    <span class="pl-s1">deps</span> <span class="pl-c1">=</span> [<span class="pl-s">"@local_llvm//:headers"</span>],
    <span class="pl-s1">visibility</span> <span class="pl-c1">=</span> [<span class="pl-s">"//visibility:private"</span>],
)</pre></div>
<p dir="auto">Notice: a target should be defined for every tablegen invocation.</p>
<p dir="auto">The <code>&lt;prefix&gt;_tablegen</code> rule has the following attributes:</p>
<ul dir="auto">
<li>name - the target's name.</li>
<li>src - the tablegen (.td) file to be the input of the tablegen tool.</li>
<li>srcs - the tablegen and other files used by the 'src' file. This attribute may be
required for sandboxing.</li>
<li>out - the generated file's name. Can be prefixed with any number of folders
(for example, <code>toy/Ops.h.inc</code>).</li>
<li>opts - command line options for the tablegen tool.</li>
<li>deps - the list of libraries that provide includes for the .td file.</li>
<li>includes - the list of include dirs to be added to the command line.</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">How to deal with Clang/LLVM/MLIR shared libraries</h3><a id="user-content-how-to-deal-with-clangllvmmlir-shared-libraries" class="anchor-element" aria-label="Permalink: How to deal with Clang/LLVM/MLIR shared libraries" href="#how-to-deal-with-clangllvmmlir-shared-libraries"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Important note for users of the <code>libclang</code>, <code>libclang-cpp</code> and <code>LLVM-C</code> shared
libraries. There are three rules to bring these libraries from the LLVM
installation into the <code>bazel-bin</code>: <code>clang_copy_libclang</code>, <code>clang_copy_libclang_cpp</code>
and <code>llvm_copy_c</code>. Just add the targets into the <code>data</code> attribute of a rule and
they will appear in a <code>bazel-bin/external/&lt;name of llvm_configure repository rule&gt;</code>
directory. Then the libraries can be copied into the <code>bazel-bin</code> (see genrules
in the <code>examples/BUILD</code> file) and be used for running your applications.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Linking against the libc++ standard library</h3><a id="user-content-linking-against-the-libc-standard-library" class="anchor-element" aria-label="Permalink: Linking against the libc++ standard library" href="#linking-against-the-libc-standard-library"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Archives hosted on the <a href="http://releases.llvm.org/download.html" rel="nofollow">http://releases.llvm.org/download.html</a> official website
are usually built against the libc++ standard library. A configuration has been
added to the <code>examples/.bazelrc</code> file to make Bazel link the targets against
libc++. To enable the configuration, an <code>examples/libcxx.bazelrc</code> file must
be generated, the file contains a set of <code>BAZEL_...</code> repository environment
variable to let Bazel know where to look for libc++'s headers and the shared
library file.</p>
<p dir="auto">To generate the file, a python script, <code>generate_libcxx_bazelrc.py</code>, was
developed and placed into the <code>examples</code> directory. The script accepts two
parameters: <code>-I&lt;path to libc++ headers such as iostream or string&gt;</code> and
<code>-L&lt;path to libc++ shared library, libc++.so.1&gt;</code>. For example:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ python3 generate_libcxx_bazelrc.py -L/home/user/llvm/lib -I/home/user/llvm/include/c++/v1"><pre>$ python3 generate_libcxx_bazelrc.py -L/home/user/llvm/lib -I/home/user/llvm/include/c++/v1</pre></div>
<p dir="auto">Once a <code>libcxx.bazelrc</code> file has been generated, a build can be started with <code>--config=libc++</code>
option:</p>
<div class="highlight highlight-source-shell notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="$ bazel build --repo_env LLVM_INSTALL_PREFIX=/home/user/llvm --config=libc++ //:clang_list_methods"><pre>$ bazel build --repo_env LLVM_INSTALL_PREFIX=/home/user/llvm --config=libc++ //:clang_list_methods</pre></div>
</article></div>