<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">dumb-init</h1><a id="user-content-dumb-init" class="anchor" aria-label="Permalink: dumb-init" href="#dumb-init"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://pypi.python.org/pypi/dumb-init" rel="nofollow"><img src="https://camo.githubusercontent.com/4b8307e364765326186686c1e109ea6e81907b2f7695d7d5f3a6aceb10940149/68747470733a2f2f62616467652e667572792e696f2f70792f64756d622d696e69742e737667" alt="PyPI version" data-canonical-src="https://badge.fury.io/py/dumb-init.svg" style="max-width: 100%;"></a></p>
<p dir="auto"><strong>dumb-init</strong> is a simple process supervisor and init system designed to run as
PID 1 inside minimal container environments (such as <a href="https://www.docker.com/" rel="nofollow">Docker</a>). It is
deployed as a small, statically-linked binary written in C.</p>
<p dir="auto">Lightweight containers have popularized the idea of running a single process or
service without normal init systems like <a href="https://wiki.freedesktop.org/www/Software/systemd/" rel="nofollow">systemd</a> or
<a href="https://wiki.archlinux.org/index.php/SysVinit" rel="nofollow">sysvinit</a>. However, omitting an init system often leads to incorrect
handling of processes and signals, and can result in problems such as
containers which can't be gracefully stopped, or leaking containers which
should have been destroyed.</p>
<p dir="auto"><code>dumb-init</code> enables you to simply prefix your command with <code>dumb-init</code>. It acts
as PID 1 and immediately spawns your command as a child process, taking care to
properly handle and forward signals as they are received.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Why you need an init system</h2><a id="user-content-why-you-need-an-init-system" class="anchor" aria-label="Permalink: Why you need an init system" href="#why-you-need-an-init-system"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Normally, when you launch a Docker container, the process you're executing
becomes PID 1, giving it the quirks and responsibilities that come with being
the init system for the container.</p>
<p dir="auto">There are two common issues this presents:</p>
<ol dir="auto">
<li>
<p dir="auto">In most cases, signals won't be handled properly.</p>
<p dir="auto">The Linux kernel applies special signal handling to processes which run as
PID 1.</p>
<p dir="auto">When processes are sent a signal on a normal Linux system, the kernel will
first check for any custom handlers the process has registered for that
signal, and otherwise fall back to default behavior (for example, killing
the process on <code>SIGTERM</code>).</p>
<p dir="auto">However, if the process receiving the signal is PID 1, it gets special
treatment by the kernel; if it hasn't registered a handler for the signal,
the kernel won't fall back to default behavior, and nothing happens. In
other words, if your process doesn't explicitly handle these signals,
sending it <code>SIGTERM</code> will have no effect at all.</p>
<p dir="auto">A common example is CI jobs that do <code>docker run my-container script</code>: sending
<code>SIGTERM</code> to the <code>docker run</code> process will typically kill the <code>docker run</code> command,
but leave the container running in the background.</p>
</li>
<li>
<p dir="auto">Orphaned zombie processes aren't properly reaped.</p>
<p dir="auto">A process becomes a zombie when it exits, and remains a zombie until its
parent calls some variation of the <code>wait()</code> system call on it. It remains in
the process table as a "defunct" process. Typically, a parent process will
call <code>wait()</code> immediately and avoid long-living zombies.</p>
<p dir="auto">If a parent exits before its child, the child is "orphaned", and is
re-parented under PID 1. The init system is thus responsible for
<code>wait()</code>-ing on orphaned zombie processes.</p>
<p dir="auto">Of course, most processes <em>won't</em> <code>wait()</code> on random processes that happen
to become attached to them, so containers often end with dozens of zombies
rooted at PID 1.</p>
</li>
</ol>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">What <code>dumb-init</code> does</h2><a id="user-content-what-dumb-init-does" class="anchor" aria-label="Permalink: What dumb-init does" href="#what-dumb-init-does"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>dumb-init</code> runs as PID 1, acting like a simple init system. It launches a
single process and then proxies all received signals to a session rooted at
that child process.</p>
<p dir="auto">Since your actual process is no longer PID 1, when it receives signals from
<code>dumb-init</code>, the default signal handlers will be applied, and your process will
behave as you would expect. If your process dies, <code>dumb-init</code> will also die,
taking care to clean up any other processes that might still remain.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Session behavior</h3><a id="user-content-session-behavior" class="anchor" aria-label="Permalink: Session behavior" href="#session-behavior"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">In its default mode, <code>dumb-init</code> establishes a
<a href="http://man7.org/linux/man-pages/man2/setsid.2.html" rel="nofollow">session</a> rooted at the
child, and sends signals to the entire process group. This is useful if you
have a poorly-behaving child (such as a shell script) which won't normally
signal its children before dying.</p>
<p dir="auto">This can actually be useful outside of Docker containers in regular process
supervisors like <a href="http://cr.yp.to/daemontools.html" rel="nofollow">daemontools</a> or <a href="http://supervisord.org/" rel="nofollow">supervisord</a> for
supervising shell scripts. Normally, a signal like <code>SIGTERM</code> received by a
shell isn't forwarded to subprocesses; instead, only the shell process dies.
With dumb-init, you can just write shell scripts with dumb-init in the shebang:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="#!/usr/bin/dumb-init /bin/sh
my-web-server &amp;  # launch a process in the background
my-other-server  # launch another process in the foreground"><pre class="notranslate"><code>#!/usr/bin/dumb-init /bin/sh
my-web-server &amp;  # launch a process in the background
my-other-server  # launch another process in the foreground
</code></pre></div>
<p dir="auto">Ordinarily, a <code>SIGTERM</code> sent to the shell would kill the shell but leave those
processes running (both the background and foreground!).  With dumb-init, your
subprocesses will receive the same signals your shell does.</p>
<p dir="auto">If you'd like for signals to only be sent to the direct child, you can run with
the <code>--single-child</code> argument, or set the environment variable
<code>DUMB_INIT_SETSID=0</code> when running <code>dumb-init</code>. In this mode, dumb-init is
completely transparent; you can even string multiple together (like <code>dumb-init dumb-init echo 'oh, hi'</code>).</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Signal rewriting</h3><a id="user-content-signal-rewriting" class="anchor" aria-label="Permalink: Signal rewriting" href="#signal-rewriting"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">dumb-init allows rewriting incoming signals before proxying them. This is
useful in cases where you have a Docker supervisor (like Mesos or Kubernetes)
which always sends a standard signal (e.g. SIGTERM). Some apps require a
different stop signal in order to do graceful cleanup.</p>
<p dir="auto">For example, to rewrite the signal SIGTERM (number 15) to SIGQUIT (number 3),
just add <code>--rewrite 15:3</code> on the command line.</p>
<p dir="auto">To drop a signal entirely, you can rewrite it to the special number <code>0</code>.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Signal rewriting special case</h4><a id="user-content-signal-rewriting-special-case" class="anchor" aria-label="Permalink: Signal rewriting special case" href="#signal-rewriting-special-case"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">When running in setsid mode, it is not sufficient to forward
<code>SIGTSTP</code>/<code>SIGTTIN</code>/<code>SIGTTOU</code> in most cases, since if the process has not added
a custom signal handler for these signals, then the kernel will not apply
default signal handling behavior (which would be suspending the process) since
it is a member of an orphaned process group. For this reason, we set default
rewrites to <code>SIGSTOP</code> from those three signals. You can opt out of this
behavior by rewriting the signals back to their original values, if desired.</p>
<p dir="auto">One caveat with this feature: for job control signals (<code>SIGTSTP</code>, <code>SIGTTIN</code>,
<code>SIGTTOU</code>), dumb-init will always suspend itself after receiving the signal,
even if you rewrite it to something else.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Installing inside Docker containers</h2><a id="user-content-installing-inside-docker-containers" class="anchor" aria-label="Permalink: Installing inside Docker containers" href="#installing-inside-docker-containers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You have a few options for using <code>dumb-init</code>:</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Option 1: Installing from your distro's package repositories (Debian, Ubuntu, etc.)</h3><a id="user-content-option-1-installing-from-your-distros-package-repositories-debian-ubuntu-etc" class="anchor" aria-label="Permalink: Option 1: Installing from your distro's package repositories (Debian, Ubuntu, etc.)" href="#option-1-installing-from-your-distros-package-repositories-debian-ubuntu-etc"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Many popular Linux distributions (including Debian (since <code>stretch</code>) and Debian
derivatives such as Ubuntu (since <code>bionic</code>)) now contain dumb-init packages in
their official repositories.</p>
<p dir="auto">On Debian-based distributions, you can run <code>apt install dumb-init</code> to install
dumb-init, just like you'd install any other package.</p>
<p dir="auto"><em>Note:</em> Most distro-provided versions of dumb-init are not statically-linked,
unlike the versions we provide (see the other options below). This is normally
perfectly fine, but means that these versions of dumb-init generally won't work
when copied to other Linux distros, unlike the statically-linked versions we
provide.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Option 2: Installing via an internal apt server (Debian/Ubuntu)</h3><a id="user-content-option-2-installing-via-an-internal-apt-server-debianubuntu" class="anchor" aria-label="Permalink: Option 2: Installing via an internal apt server (Debian/Ubuntu)" href="#option-2-installing-via-an-internal-apt-server-debianubuntu"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you have an internal apt server, uploading the <code>.deb</code> to your server is the
recommended way to use <code>dumb-init</code>. In your Dockerfiles, you can simply
<code>apt install dumb-init</code> and it will be available.</p>
<p dir="auto">Debian packages are available from the <a href="https://github.com/Yelp/dumb-init/releases">GitHub Releases tab</a>, or
you can run <code>make builddeb</code> yourself.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Option 3: Installing the <code>.deb</code> package manually (Debian/Ubuntu)</h3><a id="user-content-option-3-installing-the-deb-package-manually-debianubuntu" class="anchor" aria-label="Permalink: Option 3: Installing the .deb package manually (Debian/Ubuntu)" href="#option-3-installing-the-deb-package-manually-debianubuntu"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you don't have an internal apt server, you can use <code>dpkg -i</code> to install the
<code>.deb</code> package. You can choose how you get the <code>.deb</code> onto your container
(mounting a directory or <code>wget</code>-ing it are some options).</p>
<p dir="auto">One possibility is with the following commands in your Dockerfile:</p>
<div class="highlight highlight-source-dockerfile notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="RUN wget https://github.com/Yelp/dumb-init/releases/download/v1.2.5/dumb-init_1.2.5_amd64.deb
RUN dpkg -i dumb-init_*.deb"><pre><span class="pl-k">RUN</span> wget https://github.com/Yelp/dumb-init/releases/download/v1.2.5/dumb-init_1.2.5_amd64.deb
<span class="pl-k">RUN</span> dpkg -i dumb-init_*.deb</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Option 4: Downloading the binary directly</h3><a id="user-content-option-4-downloading-the-binary-directly" class="anchor" aria-label="Permalink: Option 4: Downloading the binary directly" href="#option-4-downloading-the-binary-directly"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Since dumb-init is released as a statically-linked binary, you can usually just
plop it into your images. Here's an example of doing that in a Dockerfile:</p>
<div class="highlight highlight-source-dockerfile notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="RUN wget -O /usr/local/bin/dumb-init https://github.com/Yelp/dumb-init/releases/download/v1.2.5/dumb-init_1.2.5_x86_64
RUN chmod +x /usr/local/bin/dumb-init"><pre><span class="pl-k">RUN</span> wget -O /usr/local/bin/dumb-init https://github.com/Yelp/dumb-init/releases/download/v1.2.5/dumb-init_1.2.5_x86_64
<span class="pl-k">RUN</span> chmod +x /usr/local/bin/dumb-init</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Option 5: Installing from PyPI</h3><a id="user-content-option-5-installing-from-pypi" class="anchor" aria-label="Permalink: Option 5: Installing from PyPI" href="#option-5-installing-from-pypi"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Though <code>dumb-init</code> is written entirely in C, we also provide a Python package
which compiles and installs the binary. It can be installed <a href="https://pypi.python.org/pypi/dumb-init" rel="nofollow">from
PyPI</a> using <code>pip</code>. You'll want to first
install a C compiler (on Debian/Ubuntu, <code>apt-get install gcc</code> is sufficient),
then just <code>pip install dumb-init</code>.</p>
<p dir="auto">As of 1.2.0, the package at PyPI is available as a pre-built wheel archive and does not
need to be compiled on common Linux distributions.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Usage</h2><a id="user-content-usage" class="anchor" aria-label="Permalink: Usage" href="#usage"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Once installed inside your Docker container, simply prefix your commands with
<code>dumb-init</code> (and make sure that you're using <a href="https://docs.docker.com/engine/reference/builder/#run" rel="nofollow">the recommended JSON
syntax</a>).</p>
<p dir="auto">Within a Dockerfile, it's a good practice to use dumb-init as your container's
entrypoint. An "entrypoint" is a partial command that gets prepended to your
<code>CMD</code> instruction, making it a great fit for dumb-init:</p>
<div class="highlight highlight-source-dockerfile notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# Runs &quot;/usr/bin/dumb-init -- /my/script --with --args&quot;
ENTRYPOINT [&quot;/usr/bin/dumb-init&quot;, &quot;--&quot;]

# or if you use --rewrite or other cli flags
# ENTRYPOINT [&quot;dumb-init&quot;, &quot;--rewrite&quot;, &quot;2:3&quot;, &quot;--&quot;]

CMD [&quot;/my/script&quot;, &quot;--with&quot;, &quot;--args&quot;]"><pre><span class="pl-c"><span class="pl-c">#</span> Runs "/usr/bin/dumb-init -- /my/script --with --args"</span>
<span class="pl-k">ENTRYPOINT</span> [<span class="pl-s">"/usr/bin/dumb-init"</span>, <span class="pl-s">"--"</span>]

<span class="pl-c"><span class="pl-c">#</span> or if you use --rewrite or other cli flags</span>
<span class="pl-c"><span class="pl-c">#</span> ENTRYPOINT ["dumb-init", "--rewrite", "2:3", "--"]</span>

<span class="pl-k">CMD</span> [<span class="pl-s">"/my/script"</span>, <span class="pl-s">"--with"</span>, <span class="pl-s">"--args"</span>]</pre></div>
<p dir="auto">If you declare an entrypoint in a base image, any images that descend from it
don't need to also declare dumb-init. They can just set a <code>CMD</code> as usual.</p>
<p dir="auto">For interactive one-off usage, you can just prepend it manually:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ docker run my_container dumb-init python -c 'while True: pass'"><pre class="notranslate"><code>$ docker run my_container dumb-init python -c 'while True: pass'
</code></pre></div>
<p dir="auto">Running this same command without <code>dumb-init</code> would result in being unable to
stop the container without <code>SIGKILL</code>, but with <code>dumb-init</code>, you can send it
more humane signals like <code>SIGTERM</code>.</p>
<p dir="auto">It's important that you use <a href="https://docs.docker.com/engine/reference/builder/#run" rel="nofollow">the JSON syntax</a> for <code>CMD</code> and
<code>ENTRYPOINT</code>. Otherwise, Docker invokes a shell to run your command, resulting
in the shell as PID 1 instead of dumb-init.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Using a shell for pre-start hooks</h3><a id="user-content-using-a-shell-for-pre-start-hooks" class="anchor" aria-label="Permalink: Using a shell for pre-start hooks" href="#using-a-shell-for-pre-start-hooks"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Often containers want to do some pre-start work which can't be done during
build time. For example, you might want to template out some config files based
on environment variables.</p>
<p dir="auto">The best way to integrate that with dumb-init is like this:</p>
<div class="highlight highlight-source-dockerfile notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="ENTRYPOINT [&quot;/usr/bin/dumb-init&quot;, &quot;--&quot;]
CMD [&quot;bash&quot;, &quot;-c&quot;, &quot;do-some-pre-start-thing &amp;&amp; exec my-server&quot;]"><pre><span class="pl-k">ENTRYPOINT</span> [<span class="pl-s">"/usr/bin/dumb-init"</span>, <span class="pl-s">"--"</span>]
<span class="pl-k">CMD</span> [<span class="pl-s">"bash"</span>, <span class="pl-s">"-c"</span>, <span class="pl-s">"do-some-pre-start-thing &amp;&amp; exec my-server"</span>]</pre></div>
<p dir="auto">By still using dumb-init as the entrypoint, you always have a proper init
system in place.</p>
<p dir="auto">The <code>exec</code> portion of the bash command is important because it <a href="https://en.wikipedia.org/wiki/Exec_(system_call)" rel="nofollow">replaces the
bash process</a> with your server, so that the shell only exists momentarily
at start.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Building dumb-init</h2><a id="user-content-building-dumb-init" class="anchor" aria-label="Permalink: Building dumb-init" href="#building-dumb-init"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Building the dumb-init binary requires a working compiler and libc headers and
defaults to glibc.</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ make"><pre class="notranslate"><code>$ make
</code></pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Building with musl</h3><a id="user-content-building-with-musl" class="anchor" aria-label="Permalink: Building with musl" href="#building-with-musl"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Statically compiled dumb-init is over 700KB due to glibc, but musl is now an
option. On Debian/Ubuntu <code>apt-get install musl-tools</code> to install the source and
wrappers, then just:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="$ CC=musl-gcc make"><pre class="notranslate"><code>$ CC=musl-gcc make
</code></pre></div>
<p dir="auto">When statically compiled with musl the binary size is around 20KB.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Building the Debian package</h3><a id="user-content-building-the-debian-package" class="anchor" aria-label="Permalink: Building the Debian package" href="#building-the-debian-package"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">We use the standard Debian conventions for specifying build dependencies (look
in <code>debian/control</code>). An easy way to get started is to <code>apt-get install build-essential devscripts equivs</code>, and then <code>sudo mk-build-deps -i --remove</code>
to install all of the missing build dependencies automatically. You can then
use <code>make builddeb</code> to build dumb-init Debian packages.</p>
<p dir="auto">If you prefer an automated Debian package build using Docker, just run <code>make builddeb-docker</code>. This is easier, but requires you to have Docker running on
your machine.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">See also</h2><a id="user-content-see-also" class="anchor" aria-label="Permalink: See also" href="#see-also"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="https://blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem/" rel="nofollow">Docker and the PID 1 zombie reaping problem (Phusion Blog)</a></li>
<li><a href="https://medium.com/@gchudnov/trapping-signals-in-docker-containers-7a57fdda7d86" rel="nofollow">Trapping signals in Docker containers (@gchudnov)</a></li>
<li><a href="https://github.com/krallin/tini">tini</a>, an alternative to dumb-init</li>
<li><a href="https://github.com/fpco/pid1">pid1</a>, an alternative to dumb-init, written in Haskell</li>
</ul>
</article></div>