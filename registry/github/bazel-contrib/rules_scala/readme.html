<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 class="heading-element" dir="auto">Scala Rules for Bazel</h1><a id="user-content-scala-rules-for-bazel" class="anchor" aria-label="Permalink: Scala Rules for Bazel" href="#scala-rules-for-bazel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://buildkite.com/bazel/scala-rules-scala-postsubmit" rel="nofollow"><img src="https://camo.githubusercontent.com/51fd9166f41aead7cb2baeb6681cb7b20527f1b067d7c77af7c2ce5018bc9a65/68747470733a2f2f62616467652e6275696c646b6974652e636f6d2f39306365353234343535366466373464623830356133633234613730336662383734353833393666396531646464363837652e7376673f6272616e63683d6d6173746572" alt="Build status" data-canonical-src="https://badge.buildkite.com/90ce5244556df74db805a3c24a703fb87458396f9e1ddd687e.svg?branch=master" style="max-width: 100%;"></a></p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Where to get help</h2><a id="user-content-where-to-get-help" class="anchor" aria-label="Permalink: Where to get help" href="#where-to-get-help"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="https://bazelbuild.slack.com/archives/CDCKJ2KFZ" rel="nofollow">#scala @ Bazel Slack</a></li>
<li><a href="https://groups.google.com/u/1/g/bazel-scala" rel="nofollow">Google group</a></li>
<li><a href="https://gitter.im/bazelbuild_rules_scala/Lobby" rel="nofollow">Gitter chat</a></li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Overview</h2><a id="user-content-overview" class="anchor" aria-label="Permalink: Overview" href="#overview"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://bazel.build/" rel="nofollow">Bazel</a> is a tool for building and testing software and can handle large,
multi-language projects at scale.</p>
<p dir="auto">This project defines core build rules for <a href="https://www.scala-lang.org/" rel="nofollow">Scala</a> that can be used to build, test, and package Scala projects.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Rules</h2><a id="user-content-rules" class="anchor" aria-label="Permalink: Rules" href="#rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="./docs/scala_library.md">scala_library</a></li>
<li><a href="./docs/scala_macro_library.md">scala_macro_library</a></li>
<li><a href="./docs/scala_binary.md">scala_binary</a></li>
<li><a href="./docs/scala_test.md">scala_test</a></li>
<li><a href="./docs/scala_repl.md">scala_repl</a></li>
<li><a href="./docs/scala_library_suite.md">scala_library_suite</a></li>
<li><a href="./docs/scala_test_suite.md">scala_test_suite</a></li>
<li><a href="./docs/thrift_library.md">thrift_library</a></li>
<li><a href="./docs/scala_proto_library.md">scala_proto_library</a></li>
<li><a href="./docs/scala_toolchain.md">scala_toolchain</a></li>
<li><a href="./docs/scala_import.md">scala_import</a></li>
<li><a href="./docs/scala_doc.md">scala_doc</a></li>
</ul>
<p dir="auto">See the <a href="./docs/">docs</a> directory for documentation on other <code>rules_scala</code>
capabilities as well.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Getting started</h2><a id="user-content-getting-started" class="anchor" aria-label="Permalink: Getting started" href="#getting-started"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://docs.bazel.build/versions/master/install.html" rel="nofollow">Install Bazel</a>, preferably using the <a href="https://docs.bazel.build/versions/master/install.html" rel="nofollow">Bazelisk</a> wrapper. See the
<a href="#compatible-bazel-versions">compatible Bazel versions</a> section to select a suitable
Bazel version.</p>
<p dir="auto">Add the following configuration snippet to your <code>MODULE.bazel</code> file and update
the release <code>&lt;VERSION&gt;</code> as specified on the <a href="https://github.com/bazelbuild/rules_scala/releases">rules_scala releases
page</a>.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# MODULE.bazel

# You can add `repo_name = &quot;io_bazel_rules_scala&quot;` if you still need it.
bazel_dep(name = &quot;rules_scala&quot;, version = &quot;&lt;VERSION&gt;&quot;)

# Selects the Scala version and other configuration parameters.
#
# 2.12 is the default version. Use other versions by passing them explicitly, as
# illustrated below.
#
# See the documentation of `_settings_attrs` in `scala/extensions/config.bzl`
# for other available parameters.
#
# You may define your own custom toolchain using Maven artifact dependencies
# configured by your `WORKSPACE` file, imported using an external loader like
# https://github.com/bazelbuild/rules_jvm_external. See docs/scala_toolchain.md.
scala_config = use_extension(
    &quot;@rules_scala//scala/extensions:config.bzl&quot;,
    &quot;scala_config&quot;,
)
scala_config.settings(scala_version = &quot;2.13.16&quot;)

# See the `scala/extensions/deps.bzl` docstring for a high level description of
# the tag classes exported by this module extension.
scala_deps = use_extension(
    &quot;@rules_scala//scala/extensions:deps.bzl&quot;,
    &quot;scala_deps&quot;,
)

# Defines a default toolchain repo for the configured Scala version that loads
# Maven deps like the Scala compiler and standard libs. Enable and configure
# other builtin toolchains by instantiating their corresponding tag classes.
# See the documentation in `scala/extensions/deps.bzl` for all builtin
# toolchain configuration options.
#
# On production projects, you may consider defining a custom toolchain to use
# your project's required dependencies instead. In that case, you can omit using
# the module extension and this next line altogether. Or, you can still use the
# module extension to instantiate other optional `rules_scala` toolchains
# without it.
scala_deps.scala()

# The remaining items are optional, enabling the precompiled protocol compiler
# toolchain via `--incompatible_enable_proto_toolchain_resolution`. See the
# &quot;Using a precompiled protocol compiler&quot; section below.
scala_protoc = use_extension(
    &quot;@rules_scala//scala/extensions:protoc.bzl&quot;,
    &quot;scala_protoc&quot;,
    dev_dependency = True,
)
use_repo(scala_protoc, &quot;rules_scala_protoc_toolchains&quot;)

# Register this toolchain before any others in the file. Still safe even when
# `--incompatible_enable_proto_toolchain_resolution` is `False`.
register_toolchains(
    &quot;@rules_scala_protoc_toolchains//...:all&quot;,
    dev_dependency = True,
)

# Temporarily required for protocol compiler toolchainization until resolution
# of protocolbuffers/protobuf#19679. Assumes having copied
# `protoc/0001-protobuf-19679-rm-protoc-dep.patch` from `rules_scala` to
# `protobuf.patch` in the root package. See the &quot;Using a precompiled protocol
# compiler&quot; section below.
bazel_dep(
    name = &quot;protobuf&quot;,
    version = &quot;30.2&quot;,
    repo_name = &quot;com_google_protobuf&quot;,
)
single_version_override(
    module_name = &quot;protobuf&quot;,
    patch_strip = 1,
    patches = [&quot;//:protobuf.patch&quot;],
    version = &quot;30.2&quot;,
)"><pre><span class="pl-c"># MODULE.bazel</span>

<span class="pl-c"># You can add `repo_name = "io_bazel_rules_scala"` if you still need it.</span>
<span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_scala"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"&lt;VERSION&gt;"</span>)

<span class="pl-c"># Selects the Scala version and other configuration parameters.</span>
<span class="pl-c">#</span>
<span class="pl-c"># 2.12 is the default version. Use other versions by passing them explicitly, as</span>
<span class="pl-c"># illustrated below.</span>
<span class="pl-c">#</span>
<span class="pl-c"># See the documentation of `_settings_attrs` in `scala/extensions/config.bzl`</span>
<span class="pl-c"># for other available parameters.</span>
<span class="pl-c">#</span>
<span class="pl-c"># You may define your own custom toolchain using Maven artifact dependencies</span>
<span class="pl-c"># configured by your `WORKSPACE` file, imported using an external loader like</span>
<span class="pl-c"># https://github.com/bazelbuild/rules_jvm_external. See docs/scala_toolchain.md.</span>
<span class="pl-s1">scala_config</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(
    <span class="pl-s">"@rules_scala//scala/extensions:config.bzl"</span>,
    <span class="pl-s">"scala_config"</span>,
)
<span class="pl-s1">scala_config</span>.<span class="pl-c1">settings</span>(<span class="pl-s1">scala_version</span> <span class="pl-c1">=</span> <span class="pl-s">"2.13.16"</span>)

<span class="pl-c"># See the `scala/extensions/deps.bzl` docstring for a high level description of</span>
<span class="pl-c"># the tag classes exported by this module extension.</span>
<span class="pl-s1">scala_deps</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(
    <span class="pl-s">"@rules_scala//scala/extensions:deps.bzl"</span>,
    <span class="pl-s">"scala_deps"</span>,
)

<span class="pl-c"># Defines a default toolchain repo for the configured Scala version that loads</span>
<span class="pl-c"># Maven deps like the Scala compiler and standard libs. Enable and configure</span>
<span class="pl-c"># other builtin toolchains by instantiating their corresponding tag classes.</span>
<span class="pl-c"># See the documentation in `scala/extensions/deps.bzl` for all builtin</span>
<span class="pl-c"># toolchain configuration options.</span>
<span class="pl-c">#</span>
<span class="pl-c"># On production projects, you may consider defining a custom toolchain to use</span>
<span class="pl-c"># your project's required dependencies instead. In that case, you can omit using</span>
<span class="pl-c"># the module extension and this next line altogether. Or, you can still use the</span>
<span class="pl-c"># module extension to instantiate other optional `rules_scala` toolchains</span>
<span class="pl-c"># without it.</span>
<span class="pl-s1">scala_deps</span>.<span class="pl-c1">scala</span>()

<span class="pl-c"># The remaining items are optional, enabling the precompiled protocol compiler</span>
<span class="pl-c"># toolchain via `--incompatible_enable_proto_toolchain_resolution`. See the</span>
<span class="pl-c"># "Using a precompiled protocol compiler" section below.</span>
<span class="pl-s1">scala_protoc</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(
    <span class="pl-s">"@rules_scala//scala/extensions:protoc.bzl"</span>,
    <span class="pl-s">"scala_protoc"</span>,
    <span class="pl-s1">dev_dependency</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>,
)
<span class="pl-en">use_repo</span>(<span class="pl-s1">scala_protoc</span>, <span class="pl-s">"rules_scala_protoc_toolchains"</span>)

<span class="pl-c"># Register this toolchain before any others in the file. Still safe even when</span>
<span class="pl-c"># `--incompatible_enable_proto_toolchain_resolution` is `False`.</span>
<span class="pl-en">register_toolchains</span>(
    <span class="pl-s">"@rules_scala_protoc_toolchains//...:all"</span>,
    <span class="pl-s1">dev_dependency</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>,
)

<span class="pl-c"># Temporarily required for protocol compiler toolchainization until resolution</span>
<span class="pl-c"># of protocolbuffers/protobuf#19679. Assumes having copied</span>
<span class="pl-c"># `protoc/0001-protobuf-19679-rm-protoc-dep.patch` from `rules_scala` to</span>
<span class="pl-c"># `protobuf.patch` in the root package. See the "Using a precompiled protocol</span>
<span class="pl-c"># compiler" section below.</span>
<span class="pl-en">bazel_dep</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"protobuf"</span>,
    <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"30.2"</span>,
    <span class="pl-s1">repo_name</span> <span class="pl-c1">=</span> <span class="pl-s">"com_google_protobuf"</span>,
)
<span class="pl-en">single_version_override</span>(
    <span class="pl-s1">module_name</span> <span class="pl-c1">=</span> <span class="pl-s">"protobuf"</span>,
    <span class="pl-s1">patch_strip</span> <span class="pl-c1">=</span> <span class="pl-c1">1</span>,
    <span class="pl-s1">patches</span> <span class="pl-c1">=</span> [<span class="pl-s">"//:protobuf.patch"</span>],
    <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"30.2"</span>,
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Resolving <code>protobuf</code> conflicts</h3><a id="user-content-resolving-protobuf-conflicts" class="anchor" aria-label="Permalink: Resolving protobuf conflicts" href="#resolving-protobuf-conflicts"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If a newer <code>protobuf</code> version in the module graph breaks your build, use
<a href="https://bazel.build/external/module#single-version_override" rel="nofollow"><code>single_version_override</code></a> or <a href="https://bazel.build/external/module#multiple-version_override" rel="nofollow"><code>multiple_version_override</code></a> to fix it:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel_dep(
    name = &quot;protobuf&quot;,
    version = &quot;25.5&quot;,
    repo_name = &quot;com_google_protobuf&quot;,
)
single_version_override(
    module_name = &quot;protobuf&quot;,
    version = &quot;25.5&quot;,
)"><pre><span class="pl-en">bazel_dep</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"protobuf"</span>,
    <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"25.5"</span>,
    <span class="pl-s1">repo_name</span> <span class="pl-c1">=</span> <span class="pl-s">"com_google_protobuf"</span>,
)
<span class="pl-en">single_version_override</span>(
    <span class="pl-s1">module_name</span> <span class="pl-c1">=</span> <span class="pl-s">"protobuf"</span>,
    <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"25.5"</span>,
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Legacy <code>WORKSPACE</code> configuration</h3><a id="user-content-legacy-workspace-configuration" class="anchor" aria-label="Permalink: Legacy WORKSPACE configuration" href="#legacy-workspace-configuration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>rules_scala</code> 7.x enables existing users to migrate to Bzlmod. <code>WORKSPACE</code>
continues to work for Bazel <a href="#6.5.0">6.5.0 (for now)</a>, 7.6.1, and 8, but
<a href="https://bazel.build/external/migration" rel="nofollow"><strong>WORKSPACE is going away in Bazel 9</strong></a>.</p>
<p dir="auto">Add the following configuration snippet to your <code>WORKSPACE</code> file and update the
release <code>&lt;VERSION&gt;</code> and its <code>&lt;SHA256&gt;</code> as specified on the <a href="https://github.com/bazelbuild/rules_scala/releases">rules_scala releases
page</a>. This snippet is designed to ensure that users pick up the
correct order of dependencies for <code>rules_scala</code>. If you want to override any of
the following dependency versions, make sure to <code>load()</code> them before calling
<code>rules_scala_dependencies()</code>.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# WORKSPACE
load(&quot;@bazel_tools//tools/build_defs/repo:http.bzl&quot;, &quot;http_archive&quot;)

# See https://github.com/bazelbuild/rules_scala/releases for up to date version
# information, including `&lt;VERSION&gt;` and `&lt;SHA256&gt;` values.
http_archive(
    name = &quot;rules_scala&quot;,  # Can be &quot;io_bazel_rules_scala&quot; if you still need it.
    sha256 = &quot;&lt;SHA256&gt;&quot;,
    strip_prefix = &quot;rules_scala-&lt;VERSION&gt;&quot;,
    url = &quot;https://github.com/bazelbuild/rules_scala/releases/download/&lt;VERSION&gt;/rules_scala-&lt;VERSION&gt;.tar.gz&quot;,
)

# This imports the minimum versions supported by the minimum supported Bazel
# version, plus `rules_java` 8.5.0. If you use `rules_java` 7 or an earlier
# `rules_java` 8 version, the corresponding `load` statements are slightly
# different. See the `WORKSPACE` snippet from
# https://github.com/bazelbuild/rules_java/releases corresponding to the
# `rules_java` version for details.
#
# Also, this imports `rules_proto` 6.0.2, though 6.0.0 will work. This is
# because the `WORKSPACE` snippets for different versions of `rules_proto` vary
# somewhat, and the 6.0.2 snippet works with the latest version. See
# https://github.com/bazelbuild/rules_proto/releases for the corresponding
# `rules_proto` release for details.
#
# If you want the latest dependency versions, change `deps.bzl` to
# `latest_deps.bzl`.
load(&quot;@rules_scala//scala:deps.bzl&quot;, &quot;rules_scala_dependencies&quot;)

rules_scala_dependencies()

# Only include the next two statements if using
# `--incompatible_enable_proto_toolchain_resolution`.
# See the &quot;Using a precompiled protocol compiler&quot; section below.
load(&quot;@platforms//host:extension.bzl&quot;, &quot;host_platform_repo&quot;)

# Instantiates the `@host_platform` repo to work around:
# - https://github.com/bazelbuild/bazel/issues/22558
host_platform_repo(name = &quot;host_platform&quot;)

# This is optional, but register this toolchain before any others. Requires
# invoking the `scala_protoc_toolchains` repo rule, but is safe to include even
# `--incompatible_enable_proto_toolchain_resolution` is `False`.
# See the &quot;Using a precompiled protocol compiler&quot; section below.
register_toolchains(&quot;@rules_scala_protoc_toolchains//...:all&quot;)

load(&quot;@rules_java//java:rules_java_deps.bzl&quot;, &quot;rules_java_dependencies&quot;)

rules_java_dependencies()

load(&quot;@bazel_features//:deps.bzl&quot;, &quot;bazel_features_deps&quot;)

bazel_features_deps()

load(&quot;@bazel_skylib//:workspace.bzl&quot;, &quot;bazel_skylib_workspace&quot;)

bazel_skylib_workspace()

# If you need a specific `rules_python` version, specify it here.
# Otherwise you may get the version defined in the `com_google_protobuf` repo.
http_archive(
    name = &quot;rules_python&quot;,
    sha256 = &quot;2ef40fdcd797e07f0b6abda446d1d84e2d9570d234fddf8fcd2aa262da852d1c&quot;,
    strip_prefix = &quot;rules_python-1.2.0&quot;,
    url = &quot;https://github.com/bazelbuild/rules_python/releases/download/1.2.0/rules_python-1.2.0.tar.gz&quot;,
)

load(&quot;@rules_python//python:repositories.bzl&quot;, &quot;py_repositories&quot;)

py_repositories()

# Note that `rules_java` 8.x suggests loading `protobuf_deps()` after
# `rules_java_dependencies` and before `rules_java_toolchains()`:
# - https://github.com/bazelbuild/rules_java/releases/tag/8.9.0
#
# `rules_java` 7.x also works with this ordering.
load(&quot;@com_google_protobuf//:protobuf_deps.bzl&quot;, &quot;protobuf_deps&quot;)

protobuf_deps()

load(&quot;@rules_java//java:repositories.bzl&quot;, &quot;rules_java_toolchains&quot;)

rules_java_toolchains()

load(&quot;@rules_proto//proto:repositories.bzl&quot;, &quot;rules_proto_dependencies&quot;)

rules_proto_dependencies()

load(&quot;@rules_proto//proto:setup.bzl&quot;, &quot;rules_proto_setup&quot;)

rules_proto_setup()

load(&quot;@rules_proto//proto:toolchains.bzl&quot;, &quot;rules_proto_toolchains&quot;)

rules_proto_toolchains()

# Include this after loading `platforms`, `com_google_protobuf`, and
# `rules_proto` to enable the `//protoc` precompiled protocol compiler
# toolchains. Requires at least `protobuf` v29.0. See the &quot;Using a precompiled
# protocol compiler&quot; section below.
load(&quot;@rules_scala//protoc:toolchains.bzl&quot;, &quot;scala_protoc_toolchains&quot;)

# This name can be anything, but we recommend `rules_scala_protoc_toolchains`.
scala_protoc_toolchains(name = &quot;rules_scala_protoc_toolchains&quot;)

load(&quot;@rules_scala//:scala_config.bzl&quot;, &quot;scala_config&quot;)

# Stores the selected Scala version and other configuration parameters.
#
# 2.12 is the default version. Use other versions by passing them explicitly:
#
#   scala_config(scala_version = &quot;2.13.16&quot;)
#
# You may define your own custom toolchain using Maven artifact dependencies
# configured by your `WORKSPACE` file, imported using an external loader like
# https://github.com/bazelbuild/rules_jvm_external. See docs/scala_toolchain.md.
scala_config()

load(
    &quot;@rules_scala//scala:toolchains.bzl&quot;,
    &quot;scala_register_toolchains&quot;,
    &quot;scala_toolchains&quot;,
)

# Defines a default toolchain repo for the configured Scala version that loads
# Maven deps like the Scala compiler and standard libs. Enable other builtin
# toolchains by setting their corresponding parameters to `True`. See the
# `scala_toolchains()` docstring for all builtin toolchain configuration
# options.
#
# On production projects, you may consider defining a custom toolchain to use
# your project's required dependencies instead. In that case, you can omit
# `scala_toolchains()` or explicitly set `scala = False` if you use it to
# instantiate other builtin toolchains.
scala_toolchains()

scala_register_toolchains()"><pre><span class="pl-c"># WORKSPACE</span>
<span class="pl-en">load</span>(<span class="pl-s">"@bazel_tools//tools/build_defs/repo:http.bzl"</span>, <span class="pl-s">"http_archive"</span>)

<span class="pl-c"># See https://github.com/bazelbuild/rules_scala/releases for up to date version</span>
<span class="pl-c"># information, including `&lt;VERSION&gt;` and `&lt;SHA256&gt;` values.</span>
<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_scala"</span>,  <span class="pl-c"># Can be "io_bazel_rules_scala" if you still need it.</span>
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-s">"&lt;SHA256&gt;"</span>,
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_scala-&lt;VERSION&gt;"</span>,
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"https://github.com/bazelbuild/rules_scala/releases/download/&lt;VERSION&gt;/rules_scala-&lt;VERSION&gt;.tar.gz"</span>,
)

<span class="pl-c"># This imports the minimum versions supported by the minimum supported Bazel</span>
<span class="pl-c"># version, plus `rules_java` 8.5.0. If you use `rules_java` 7 or an earlier</span>
<span class="pl-c"># `rules_java` 8 version, the corresponding `load` statements are slightly</span>
<span class="pl-c"># different. See the `WORKSPACE` snippet from</span>
<span class="pl-c"># https://github.com/bazelbuild/rules_java/releases corresponding to the</span>
<span class="pl-c"># `rules_java` version for details.</span>
<span class="pl-c">#</span>
<span class="pl-c"># Also, this imports `rules_proto` 6.0.2, though 6.0.0 will work. This is</span>
<span class="pl-c"># because the `WORKSPACE` snippets for different versions of `rules_proto` vary</span>
<span class="pl-c"># somewhat, and the 6.0.2 snippet works with the latest version. See</span>
<span class="pl-c"># https://github.com/bazelbuild/rules_proto/releases for the corresponding</span>
<span class="pl-c"># `rules_proto` release for details.</span>
<span class="pl-c">#</span>
<span class="pl-c"># If you want the latest dependency versions, change `deps.bzl` to</span>
<span class="pl-c"># `latest_deps.bzl`.</span>
<span class="pl-en">load</span>(<span class="pl-s">"@rules_scala//scala:deps.bzl"</span>, <span class="pl-s">"rules_scala_dependencies"</span>)

<span class="pl-en">rules_scala_dependencies</span>()

<span class="pl-c"># Only include the next two statements if using</span>
<span class="pl-c"># `--incompatible_enable_proto_toolchain_resolution`.</span>
<span class="pl-c"># See the "Using a precompiled protocol compiler" section below.</span>
<span class="pl-en">load</span>(<span class="pl-s">"@platforms//host:extension.bzl"</span>, <span class="pl-s">"host_platform_repo"</span>)

<span class="pl-c"># Instantiates the `@host_platform` repo to work around:</span>
<span class="pl-c"># - https://github.com/bazelbuild/bazel/issues/22558</span>
<span class="pl-en">host_platform_repo</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"host_platform"</span>)

<span class="pl-c"># This is optional, but register this toolchain before any others. Requires</span>
<span class="pl-c"># invoking the `scala_protoc_toolchains` repo rule, but is safe to include even</span>
<span class="pl-c"># `--incompatible_enable_proto_toolchain_resolution` is `False`.</span>
<span class="pl-c"># See the "Using a precompiled protocol compiler" section below.</span>
<span class="pl-en">register_toolchains</span>(<span class="pl-s">"@rules_scala_protoc_toolchains//...:all"</span>)

<span class="pl-en">load</span>(<span class="pl-s">"@rules_java//java:rules_java_deps.bzl"</span>, <span class="pl-s">"rules_java_dependencies"</span>)

<span class="pl-en">rules_java_dependencies</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@bazel_features//:deps.bzl"</span>, <span class="pl-s">"bazel_features_deps"</span>)

<span class="pl-en">bazel_features_deps</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@bazel_skylib//:workspace.bzl"</span>, <span class="pl-s">"bazel_skylib_workspace"</span>)

<span class="pl-en">bazel_skylib_workspace</span>()

<span class="pl-c"># If you need a specific `rules_python` version, specify it here.</span>
<span class="pl-c"># Otherwise you may get the version defined in the `com_google_protobuf` repo.</span>
<span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_python"</span>,
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-s">"2ef40fdcd797e07f0b6abda446d1d84e2d9570d234fddf8fcd2aa262da852d1c"</span>,
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_python-1.2.0"</span>,
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"https://github.com/bazelbuild/rules_python/releases/download/1.2.0/rules_python-1.2.0.tar.gz"</span>,
)

<span class="pl-en">load</span>(<span class="pl-s">"@rules_python//python:repositories.bzl"</span>, <span class="pl-s">"py_repositories"</span>)

<span class="pl-en">py_repositories</span>()

<span class="pl-c"># Note that `rules_java` 8.x suggests loading `protobuf_deps()` after</span>
<span class="pl-c"># `rules_java_dependencies` and before `rules_java_toolchains()`:</span>
<span class="pl-c"># - https://github.com/bazelbuild/rules_java/releases/tag/8.9.0</span>
<span class="pl-c">#</span>
<span class="pl-c"># `rules_java` 7.x also works with this ordering.</span>
<span class="pl-en">load</span>(<span class="pl-s">"@com_google_protobuf//:protobuf_deps.bzl"</span>, <span class="pl-s">"protobuf_deps"</span>)

<span class="pl-en">protobuf_deps</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@rules_java//java:repositories.bzl"</span>, <span class="pl-s">"rules_java_toolchains"</span>)

<span class="pl-en">rules_java_toolchains</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@rules_proto//proto:repositories.bzl"</span>, <span class="pl-s">"rules_proto_dependencies"</span>)

<span class="pl-en">rules_proto_dependencies</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@rules_proto//proto:setup.bzl"</span>, <span class="pl-s">"rules_proto_setup"</span>)

<span class="pl-en">rules_proto_setup</span>()

<span class="pl-en">load</span>(<span class="pl-s">"@rules_proto//proto:toolchains.bzl"</span>, <span class="pl-s">"rules_proto_toolchains"</span>)

<span class="pl-en">rules_proto_toolchains</span>()

<span class="pl-c"># Include this after loading `platforms`, `com_google_protobuf`, and</span>
<span class="pl-c"># `rules_proto` to enable the `//protoc` precompiled protocol compiler</span>
<span class="pl-c"># toolchains. Requires at least `protobuf` v29.0. See the "Using a precompiled</span>
<span class="pl-c"># protocol compiler" section below.</span>
<span class="pl-en">load</span>(<span class="pl-s">"@rules_scala//protoc:toolchains.bzl"</span>, <span class="pl-s">"scala_protoc_toolchains"</span>)

<span class="pl-c"># This name can be anything, but we recommend `rules_scala_protoc_toolchains`.</span>
<span class="pl-en">scala_protoc_toolchains</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_scala_protoc_toolchains"</span>)

<span class="pl-en">load</span>(<span class="pl-s">"@rules_scala//:scala_config.bzl"</span>, <span class="pl-s">"scala_config"</span>)

<span class="pl-c"># Stores the selected Scala version and other configuration parameters.</span>
<span class="pl-c">#</span>
<span class="pl-c"># 2.12 is the default version. Use other versions by passing them explicitly:</span>
<span class="pl-c">#</span>
<span class="pl-c">#   scala_config(scala_version = "2.13.16")</span>
<span class="pl-c">#</span>
<span class="pl-c"># You may define your own custom toolchain using Maven artifact dependencies</span>
<span class="pl-c"># configured by your `WORKSPACE` file, imported using an external loader like</span>
<span class="pl-c"># https://github.com/bazelbuild/rules_jvm_external. See docs/scala_toolchain.md.</span>
<span class="pl-en">scala_config</span>()

<span class="pl-en">load</span>(
    <span class="pl-s">"@rules_scala//scala:toolchains.bzl"</span>,
    <span class="pl-s">"scala_register_toolchains"</span>,
    <span class="pl-s">"scala_toolchains"</span>,
)

<span class="pl-c"># Defines a default toolchain repo for the configured Scala version that loads</span>
<span class="pl-c"># Maven deps like the Scala compiler and standard libs. Enable other builtin</span>
<span class="pl-c"># toolchains by setting their corresponding parameters to `True`. See the</span>
<span class="pl-c"># `scala_toolchains()` docstring for all builtin toolchain configuration</span>
<span class="pl-c"># options.</span>
<span class="pl-c">#</span>
<span class="pl-c"># On production projects, you may consider defining a custom toolchain to use</span>
<span class="pl-c"># your project's required dependencies instead. In that case, you can omit</span>
<span class="pl-c"># `scala_toolchains()` or explicitly set `scala = False` if you use it to</span>
<span class="pl-c"># instantiate other builtin toolchains.</span>
<span class="pl-en">scala_toolchains</span>()

<span class="pl-en">scala_register_toolchains</span>()</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Important changes in <code>rules_scala</code> v7.0.0 configuration</h3><a id="user-content-important-changes-in-rules_scala-v700-configuration" class="anchor" aria-label="Permalink: Important changes in rules_scala v7.0.0 configuration" href="#important-changes-in-rules_scala-v700-configuration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The above configuration snippet reflects important changes since <code>rules_scala</code>
v6.x:</p>
<ul dir="auto">
<li>
<p dir="auto"><strong><code>rules_scala</code> no longer requires the <code>io_bazel_rules_scala</code> repository
name</strong> unless your <code>BUILD</code> files or those of your dependencies require it
(<a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2851898312" data-permission-text="Title is private" data-url="https://github.com/bazel-contrib/rules_scala/issues/1696" data-hovercard-type="pull_request" data-hovercard-url="/bazel-contrib/rules_scala/pull/1696/hovercard" href="https://github.com/bazel-contrib/rules_scala/pull/1696">#1696</a>).</p>
<p dir="auto">Update your project's <code>@io_bazel_rules_scala</code> references to <code>@rules_scala</code>
if possible. Otherwise, use <code>repo_name = "io_bazel_rules_scala"</code> in
<code>bazel_dep()</code> or <code>name = "io_bazel_rules_scala"</code> in <code>http_archive</code>.</p>
<p dir="auto">You can use the <code>repo_mapping</code> attribute of <code>http_archive</code> or equivalent
Bzlmod mechanisms to translate <code>@rules_scala</code> to <code>@io_bazel_rules_scala</code> for
dependencies. See the <a href="#repo-mapping">Translating repo names for
dependencies</a> section below for details. (That section is
about <code>@rules_scala_config</code>, but the same mechanisms apply.)</p>
</li>
<li>
<p dir="auto"><strong><code>rules_scala</code> v7.0.0 introduces a new <code>scala_toolchains()</code> API that is
very different from <code>rules_scala</code> 6</strong>. For details on what's changed, see
the <a href="#new-toolchains-api">New 'scala_toolchains()' API for 'WORKSPACE'</a>
section below.</p>
</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Loading the <code>scala_*</code> rules</h3><a id="user-content-loading-the-scala_-rules" class="anchor" aria-label="Permalink: Loading the scala_* rules" href="#loading-the-scala_-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Add the following to your <code>BUILD</code> files to make the <code>scala_*</code> rules available:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(
    &quot;@rules_scala//scala:scala.bzl&quot;,
    &quot;scala_binary&quot;,
    &quot;scala_library&quot;,
    &quot;scala_test&quot;,
)"><pre><span class="pl-en">load</span>(
    <span class="pl-s">"@rules_scala//scala:scala.bzl"</span>,
    <span class="pl-s">"scala_binary"</span>,
    <span class="pl-s">"scala_library"</span>,
    <span class="pl-s">"scala_test"</span>,
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><a id="user-content-protoc"></a>Using a precompiled protocol compiler</h3><a id="user-content-using-a-precompiled-protocol-compiler" class="anchor" aria-label="Permalink: Using a precompiled protocol compiler" href="#using-a-precompiled-protocol-compiler"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>rules_scala</code> now supports the
<a href="https://bazel.build/reference/command-line-reference#flag--incompatible_enable_proto_toolchain_resolution" rel="nofollow"><code>--incompatible_enable_proto_toolchain_resolution</code></a> flag when using <a href="#why-proto-v29">protobuf
v29 or later</a> with the minimum dependency versions specified
below. When using this flag with the <code>MODULE.bazel</code> or <code>WORKSPACE</code>
configurations below, <code>rules_scala</code> will use a precompiled protocol compiler
binary by default.</p>
<p dir="auto"><strong>Windows builds now require using <code>protobuf</code> v29 or later with the precompiled
protocol compiler toolchain.</strong> See the <a href="#protoc-msvc">Windows MSVC builds of protobuf broken
by default</a> section below for details.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Minimum dependency versions</h4><a id="user-content-minimum-dependency-versions" class="anchor" aria-label="Permalink: Minimum dependency versions" href="#minimum-dependency-versions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">These are the minimum dependency versions required to enable the precompiled
protocol compiler toolchain. These are validated by
<a href="./test/shell/test_dependency_versions.sh"><code>test_dependency_versions.sh</code></a>.</p>
<p dir="auto">Note that <code>rules_java</code> can be as low as 8.3.0, compared to <code>rules_java</code> 8.5.0
specified in <a href="#compatible-bazel-versions">Compatible Bazel versions</a>.</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th align="center">Dependency</th>
<th align="center">Minimum version</th>
<th align="left">Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>protobuf</code></td>
<td align="center">v29.0</td>
<td align="left">See the <a href="#why-proto-v29">Why this requires 'protobuf' v29 or later</a> section.</td>
</tr>
<tr>
<td align="center">Bazel</td>
<td align="center">7.1.0 (with <code>rules_java</code> 7.10.0, 8.3.2)<br>7.3.2 (with <code>rules_java</code> 8.3.0)</td>
<td align="left"><code>module(bazel_compatibility = "...")</code> constraints in <code>MODULE.bazel</code></td>
</tr>
<tr>
<td align="center"><code>platforms</code></td>
<td align="center">0.0.9</td>
<td align="left">Creates the <code>@host_platform</code> repo used to auto-detect the toolchain for the host platform.</td>
</tr>
<tr>
<td align="center"><code>rules_java</code></td>
<td align="center">7.10.0 (with <code>--experimental_google_legacy_api</code>), 8.3.0</td>
<td align="left"><code>protobuf</code> v29 needs 7.8.0 with <code>--experimental_google_legacy_api</code> for <code>ProguardSpecProvider</code>. Then it needs 7.10.0 for <code>//java/private:proto_support.bzl</code> visibility.<br><code>protobuf</code> v29 needs <code>@rules_java//java/private:proto_support.bzl</code> from v8.2.0. See <a href="https://github.com/bazelbuild/rules_java/commit/94d5617cf3d97ddda10c81ba05a865e8e3a0408e">bazelbuild/rules_java@94d5617</a>.<br>v8.3.0 fixes <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2593228608" data-permission-text="Title is private" data-url="https://github.com/bazelbuild/rules_java/issues/233" data-hovercard-type="issue" data-hovercard-url="/bazelbuild/rules_java/issues/233/hovercard" href="https://github.com/bazelbuild/rules_java/issues/233">bazelbuild/rules_java#233</a>.</td>
</tr>
<tr>
<td align="center"><code>rules_proto</code></td>
<td align="center">7.0.0</td>
<td align="left">Required by <code>protobuf</code> v29 and later.</td>
</tr>
<tr>
<td align="center"><code>bazel_skylib</code></td>
<td align="center">1.7.0</td>
<td align="left">Contains <code>paths.is_normalized</code>, required by <code>//bazel/private:bazel_proto_library_rule.bzl</code> in <code>protobuf</code> v29. See <a href="https://github.com/bazelbuild/bazel-skylib/commit/0e485c80b7992f5ebfab50637f86e966f544ad58">bazelbuild/bazel-skylib@0e485c8</a>.</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Common setup</h4><a id="user-content-common-setup" class="anchor" aria-label="Permalink: Common setup" href="#common-setup"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To set the flag in your <code>.bazelrc</code> file:</p>
<div class="highlight highlight-text-adblock notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# .bazelrc
common --incompatible_enable_proto_toolchain_resolution"><pre><span class="pl-c"># .bazelrc</span>
common --incompatible_enable_proto_toolchain_resolution</pre></div>
<p dir="auto">In both <code>MODULE.bazel</code> and <code>WORKSPACE</code>, you must register the protocol compiler
toolchains <em>before</em> any other toolchains. It's safe to use even when
<code>--incompatible_enable_proto_toolchain_resolution</code> is <code>False</code>.</p>
<p dir="auto">It is OK to call <code>register_toolchains</code> before using the <code>scala_protoc</code> extension
under Bzlmod, and before the <code>scala_protoc_toolchains()</code> repo rule under
<code>WORKSPACE</code>.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# MODULE.bazel
register_toolchains(
    &quot;@rules_scala_protoc_toolchains//...:all&quot;,
    dev_dependency = True,
)

# WORKSPACE
register_toolchains(&quot;@rules_scala_protoc_toolchains//...:all&quot;)"><pre><span class="pl-c"># MODULE.bazel</span>
<span class="pl-en">register_toolchains</span>(
    <span class="pl-s">"@rules_scala_protoc_toolchains//...:all"</span>,
    <span class="pl-s1">dev_dependency</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>,
)

<span class="pl-c"># WORKSPACE</span>
<span class="pl-en">register_toolchains</span>(<span class="pl-s">"@rules_scala_protoc_toolchains//...:all"</span>)</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Using the <code>scala_protoc</code> module extension under Bzlmod</h4><a id="user-content-using-the-scala_protoc-module-extension-under-bzlmod" class="anchor" aria-label="Permalink: Using the scala_protoc module extension under Bzlmod" href="#using-the-scala_protoc-module-extension-under-bzlmod"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>scala_protoc</code> module extension instantiates the protocol compiler
toolchain under Bzlmod. It <em>must</em> be marked as a <code>dev_dependency</code>.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# MODULE.bazel

scala_protoc = use_extension(
    &quot;@rules_scala//scala/extensions:protoc.bzl&quot;,
    &quot;scala_protoc&quot;,
    dev_dependency = True,
)
use_repo(scala_protoc, &quot;rules_scala_protoc_toolchains&quot;)"><pre><span class="pl-c"># MODULE.bazel</span>

<span class="pl-s1">scala_protoc</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(
    <span class="pl-s">"@rules_scala//scala/extensions:protoc.bzl"</span>,
    <span class="pl-s">"scala_protoc"</span>,
    <span class="pl-s1">dev_dependency</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>,
)
<span class="pl-en">use_repo</span>(<span class="pl-s1">scala_protoc</span>, <span class="pl-s">"rules_scala_protoc_toolchains"</span>)</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Invoking the <code>scala_protoc_toolchains()</code> repo rule under <code>WORKSPACE</code></h4><a id="user-content-invoking-the-scala_protoc_toolchains-repo-rule-under-workspace" class="anchor" aria-label="Permalink: Invoking the scala_protoc_toolchains() repo rule under WORKSPACE" href="#invoking-the-scala_protoc_toolchains-repo-rule-under-workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>scala_protoc_toolchains</code> repo rule instantiates the protocol compiler
toolchain. The repo name can be anything, but we recommend
<code>rules_scala_protoc_toolchains</code>.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# WORKSPACE

# Include this after loading `platforms`, `com_google_protobuf`, and
# `rules_proto`.
load(&quot;@rules_scala//protoc:toolchains.bzl&quot;, &quot;scala_protoc_toolchains&quot;)

scala_protoc_toolchains(name = &quot;rules_scala_protoc_toolchains&quot;)"><pre><span class="pl-c"># WORKSPACE</span>

<span class="pl-c"># Include this after loading `platforms`, `com_google_protobuf`, and</span>
<span class="pl-c"># `rules_proto`.</span>
<span class="pl-en">load</span>(<span class="pl-s">"@rules_scala//protoc:toolchains.bzl"</span>, <span class="pl-s">"scala_protoc_toolchains"</span>)

<span class="pl-en">scala_protoc_toolchains</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_scala_protoc_toolchains"</span>)</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Specifying additional <code>protoc</code> platforms</h4><a id="user-content-specifying-additional-protoc-platforms" class="anchor" aria-label="Permalink: Specifying additional protoc platforms" href="#specifying-additional-protoc-platforms"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Use the <code>platforms</code> parameter to specify additional <a href="https://bazel.build/extending/platforms" rel="nofollow">platforms</a> if the
execution platform may differ from the host platform, as when building with
remote execution. Valid values come from the file name suffixes of
<a href="https://github.com/protocolbuffers/protobuf/releases">protocolbuffers/protobuf releases</a>. It's also safe to explicitly include the
host platform.</p>
<p dir="auto">For example, imagine the host platform is macOS running on Apple Silicon, but
the remote execution platform is Linux running on an x86 processor.
<code>rules_scala</code> configures the <code>"osx-aarch_64"</code> platform automatically. Then in
<code>MODULE.bazel</code> you would include:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# MODULE.bazel

scala_protoc.toolchains(
    platforms = [&quot;linux-x86_64&quot;],
)"><pre><span class="pl-c"># MODULE.bazel</span>

<span class="pl-s1">scala_protoc</span>.<span class="pl-c1">toolchains</span>(
    <span class="pl-s1">platforms</span> <span class="pl-c1">=</span> [<span class="pl-s">"linux-x86_64"</span>],
)</pre></div>
<p dir="auto">In <code>WORKSPACE</code> you would include:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# WORKSPACE

scala_protoc_toolchains(
    name = &quot;rules_scala_protoc_toolchains&quot;,
    platforms = [&quot;linux-x86_64&quot;],
)"><pre><span class="pl-c"># WORKSPACE</span>

<span class="pl-en">scala_protoc_toolchains</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_scala_protoc_toolchains"</span>,
    <span class="pl-s1">platforms</span> <span class="pl-c1">=</span> [<span class="pl-s">"linux-x86_64"</span>],
)</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Temporary required <code>protobuf</code> patch</h4><a id="user-content-temporary-required-protobuf-patch" class="anchor" aria-label="Permalink: Temporary required protobuf patch" href="#temporary-required-protobuf-patch"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">At the moment, enabling protocol compiler toolchainization requires applying
<a href="./protoc/0001-protobuf-19679-rm-protoc-dep.patch">protoc/0001-protobuf-19679-rm-protoc-dep.patch</a>. It is the <code>git diff</code> output
from the branch used to create <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2742615328" data-permission-text="Title is private" data-url="https://github.com/protocolbuffers/protobuf/issues/19679" data-hovercard-type="pull_request" data-hovercard-url="/protocolbuffers/protobuf/pull/19679/hovercard" href="https://github.com/protocolbuffers/protobuf/pull/19679">protocolbuffers/protobuf#19679</a>. Without it, a
transitive dependency on <code>@com_google_protobuf//:protoc</code> remains, causing
<code>protoc</code> to recompile even with the precompiled toolchain registered first.</p>
<p dir="auto">If and when <code>protobuf</code> merges that pull request, or applies an equivalent fix,
this patch will no longer be necessary.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto"><code>protobuf</code> patch setup under Bzlmod</h4><a id="user-content-protobuf-patch-setup-under-bzlmod" class="anchor" aria-label="Permalink: protobuf patch setup under Bzlmod" href="#protobuf-patch-setup-under-bzlmod"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Applying the <code>protobuf</code> patch requires using <a href="https://bazel.build/external/module#single-version_override" rel="nofollow"><code>single_version_override</code></a>,
which also requires that the patch be a regular file in your own repo. In other
words, neither <code>@rules_scala//protoc:0001-protobuf-19679-rm-protoc-dep.patch</code>
nor an <a href="https://bazel.build/reference/be/general#alias" rel="nofollow"><code>alias</code></a> to it will work.</p>
<p dir="auto">Assuming you've copied the patch to a file called <code>protobuf.patch</code> in the root
package of your repository, add the following to your <code>MODULE.bazel</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# MODULE.bazel

# Required for protocol compiler toolchainization until resolution of
# protocolbuffers/protobuf#19679.
bazel_dep(
    name = &quot;protobuf&quot;,
    version = &quot;30.2&quot;,
    repo_name = &quot;com_google_protobuf&quot;,
)
single_version_override(
    module_name = &quot;protobuf&quot;,
    patch_strip = 1,
    patches = [&quot;//:protobuf.patch&quot;],
    version = &quot;30.2&quot;,
)"><pre><span class="pl-c"># MODULE.bazel</span>

<span class="pl-c"># Required for protocol compiler toolchainization until resolution of</span>
<span class="pl-c"># protocolbuffers/protobuf#19679.</span>
<span class="pl-en">bazel_dep</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"protobuf"</span>,
    <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"30.2"</span>,
    <span class="pl-s1">repo_name</span> <span class="pl-c1">=</span> <span class="pl-s">"com_google_protobuf"</span>,
)
<span class="pl-en">single_version_override</span>(
    <span class="pl-s1">module_name</span> <span class="pl-c1">=</span> <span class="pl-s">"protobuf"</span>,
    <span class="pl-s1">patch_strip</span> <span class="pl-c1">=</span> <span class="pl-c1">1</span>,
    <span class="pl-s1">patches</span> <span class="pl-c1">=</span> [<span class="pl-s">"//:protobuf.patch"</span>],
    <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"30.2"</span>,
)</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto"><code>protobuf</code> patch setup under <code>WORKSPACE</code></h4><a id="user-content-protobuf-patch-setup-under-workspace" class="anchor" aria-label="Permalink: protobuf patch setup under WORKSPACE" href="#protobuf-patch-setup-under-workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="./scala/latest-deps.bzl"><code>scala/latest-deps.bzl</code></a> currently applies the
<code>protobuf</code> patch to <code>protobuf</code> v30.2.</p>
<p dir="auto">If you need to apply the patch to a different version of <code>protobuf</code>, copy it to
your repo as described in the Bzlmod setup above. Then apply it in your own
<code>http_archive</code> call:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="http_archive(
    name = &quot;com_google_protobuf&quot;,
    sha256 = &quot;07a43d88fe5a38e434c7f94129cad56a4c43a51f99336074d0799c2f7d4e44c5&quot;,
    strip_prefix = &quot;protobuf-30.2&quot;,
    url = &quot;https://github.com/protocolbuffers/protobuf/archive/refs/tags/v30.2.tar.gz&quot;,
    repo_mapping = {&quot;@com_google_absl&quot;: &quot;@abseil-cpp&quot;},
    patches = [&quot;//protobuf.patch&quot;],
    patch_args = [&quot;-p1&quot;],
)"><pre><span class="pl-en">http_archive</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"com_google_protobuf"</span>,
    <span class="pl-s1">sha256</span> <span class="pl-c1">=</span> <span class="pl-s">"07a43d88fe5a38e434c7f94129cad56a4c43a51f99336074d0799c2f7d4e44c5"</span>,
    <span class="pl-s1">strip_prefix</span> <span class="pl-c1">=</span> <span class="pl-s">"protobuf-30.2"</span>,
    <span class="pl-s1">url</span> <span class="pl-c1">=</span> <span class="pl-s">"https://github.com/protocolbuffers/protobuf/archive/refs/tags/v30.2.tar.gz"</span>,
    <span class="pl-s1">repo_mapping</span> <span class="pl-c1">=</span> {<span class="pl-s">"@com_google_absl"</span>: <span class="pl-s">"@abseil-cpp"</span>},
    <span class="pl-s1">patches</span> <span class="pl-c1">=</span> [<span class="pl-s">"//protobuf.patch"</span>],
    <span class="pl-s1">patch_args</span> <span class="pl-c1">=</span> [<span class="pl-s">"-p1"</span>],
)</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Setting up the <code>@host_platform</code> repo under <code>WORKSPACE</code></h4><a id="user-content-setting-up-the-host_platform-repo-under-workspace" class="anchor" aria-label="Permalink: Setting up the @host_platform repo under WORKSPACE" href="#setting-up-the-host_platform-repo-under-workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>WORKSPACE</code> must include the <code>host_platform_repo</code> snippet from
<a href="#getting-started">Getting started</a> to work around <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2319742942" data-permission-text="Title is private" data-url="https://github.com/bazelbuild/bazel/issues/22558" data-hovercard-type="issue" data-hovercard-url="/bazelbuild/bazel/issues/22558/hovercard" href="https://github.com/bazelbuild/bazel/issues/22558">bazelbuild/bazel#22558</a>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# WORKSPACE
load(&quot;@platforms//host:extension.bzl&quot;, &quot;host_platform_repo&quot;)

# Instantiates the `@host_platform` repo to work around:
# - https://github.com/bazelbuild/bazel/issues/22558
host_platform_repo(name = &quot;host_platform&quot;)"><pre><span class="pl-c"># WORKSPACE</span>
<span class="pl-en">load</span>(<span class="pl-s">"@platforms//host:extension.bzl"</span>, <span class="pl-s">"host_platform_repo"</span>)

<span class="pl-c"># Instantiates the `@host_platform` repo to work around:</span>
<span class="pl-c"># - https://github.com/bazelbuild/bazel/issues/22558</span>
<span class="pl-en">host_platform_repo</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"host_platform"</span>)</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto"><a id="user-content-why-proto-v29"></a>Why this requires <code>protobuf</code> v29 or later</h4><a id="user-content-why-this-requires-protobuf-v29-or-later" class="anchor" aria-label="Permalink: Why this requires protobuf v29 or later" href="#why-this-requires-protobuf-v29-or-later"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Using <code>--incompatible_enable_proto_toolchain_resolution</code> with versions of
<code>protobuf</code> before v29 causes build failures due to a missing internal Bazel
dependency.</p>
<p dir="auto">Bazel's builtin <code>bazel_java_proto_aspect</code> transitively depends on a toolchain
with a <a href="https://bazel.build/extending/toolchains#writing-rules-toolchains" rel="nofollow"><code>toolchain_type</code></a> of <code>@rules_java//java/proto:toolchain_type</code>.
Experimentation with <code>protobuf</code> v28.2 using both Bazel 6.5.0 and 7.5.0 led to
the following error:</p>
<div class="highlight highlight-text-adblock notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="ERROR: .../external/bazel_tools/src/main/protobuf/BUILD:28:15:
  in @@_builtins//:common/java/proto/java_proto_library.bzl%bazel_java_proto_aspect
  aspect on proto_library rule
  @@bazel_tools//src/main/protobuf:worker_protocol_proto:

Traceback (most recent call last):
  File &quot;/virtual_builtins_bzl/common/java/proto/java_proto_library.bzl&quot;,
    line 53, column 53, in _bazel_java_proto_aspect_impl
  File &quot;/virtual_builtins_bzl/common/proto/proto_common.bzl&quot;,
    line 364, column 17, in _find_toolchain
Error in fail: No toolchains registered for
  '@rules_java//java/proto:toolchain_type'.

ERROR: Analysis of target
  '@@bazel_tools//src/main/protobuf:worker_protocol_proto' failed"><pre>ERROR: .../external/bazel_tools/src/main/protobuf/BUILD:28:15:
  in @@_builtins//:common/java/proto/java_proto_library.bzl%bazel_java_proto_aspect
  aspect on proto_library rule
  @@bazel_tools//src/main/protobuf:worker_protocol_proto:

Traceback (most recent call last):
  File "/virtual_builtins_bzl/common/java/proto/java_proto_library.bzl",
    line 53, column 53, in _bazel_java_proto_aspect_impl
  File "/virtual_builtins_bzl/common/proto/proto_common.bzl",
    line 364, column 17, in _find_toolchain
Error in fail: No toolchains registered for
  '@rules_java//java/proto:toolchain_type'.

ERROR: Analysis of target
  '@@bazel_tools//src/main/protobuf:worker_protocol_proto' failed</pre></div>
<p dir="auto">See <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2888049085" data-permission-text="Title is private" data-url="https://github.com/bazel-contrib/rules_scala/issues/1710" data-hovercard-type="pull_request" data-hovercard-url="/bazel-contrib/rules_scala/pull/1710/hovercard" href="https://github.com/bazel-contrib/rules_scala/pull/1710">#1710</a> for details of the experiment.</p>
<p dir="auto">For <code>protobuf</code> v29.0, <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2524888687" data-permission-text="Title is private" data-url="https://github.com/protocolbuffers/protobuf/issues/18308" data-hovercard-type="pull_request" data-hovercard-url="/protocolbuffers/protobuf/pull/18308/hovercard" href="https://github.com/protocolbuffers/protobuf/pull/18308">protocolbuffers/protobuf#18308</a> added the
<a href="https://github.com/protocolbuffers/protobuf/blob/v29.0/bazel/private/toolchains/BUILD.bazel"><code>@protobuf//bazel/private/toolchains</code></a> package and updated
<code>protobuf_deps()</code> from <code>@protobuf//:protobuf_deps.bzl</code> to register it:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="native.register_toolchains(&quot;//bazel/private/toolchains:all&quot;)"><pre><span class="pl-s1">native</span>.<span class="pl-c1">register_toolchains</span>(<span class="pl-s">"//bazel/private/toolchains:all"</span>)</pre></div>
<p dir="auto"><a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2537526713" data-permission-text="Title is private" data-url="https://github.com/protocolbuffers/protobuf/issues/18435" data-hovercard-type="pull_request" data-hovercard-url="/protocolbuffers/protobuf/pull/18435/hovercard" href="https://github.com/protocolbuffers/protobuf/pull/18435">protocolbuffers/protobuf#18435</a> then introduced
<a href="https://github.com/protocolbuffers/protobuf/blob/v29.0/bazel/private/toolchains/BUILD.bazel#L50-L74"><code>java_source_toolchain_bazel7</code></a> with the required
<code>toolchain_type</code>.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">More background on protocol compiler toolchainization</h4><a id="user-content-more-background-on-protocol-compiler-toolchainization" class="anchor" aria-label="Permalink: More background on protocol compiler toolchainization" href="#more-background-on-protocol-compiler-toolchainization"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li>
<p dir="auto"><a href="https://docs.google.com/document/d/1CE6wJHNfKbUPBr7-mmk_0Yo3a4TaqcTPE0OWNuQkhPs/edit" rel="nofollow">Proto Toolchainisation Design Doc</a></p>
</li>
<li>
<p dir="auto"><a href="https://github.com/bazelbuild/bazel/issues/7095" data-hovercard-type="issue" data-hovercard-url="/bazelbuild/bazel/issues/7095/hovercard">bazelbuild/bazel#7095: Protobuf repo recompilation sensitivity</a></p>
</li>
<li>
<p dir="auto"><a href="https://github.com/bazelbuild/rules_proto/issues/179" data-hovercard-type="issue" data-hovercard-url="/bazelbuild/rules_proto/issues/179/hovercard">bazelbuild/rules_proto#179: Implement proto toolchainisation</a></p>
</li>
<li>
<p dir="auto"><a href="https://github.com/bazelbuild/rules_proto/releases/tag/6.0.0">rules_proto 6.0.0 release notes mentioning Protobuf Toolchainization</a></p>
</li>
</ul>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Persistent workers</h3><a id="user-content-persistent-workers" class="anchor" aria-label="Permalink: Persistent workers" href="#persistent-workers"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To run with a persistent worker (much faster), add the following to
your <code>.bazelrc</code> file:</p>
<div class="highlight highlight-text-adblock notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="build --strategy=Scalac=worker
build --worker_sandboxing"><pre>build --strategy=Scalac=worker
build --worker_sandboxing</pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Coverage support</h2><a id="user-content-coverage-support" class="anchor" aria-label="Permalink: Coverage support" href="#coverage-support"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To produce a combined coverage report:</p>
<div class="highlight highlight-text-adblock notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel coverage \
  --combined_report=lcov \
  --coverage_report_generator=&quot;@bazel_tools//tools/test/CoverageOutputGenerator/java/com/google/devtools/coverageoutputgenerator:Main&quot; \
  //..."><pre>bazel coverage \
  --combined_report=lcov \
  --coverage_report_generator="@bazel_tools//tools/test/CoverageOutputGenerator/java/com/google/devtools/coverageoutputgenerator:Main" \
  //...</pre></div>
<p dir="auto">This should produce a single <code>bazel-out/_coverage/_coverage_report.dat</code> from all coverage files that are generated.</p>
<p dir="auto">You can extract information from your coverage reports with
<a href="https://github.com/linux-test-project/lcov"><code>lcov</code></a>:</p>
<div class="highlight highlight-text-adblock notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# For a summary:
lcov --summary your-coverage-report.dat

# For details:
lcov --list your-coverage-report.dat"><pre><span class="pl-c"># For a summary:</span>
lcov --summary your-coverage-report.dat

<span class="pl-c"># For details:</span>
lcov --list your-coverage-report.dat</pre></div>
<p dir="auto">If you prefer an HTML report, then you can use <code>genhtml</code> provided also by the <code>lcov</code> package.</p>
<p dir="auto">Coverage support has been only tested with <a href="http://www.scalatest.org/" rel="nofollow">ScalaTest</a>.</p>
<p dir="auto">Please check <a href="docs/coverage.md">coverage.md</a> for more details on coverage support.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Selecting the Scala version</h2><a id="user-content-selecting-the-scala-version" class="anchor" aria-label="Permalink: Selecting the Scala version" href="#selecting-the-scala-version"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">With builtin toolchains</h3><a id="user-content-with-builtin-toolchains" class="anchor" aria-label="Permalink: With builtin toolchains" href="#with-builtin-toolchains"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>rules_scala</code> supports the last two released minor versions for each of Scala 2.11, 2.12, 2.13.
Previous minor versions may work but are supported only on a best effort basis.</p>
<p dir="auto">The <a href="#getting-started">Getting started</a> section illustrates how to select the
default Scala version and configure its dependencies.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">With custom toolchains</h3><a id="user-content-with-custom-toolchains" class="anchor" aria-label="Permalink: With custom toolchains" href="#with-custom-toolchains"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">You can define your own custom <a href="docs/scala_toolchain.md">scala_toolchain</a> by
calling <code>setup_scala_toolchain()</code> with dependencies that you specify.</p>
<p dir="auto">Note: Toolchains are a more flexible way to configure dependencies, so you should prefer that way.
Please also note, that the <code>overriden_artifacts</code> parameter is likely to be removed in the future.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Multiple versions (cross-compilation)</h3><a id="user-content-multiple-versions-cross-compilation" class="anchor" aria-label="Permalink: Multiple versions (cross-compilation)" href="#multiple-versions-cross-compilation"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>rules_scala</code> supports configuring multiple Scala versions and offers target-level control of which one to use.</p>
<p dir="auto">Please check <a href="docs/cross-compilation.md">cross-compilation.md</a> for more details on cross-compilation support.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Compatible Bazel versions</h2><a id="user-content-compatible-bazel-versions" class="anchor" aria-label="Permalink: Compatible Bazel versions" href="#compatible-bazel-versions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Bazel compatibility is tied directly to the versions of <code>protobuf</code> required by
Bazel and <code>rules_java</code>, and their compatibility with <a href="https://github.com/scalapb/ScalaPB">scalapb/ScalaPB</a> Maven artifacts. For extensive analysis,
see <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2647796826" data-permission-text="Title is private" data-url="https://github.com/bazel-contrib/rules_scala/issues/1647" data-hovercard-type="issue" data-hovercard-url="/bazel-contrib/rules_scala/issues/1647/hovercard" href="https://github.com/bazel-contrib/rules_scala/issues/1647">#1647</a>.</p>
<p dir="auto">The Bazel versions and dependency versions below represent the minimum versions
compatible with <code>rules_scala</code> 7.x.</p>
<ul dir="auto">
<li>
<p dir="auto">For the actual versions used by <code>rules_scala</code>, see
<a href="./MODULE.bazel">MODULE.bazel</a>.</p>
</li>
<li>
<p dir="auto">See <a href="./.bazelci/presubmit.yml">.bazelci/presubmit.yml</a> for the exact Bazel
versions verified by the continuous integration builds.</p>
</li>
</ul>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th align="center">Mode</th>
<th align="center">Supported Bazel versions</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Bzlmod<br>(Coming soon! See <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="1628459968" data-permission-text="Title is private" data-url="https://github.com/bazel-contrib/rules_scala/issues/1482" data-hovercard-type="issue" data-hovercard-url="/bazel-contrib/rules_scala/issues/1482/hovercard" href="https://github.com/bazel-contrib/rules_scala/issues/1482">#1482</a>.)</td>
<td align="center">&gt;= 7.1.0, 8.x,<br><code>rolling</code>, <code>last_green</code></td>
</tr>
<tr>
<td align="center"><code>WORKSPACE</code></td>
<td align="center">6.5.0, &gt;= 7.1.0, 8.x<br>(see the <a href="#6.5.0">notes on 6.5.0 compatibility</a>)</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto"><code>rules_scala</code> 7.0.0 uses <code>ScalaPB</code> 1.0.0-alpha.1 to support <code>protobuf</code> v28.2 and
later, required by newer Bazel versions and other dependencies. Below are the
minimum versions of <code>protobuf</code> and related dependencies supported for Bazel 7
and 8.</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th align="center">Dependency</th>
<th align="center">Bazel &gt;= 7.1.0</th>
<th align="center">Bazel 8.x</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>bazel_skylib</code></td>
<td align="center">1.6.0</td>
<td align="center">1.7.0</td>
</tr>
<tr>
<td align="center"><code>protobuf</code></td>
<td align="center">v28.2</td>
<td align="center">v29.0</td>
</tr>
<tr>
<td align="center"><code>rules_java</code></td>
<td align="center">7.6.0, 8.4.0</td>
<td align="center">8.5.0</td>
</tr>
<tr>
<td align="center"><code>rules_proto</code></td>
<td align="center">6.0.0</td>
<td align="center">7.0.0</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">The next major release will likely drop support for <code>protobuf</code> versions before
v29 and remove <code>rules_proto</code> completely. This is to comply with the guidance in
<a href="https://protobuf.dev/news/v29/" rel="nofollow">Protobuf News: News Announcements for Version 29.x</a>. For more details, see this <a href="https://github.com/bazelbuild/rules_scala/pull/1710#issuecomment-2750001012" data-hovercard-type="pull_request" data-hovercard-url="/bazel-contrib/rules_scala/pull/1710/hovercard">comment from #1710
explaining why rules_proto remains for now</a>.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Using a prebuilt <code>@com_google_protobuf//:protoc</code> or C++ compiler flags</h3><a id="user-content-using-a-prebuilt-com_google_protobufprotoc-or-c-compiler-flags" class="anchor" aria-label="Permalink: Using a prebuilt @com_google_protobuf//:protoc or C++ compiler flags" href="#using-a-prebuilt-com_google_protobufprotoc-or-c-compiler-flags"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Newer versions of <code>abseil-cpp</code>, required by newer versions of
<code>@com_google_protobuf//:protoc</code>, fail to compile under Bazel 6.5.0 by default.
The latest versions of <code>abseil-cpp</code> also fail to compile under Bazel 7 by
default. <a href="#protoc-msvc">protoc will also fail to build on Windows when using
MSVC</a>. You will have to choose one of the following approaches to
resolve this problem.</p>
<p dir="auto">You may use protocol compiler toolchainization with <code>protobuf</code> v29 or later to
avoid recompiling <code>protoc</code>. You may want to enable this even if your build
doesn't break, as it saves time by avoiding frequent <code>protoc</code> recompilation. See
the <a href="#protoc">Using a precompiled protocol compiler</a> section for details.</p>
<p dir="auto">Otherwise, if migrating to Bazel 8 isn't an immediate option, you will need to
set the following compiler flags in <code>.bazelrc</code> per <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2647796826" data-permission-text="Title is private" data-url="https://github.com/bazel-contrib/rules_scala/issues/1647" data-hovercard-type="issue" data-hovercard-url="/bazel-contrib/rules_scala/issues/1647/hovercard" href="https://github.com/bazel-contrib/rules_scala/issues/1647">#1647</a>:</p>
<div class="highlight highlight-text-adblock notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="common --enable_platform_specific_config

common:linux --cxxopt=-std=c++17
common:linux --host_cxxopt=-std=c++17
common:macos --cxxopt=-std=c++17
common:macos --host_cxxopt=-std=c++17
common:windows --cxxopt=/std=c++17
common:windows --host_cxxopt=/std=c++17"><pre>common --enable_platform_specific_config

common:linux --cxxopt=-std=c++17
common:linux --host_cxxopt=-std=c++17
common:macos --cxxopt=-std=c++17
common:macos --host_cxxopt=-std=c++17
common:windows --cxxopt=/std=c++17
common:windows --host_cxxopt=/std=c++17</pre></div>
<p dir="auto">Note that this example uses <code>common:</code> config settings instead of <code>build:</code>. This
seems to prevent invalidating the action cache between <code>bazel</code> runs, which
improves performance.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Usage with <a href="https://github.com/johnynek/bazel-deps">bazel-deps</a></h2><a id="user-content-usage-with-bazel-deps" class="anchor" aria-label="Permalink: Usage with bazel-deps" href="#usage-with-bazel-deps"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Bazel-deps allows you to generate bazel dependencies transitively for maven artifacts. Generally we don't want bazel-deps to fetch
scala artifacts from maven but instead use the ones we get from calling <code>scala_repositories</code>. The artifacts can be overridden in the
dependencies file used by bazel-deps:</p>
<div class="highlight highlight-source-yaml notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="replacements:
  org.scala-lang:
    scala-library:
      lang: scala/unmangled
      target: &quot;@io_bazel_rules_scala_scala_library//:io_bazel_rules_scala_scala_library&quot;
    scala-reflect:
      lang: scala/unmangled
      target: &quot;@io_bazel_rules_scala_scala_reflect//:io_bazel_rules_scala_scala_reflect&quot;
    scala-compiler:
      lang: scala/unmangled
      target: &quot;@io_bazel_rules_scala_scala_compiler//:io_bazel_rules_scala_scala_compiler&quot;

  org.scala-lang.modules:
    scala-parser-combinators:
      lang: scala
      target:
        &quot;@io_bazel_rules_scala_scala_parser_combinators//:io_bazel_rules_scala_scala_parser_combinators&quot;
    scala-xml:
      lang: scala
      target:
        &quot;@io_bazel_rules_scala_scala_xml//:io_bazel_rules_scala_scala_xml&quot;"><pre><span class="pl-ent">replacements</span>:
  <span class="pl-ent">org.scala-lang</span>:
    <span class="pl-ent">scala-library</span>:
      <span class="pl-ent">lang</span>: <span class="pl-s">scala/unmangled</span>
      <span class="pl-ent">target</span>: <span class="pl-s"><span class="pl-pds">"</span>@io_bazel_rules_scala_scala_library//:io_bazel_rules_scala_scala_library<span class="pl-pds">"</span></span>
    <span class="pl-ent">scala-reflect</span>:
      <span class="pl-ent">lang</span>: <span class="pl-s">scala/unmangled</span>
      <span class="pl-ent">target</span>: <span class="pl-s"><span class="pl-pds">"</span>@io_bazel_rules_scala_scala_reflect//:io_bazel_rules_scala_scala_reflect<span class="pl-pds">"</span></span>
    <span class="pl-ent">scala-compiler</span>:
      <span class="pl-ent">lang</span>: <span class="pl-s">scala/unmangled</span>
      <span class="pl-ent">target</span>: <span class="pl-s"><span class="pl-pds">"</span>@io_bazel_rules_scala_scala_compiler//:io_bazel_rules_scala_scala_compiler<span class="pl-pds">"</span></span>

  <span class="pl-ent">org.scala-lang.modules</span>:
    <span class="pl-ent">scala-parser-combinators</span>:
      <span class="pl-ent">lang</span>: <span class="pl-s">scala</span>
      <span class="pl-ent">target</span>:
        <span class="pl-s"><span class="pl-pds">"</span>@io_bazel_rules_scala_scala_parser_combinators//:io_bazel_rules_scala_scala_parser_combinators<span class="pl-pds">"</span></span>
    <span class="pl-ent">scala-xml</span>:
      <span class="pl-ent">lang</span>: <span class="pl-s">scala</span>
      <span class="pl-ent">target</span>:
        <span class="pl-s"><span class="pl-pds">"</span>@io_bazel_rules_scala_scala_xml//:io_bazel_rules_scala_scala_xml<span class="pl-pds">"</span></span></pre></div>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Publishing to Maven repository</h2><a id="user-content-publishing-to-maven-repository" class="anchor" aria-label="Permalink: Publishing to Maven repository" href="#publishing-to-maven-repository"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">See <a href="docs/publish_to_maven.md">Publish your Scala Libraries to a Maven Repository</a>.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Dependency Tracking</h2><a id="user-content-dependency-tracking" class="anchor" aria-label="Permalink: Dependency Tracking" href="#dependency-tracking"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>rules_scala</code> supports multiple dependency modes including strict and unused dependency tracking. See
<a href="docs/dependency-tracking.md">Dependency Tracking</a> for more info.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Advanced configurable rules</h2><a id="user-content-advanced-configurable-rules" class="anchor" aria-label="Permalink: Advanced configurable rules" href="#advanced-configurable-rules"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">To make the ruleset more flexible and configurable, we introduce a phase architecture. By using a phase architecture, where rule implementations are defined as a list of phases that are executed sequentially, functionality can easily be added (or modified) by adding (or swapping) phases.</p>
<p dir="auto">Phases provide 3 major benefits:</p>
<ul dir="auto">
<li>Consumers are able to configure the rules to their specific use cases by
defining new phases within their workspace without impacting other consumers.</li>
<li>Contributors are able to implement new functionalities by creating additional
default phases.</li>
<li>Phases give us more clear idea what steps are shared across rules.</li>
</ul>
<p dir="auto">See <a href="docs/customizable_phase.md">Customizable Phase</a> for more info.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Phase extensions</h3><a id="user-content-phase-extensions" class="anchor" aria-label="Permalink: Phase extensions" href="#phase-extensions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<ul dir="auto">
<li><a href="docs/phase_scalafmt.md">Scala Format</a></li>
</ul>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Building from source</h2><a id="user-content-building-from-source" class="anchor" aria-label="Permalink: Building from source" href="#building-from-source"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Build main sources only:</p>
<div class="highlight highlight-text-adblock notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel build //src/..."><pre>bazel build //src/...</pre></div>
<p dir="auto">Run all smaller tests:</p>
<div class="highlight highlight-text-adblock notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel test //test/..."><pre>bazel test //test/...</pre></div>
<p dir="auto">To run the full test suite:</p>
<div class="highlight highlight-text-adblock notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bash test_all.sh"><pre>bash test_all.sh</pre></div>
<p dir="auto">Note: <strong><code>bazel test //...</code> will not work</strong> since we have a sub-folder on the
root folder which is meant to be used in a failure scenario in the integration
tests. Similarly, to only build you should use <code>bazel build //src/...</code> due to
that folder.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Breaking changes in <code>rules_scala</code> 7.x</h2><a id="user-content-breaking-changes-in-rules_scala-7x" class="anchor" aria-label="Permalink: Breaking changes in rules_scala 7.x" href="#breaking-changes-in-rules_scala-7x"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><strong>The main objective of <code>rules_scala</code> 7.x is to enable existing users to migrate
to Bazel 8 and Bzlmod.</strong> To facilitate a gradual migration, it is compatible
with both Bazel 7 and Bazel 8, and both <code>WORKSPACE</code> and Bzlmod. It remains
compatible with Bazel 6.5.0 builds using <code>WORKSPACE</code> for the time being, but
Bazel 6 is no longer officially supported.</p>
<p dir="auto"><code>rules_java</code> 7.x contains the following breaking changes when upgrading from
<code>rules_scala</code> 6.x.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><a id="user-content-new-toolchains-api"></a>New <code>scala_toolchains()</code> API for <code>WORKSPACE</code></h3><a id="user-content-new-scala_toolchains-api-for-workspace" class="anchor" aria-label="Permalink: New scala_toolchains() API for WORKSPACE" href="#new-scala_toolchains-api-for-workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>rules_scala</code> 7.0.0 replaces existing <code>*_repositories()</code> and <code>*_toolchains()</code>
macros with the combination of <code>rules_scala_dependencies()</code>,
<code>scala_toolchains()</code>, and <code>scala_register_toolchains()</code>.</p>
<p dir="auto">These macros no longer exist:</p>
<ul dir="auto">
<li><code>jmh_repositories()</code></li>
<li><code>junit_repositories()</code></li>
<li><code>junit_toolchain()</code></li>
<li><code>rules_scala_setup()</code></li>
<li><code>rules_scala_toolchain_deps_repositories()</code></li>
<li><code>scala_proto_default_repositories()</code></li>
<li><code>scala_proto_register_enable_all_options_toolchain()</code></li>
<li><code>scala_proto_register_toolchains()</code></li>
<li><code>scala_proto_repositories()</code></li>
<li><code>scala_register_unused_deps_toolchains()</code></li>
<li><code>scala_repositories()</code></li>
<li><code>scalafmt_default_config()</code></li>
<li><code>scalafmt_repositories()</code></li>
<li><code>scalatest_repositories()</code></li>
<li><code>scalatest_toolchain()</code></li>
<li><code>specs2_junit_repositories()</code></li>
<li><code>specs2_repositories()</code></li>
<li><code>specs2_version()</code></li>
<li><code>twitter_scrooge()</code></li>
</ul>
<p dir="auto">Replace toolchain configurations like the following:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(
    &quot;@rules_scala//scala:scala.bzl&quot;,
    &quot;rules_scala_setup&quot;,
    &quot;rules_scala_toolchain_deps_repositories&quot;,
)

rules_scala_setup()

rules_scala_toolchain_deps_repositories(fetch_sources = True)

# Other dependency declarations...

load(&quot;@rules_scala//:scala_config.bzl&quot;, &quot;scala_config&quot;)

scala_config(scala_version = &quot;2.13.16&quot;)

load(
    &quot;//testing:scalatest.bzl&quot;,
    &quot;scalatest_repositories&quot;,
    &quot;scalatest_toolchain&quot;,
)

scalatest_repositories()

scalatest_toolchain()

load(
    &quot;//scala/scalafmt:scalafmt_repositories.bzl&quot;,
    &quot;scalafmt_default_config&quot;,
    &quot;scalafmt_repositories&quot;,
)

scalafmt_default_config()

scalafmt_repositories()"><pre><span class="pl-en">load</span>(
    <span class="pl-s">"@rules_scala//scala:scala.bzl"</span>,
    <span class="pl-s">"rules_scala_setup"</span>,
    <span class="pl-s">"rules_scala_toolchain_deps_repositories"</span>,
)

<span class="pl-en">rules_scala_setup</span>()

<span class="pl-en">rules_scala_toolchain_deps_repositories</span>(<span class="pl-s1">fetch_sources</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>)

<span class="pl-c"># Other dependency declarations...</span>

<span class="pl-en">load</span>(<span class="pl-s">"@rules_scala//:scala_config.bzl"</span>, <span class="pl-s">"scala_config"</span>)

<span class="pl-en">scala_config</span>(<span class="pl-s1">scala_version</span> <span class="pl-c1">=</span> <span class="pl-s">"2.13.16"</span>)

<span class="pl-en">load</span>(
    <span class="pl-s">"//testing:scalatest.bzl"</span>,
    <span class="pl-s">"scalatest_repositories"</span>,
    <span class="pl-s">"scalatest_toolchain"</span>,
)

<span class="pl-en">scalatest_repositories</span>()

<span class="pl-en">scalatest_toolchain</span>()

<span class="pl-en">load</span>(
    <span class="pl-s">"//scala/scalafmt:scalafmt_repositories.bzl"</span>,
    <span class="pl-s">"scalafmt_default_config"</span>,
    <span class="pl-s">"scalafmt_repositories"</span>,
)

<span class="pl-en">scalafmt_default_config</span>()

<span class="pl-en">scalafmt_repositories</span>()</pre></div>
<p dir="auto">with calls to <code>rules_scala_dependencies()</code>, <code>scala_toolchains()</code> (with the
appropriate parameters set), and <code>scala_register_toolchains()</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_scala//scala:deps.bzl&quot;, &quot;rules_scala_dependencies&quot;)

rules_scala_dependencies()

# See the `WORKSPACE` configuration snippet from the &quot;Getting started&quot; section
# above for other dependency declarations.

load(&quot;@rules_scala//:scala_config.bzl&quot;, &quot;scala_config&quot;)

scala_config(scala_version = &quot;2.13.16&quot;)

load(
    &quot;@rules_scala//scala:toolchains.bzl&quot;,
    &quot;scala_register_toolchains&quot;,
    &quot;scala_toolchains&quot;,
)

scala_toolchains(
    scalafmt = True,
    scalatest = True,
)

scala_register_toolchains()"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_scala//scala:deps.bzl"</span>, <span class="pl-s">"rules_scala_dependencies"</span>)

<span class="pl-en">rules_scala_dependencies</span>()

<span class="pl-c"># See the `WORKSPACE` configuration snippet from the "Getting started" section</span>
<span class="pl-c"># above for other dependency declarations.</span>

<span class="pl-en">load</span>(<span class="pl-s">"@rules_scala//:scala_config.bzl"</span>, <span class="pl-s">"scala_config"</span>)

<span class="pl-en">scala_config</span>(<span class="pl-s1">scala_version</span> <span class="pl-c1">=</span> <span class="pl-s">"2.13.16"</span>)

<span class="pl-en">load</span>(
    <span class="pl-s">"@rules_scala//scala:toolchains.bzl"</span>,
    <span class="pl-s">"scala_register_toolchains"</span>,
    <span class="pl-s">"scala_toolchains"</span>,
)

<span class="pl-en">scala_toolchains</span>(
    <span class="pl-s1">scalafmt</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>,
    <span class="pl-s1">scalatest</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>,
)

<span class="pl-en">scala_register_toolchains</span>()</pre></div>
<p dir="auto">See the <a href="./scala/toolchains.bzl"><code>scala_toolchains()</code></a> docstring for the
parameter list, which is almost in complete correspondence with parameters from
the previous macros. The <code>WORKSPACE</code> files in this repository also provide many
examples.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Replacing toolchain registration macros</h3><a id="user-content-replacing-toolchain-registration-macros" class="anchor" aria-label="Permalink: Replacing toolchain registration macros" href="#replacing-toolchain-registration-macros"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Almost all <code>rules_scala</code> toolchains configured using <code>scala_toolchains()</code> are
automatically registered by <code>scala_register_toolchains()</code>. The same is true for
toolchains configured using the <code>scala_deps</code> module extension under Bzlmod.
There are two toolchain macro replacements that require special handling.</p>
<p dir="auto">The first is replacing <code>scala_proto_register_enable_all_options_toolchain()</code>
with the following:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# MODULE.bazel

scala_deps.scala_proto(
    &quot;default_gen_opts&quot; = [
        &quot;flat_package&quot;,
        &quot;grpc&quot;,
        &quot;single_line_to_proto_string&quot;,
    ],
)

# WORKSPACE
scala_toolchains(
    scala_proto = {
        &quot;default_gen_opts&quot;: [
            &quot;flat_package&quot;,
            &quot;grpc&quot;,
            &quot;single_line_to_proto_string&quot;,
        ],
    },
)"><pre><span class="pl-c"># MODULE.bazel</span>

<span class="pl-s1">scala_deps</span>.<span class="pl-c1">scala_proto</span>(
    <span class="pl-s">"default_gen_opts"</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"flat_package"</span>,
        <span class="pl-s">"grpc"</span>,
        <span class="pl-s">"single_line_to_proto_string"</span>,
    ],
)

<span class="pl-c"># WORKSPACE</span>
<span class="pl-en">scala_toolchains</span>(
    <span class="pl-s1">scala_proto</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"default_gen_opts"</span>: [
            <span class="pl-s">"flat_package"</span>,
            <span class="pl-s">"grpc"</span>,
            <span class="pl-s">"single_line_to_proto_string"</span>,
        ],
    },
)</pre></div>
<p dir="auto">The other is replacing <code>scala_register_unused_deps_toolchains()</code> with an
explicit <code>register_toolchains()</code> call:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="register_toolchains(
    &quot;@rules_scala//scala:unused_dependency_checker_error_toolchain&quot;,
)"><pre><span class="pl-en">register_toolchains</span>(
    <span class="pl-s">"@rules_scala//scala:unused_dependency_checker_error_toolchain"</span>,
)</pre></div>
<p dir="auto">In <code>WORKSPACE</code>, this <code>register_toolchains()</code> call must come before calling
<code>scala_register_toolchains()</code> to ensure this toolchain takes precedence. The
same exact call will also work in <code>MODULE.bazel</code>.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Disabling builtin Scala toolchains when defining custom Scala toolchains</h3><a id="user-content-disabling-builtin-scala-toolchains-when-defining-custom-scala-toolchains" class="anchor" aria-label="Permalink: Disabling builtin Scala toolchains when defining custom Scala toolchains" href="#disabling-builtin-scala-toolchains-when-defining-custom-scala-toolchains"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">When <a href="docs/scala_toolchain.md#b-defining-your-own-scala_toolchain">using 'setup_scala_toolchain()' with custom compiler JARs</a>, don't use
<code>scala_deps</code> or <code>scala_toolchains()</code> if you don't need any other builtin
toolchains.</p>
<p dir="auto">If you do need other builtin toolchains when using Bzlmod, then use the module
extension and only instantiate the tag classes to the corresponding toolchains.</p>
<p dir="auto">If you do need other builtin toolchains when using <code>WORKSPACE</code>, then set <code>scala = False</code>.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="# MODULE.bazel
scala_deps.scala_proto()
scala_deps.twitter_scrooge()
# ...other scala_deps tag class instantations...

# WORKSPACE
scala_toolchains(
    scala = False,
    scala_proto = True,
    twitter_scrooge = True,
    # ...other toolchain parameters...
)"><pre><span class="pl-c"># MODULE.bazel</span>
<span class="pl-s1">scala_deps</span>.<span class="pl-c1">scala_proto</span>()
<span class="pl-s1">scala_deps</span>.<span class="pl-c1">twitter_scrooge</span>()
<span class="pl-c"># ...other scala_deps tag class instantations...</span>

<span class="pl-c"># WORKSPACE</span>
<span class="pl-en">scala_toolchains</span>(
    <span class="pl-s1">scala</span> <span class="pl-c1">=</span> <span class="pl-c1">False</span>,
    <span class="pl-s1">scala_proto</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>,
    <span class="pl-s1">twitter_scrooge</span> <span class="pl-c1">=</span> <span class="pl-c1">True</span>,
    <span class="pl-c"># ...other toolchain parameters...</span>
)</pre></div>
<p dir="auto">This avoids instantiating the default Scala toolchain and compiler JAR
repositories, and disables the corresponding Scala version check, which may
otherwise fail. This is equivalent to two ways in which the previous API avoided
the same default behavior:</p>
<ul dir="auto">
<li>
<p dir="auto">Calling <code>scala_repositories(load_jar_deps = False)</code> would instantiate only
other <code>rules_scala</code> dependency repos (<code>rules_java</code>, <code>protobuf</code>, etc.) and
compiler source JAR repos.</p>
</li>
<li>
<p dir="auto">Calling <code>rules_scala_setup()</code> directly, instead of indirectly via
<code>scala_repositories()</code>, instantiated the other dependency repositories only.</p>
</li>
</ul>
<p dir="auto">See <a href="docs/scala_toolchain.md#step-3-optional">"Defining your own scala_toolchain &gt; Step 3 (optional)" from
docs/scala_toolchain.md</a> for futher
details.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Bzlmod configuration</h3><a id="user-content-bzlmod-configuration" class="anchor" aria-label="Permalink: Bzlmod configuration" href="#bzlmod-configuration"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The Bzlmod implementation funnels through the <code>scala_toolchains()</code> macro as
well, ensuring maximum compatibility with <code>WORKSPACE</code> configurations. The
equivalent Bzlmod snippet for the <code>scala_toolchains()</code> snippet above would be:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel_dep(name = &quot;rules_scala&quot;, version = &quot;7.0.0&quot;)

scala_config = use_extension(
    &quot;@rules_scala//scala/extensions:config.bzl&quot;,
    &quot;scala_config&quot;,
)
scala_config.settings(scala_version = &quot;2.13.16&quot;)

scala_deps = use_extension(
    &quot;@rules_scala//scala/extensions:deps.bzl&quot;,
    &quot;scala_deps&quot;,
)
scala_deps.scala()
scala_deps.scalafmt()
scala_deps.scalatest()"><pre><span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_scala"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"7.0.0"</span>)

<span class="pl-s1">scala_config</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(
    <span class="pl-s">"@rules_scala//scala/extensions:config.bzl"</span>,
    <span class="pl-s">"scala_config"</span>,
)
<span class="pl-s1">scala_config</span>.<span class="pl-c1">settings</span>(<span class="pl-s1">scala_version</span> <span class="pl-c1">=</span> <span class="pl-s">"2.13.16"</span>)

<span class="pl-s1">scala_deps</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(
    <span class="pl-s">"@rules_scala//scala/extensions:deps.bzl"</span>,
    <span class="pl-s">"scala_deps"</span>,
)
<span class="pl-s1">scala_deps</span>.<span class="pl-c1">scala</span>()
<span class="pl-s1">scala_deps</span>.<span class="pl-c1">scalafmt</span>()
<span class="pl-s1">scala_deps</span>.<span class="pl-c1">scalatest</span>()</pre></div>
<p dir="auto">The module extensions call <code>scala_config()</code> and <code>scala_toolchains()</code>
respectively. The <code>MODULE.bazel</code> file for <code>rules_scala</code> declares its own
dependencies via <code>bazel_dep()</code>, allowing Bazel to resolve versions according to
the main repository/root module configuration. It also calls
<a href="https://bazel.build/rules/lib/globals/module#register_toolchains" rel="nofollow"><code>register_toolchains()</code></a>, so you don't have to (unless you want to
register a specific toolchain to resolve first).</p>
<p dir="auto">The <code>MODULE.bazel</code> files in this repository provide many examples.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Copy <code>register_toolchains()</code> calls from <code>WORKSPACE</code> to <code>MODULE.bazel</code></h4><a id="user-content-copy-register_toolchains-calls-from-workspace-to-modulebazel" class="anchor" aria-label="Permalink: Copy register_toolchains() calls from WORKSPACE to MODULE.bazel" href="#copy-register_toolchains-calls-from-workspace-to-modulebazel"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">The <code>MODULE.bazel</code> file from <code>rules_scala</code> automatically calls
<code>register_toolchains()</code> for toolchains configured via its <code>scala_deps</code> module
extension. However, you must register explicitly in your <code>MODULE.bazel</code> file any
toolchains that you want to take precedence over the toolchains configured by
<code>scala_deps</code>. This includes any <a href="./docs/scala_toolchain.md"><code>scala_toolchain</code></a>
targets defined in your project, or optional <code>rules_scala</code> toolchains like the
dependency checker error toolchain from above:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="register_toolchains(
    &quot;@rules_scala//scala:unused_dependency_checker_error_toolchain&quot;,
)"><pre><span class="pl-en">register_toolchains</span>(
    <span class="pl-s">"@rules_scala//scala:unused_dependency_checker_error_toolchain"</span>,
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code>@io_bazel_rules_scala_config</code> is now <code>@rules_scala_config</code></h3><a id="user-content-io_bazel_rules_scala_config-is-now-rules_scala_config" class="anchor" aria-label="Permalink: @io_bazel_rules_scala_config is now @rules_scala_config" href="#io_bazel_rules_scala_config-is-now-rules_scala_config"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Since <code>@io_bazel_rules_scala</code> is no longer hardcoded in <code>rules_scala</code> internals,
we've shortened <code>@io_bazel_rules_scala_config</code> to <code>@rules_scala_config</code>. This
shouldn't affect most users, but it may break some builds using
<code>@io_bazel_rules_scala_config</code> to define custom <a href="./docs/cross-compilation.md">cross-compilation targets</a>.</p>
<p dir="auto">If your project uses Bzlmod, you can remap <code>@io_bazel_rules_scala_config</code> to
<code>@rules_scala_config</code> for your own project via <a href="https://bazel.build/rules/lib/globals/module#use_repo" rel="nofollow"><code>use_repo()</code></a>. Use this only if
updating your project's own <code>@io_bazel_rules_scala_config</code> references isn't
immediately feasible.</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="scala_config = use_extension(
    &quot;@rules_scala//scala/extensions:config.bzl&quot;,
    &quot;scala_config&quot;,
)
use_repo(scala_config, io_bazel_rules_scala_config = &quot;rules_scala_config&quot;)"><pre><span class="pl-s1">scala_config</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(
    <span class="pl-s">"@rules_scala//scala/extensions:config.bzl"</span>,
    <span class="pl-s">"scala_config"</span>,
)
<span class="pl-en">use_repo</span>(<span class="pl-s1">scala_config</span>, <span class="pl-s1">io_bazel_rules_scala_config</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_scala_config"</span>)</pre></div>
<p dir="auto">If your project uses <code>WORKSPACE</code> you <em>must</em> update all
<code>@io_bazel_rules_scala_config</code> references to <code>@rules_scala_config</code>. There is no
<code>use_repo()</code> equivalent.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto"><a id="user-content-repo-mapping"></a>Translating repo names for dependencies</h4><a id="user-content-translating-repo-names-for-dependencies" class="anchor" aria-label="Permalink: Translating repo names for dependencies" href="#translating-repo-names-for-dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">For any dependencies referencing <code>@io_bazel_rules_scala_config</code>, use the workarounds
below. The same workarounds for your project's dependencies also apply to
translating <code>@rules_scala</code> to <code>@io_bazel_rules_scala</code>.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Bzlmod</h4><a id="user-content-bzlmod" class="anchor" aria-label="Permalink: Bzlmod" href="#bzlmod"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">For module extensions, use <a href="https://bazel.build/rules/lib/globals/module#override_repo" rel="nofollow"><code>override_repo()</code></a> to override
<code>@io_bazel_rules_scala_config</code> with <code>@rules_scala_config</code>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="bazel_dep(name = &quot;foo&quot;, version = &quot;1.0.0&quot;)

foo_ext = use_extension(&quot;@foo//:ext.bzl&quot;, &quot;foo_ext&quot;)
override_repo(foo_ext, io_bazel_rules_scala_config = &quot;rules_scala_config&quot;)"><pre><span class="pl-en">bazel_dep</span>(<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"foo"</span>, <span class="pl-s1">version</span> <span class="pl-c1">=</span> <span class="pl-s">"1.0.0"</span>)

<span class="pl-s1">foo_ext</span> <span class="pl-c1">=</span> <span class="pl-en">use_extension</span>(<span class="pl-s">"@foo//:ext.bzl"</span>, <span class="pl-s">"foo_ext"</span>)
<span class="pl-en">override_repo</span>(<span class="pl-s1">foo_ext</span>, <span class="pl-s1">io_bazel_rules_scala_config</span> <span class="pl-c1">=</span> <span class="pl-s">"rules_scala_config"</span>)</pre></div>
<p dir="auto"><a href="https://bazel.build/rules/lib/globals/module#bazel_dep" rel="nofollow"><code>bazel_dep()</code></a> dependencies may still require <code>@io_bazel_rules_scala_config</code>
(or <code>@io_bazel_rules_scala</code>) outside of a module extension. In this case, to
avoid using the old name in your own project, use <a href="https://bazel.build/rules/lib/globals/module#archive_override" rel="nofollow"><code>archive_override()</code></a> or
<a href="https://bazel.build/rules/lib/globals/module#git_override" rel="nofollow"><code>git_override()</code></a> with the <code>repo_mapping</code> attribute. These overrides pass the
<code>repo_mapping</code> through to the underlying <a href="https://bazel.build/rules/lib/repo/http#http_archive-repo_mapping" rel="nofollow"><code>http_archive()</code></a> and
<a href="https://bazel.build/rules/lib/repo/git#git_repository-repo_mapping" rel="nofollow"><code>git_repository()</code></a> rules:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="archive_override(
    ...
    repo_mapping = {
        &quot;@io_bazel_rules_scala_config&quot;: &quot;@rules_scala_config&quot;,
    }
    ...
)"><pre><span class="pl-en">archive_override</span>(
    ...
    <span class="pl-s1">repo_mapping</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"@io_bazel_rules_scala_config"</span>: <span class="pl-s">"@rules_scala_config"</span>,
    }
    ...
)</pre></div>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto"><code>WORKSPACE</code></h4><a id="user-content-workspace" class="anchor" aria-label="Permalink: WORKSPACE" href="#workspace"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">For dependencies, use the <code>repo_mapping</code> attribute of <a href="https://bazel.build/rules/lib/repo/http#http_archive-repo_mapping" rel="nofollow"><code>http_archive()</code></a> or
<a href="https://bazel.build/rules/lib/repo/git#git_repository-repo_mapping" rel="nofollow"><code>git_repository()</code></a>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="http_archive(
    ...
    repo_mapping = {
        &quot;@io_bazel_rules_scala_config&quot;: &quot;@rules_scala_config&quot;,
    }
    ...
)"><pre><span class="pl-en">http_archive</span>(
    ...
    <span class="pl-s1">repo_mapping</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"@io_bazel_rules_scala_config"</span>: <span class="pl-s">"@rules_scala_config"</span>,
    }
    ...
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><a id="user-content-protoc-msvc"></a>Windows MSVC builds of <code>protobuf</code> broken by default</h3><a id="user-content-windows-msvc-builds-of-protobuf-broken-by-default" class="anchor" aria-label="Permalink: Windows MSVC builds of protobuf broken by default" href="#windows-msvc-builds-of-protobuf-broken-by-default"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">MSVC builds of recent <code>protobuf</code> versions started failing, as first noted in
<a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2888049085" data-permission-text="Title is private" data-url="https://github.com/bazel-contrib/rules_scala/issues/1710" data-hovercard-type="pull_request" data-hovercard-url="/bazel-contrib/rules_scala/pull/1710/hovercard" href="https://github.com/bazel-contrib/rules_scala/pull/1710">#1710</a>. On top of that, <code>protobuf</code> is planning to stop
supporting Bazel + MSVC builds per:</p>
<ul dir="auto">
<li>
<p dir="auto"><a href="https://github.com/protocolbuffers/protobuf/issues/12947" data-hovercard-type="issue" data-hovercard-url="/protocolbuffers/protobuf/issues/12947/hovercard">protocolbuffers/protobuf#12947: src build on windows not working</a></p>
</li>
<li>
<p dir="auto"><a href="https://protobuf.dev/news/v30/#poison-msvc--bazel" rel="nofollow">protobuf.dev News Announcements for Version 30.x:Poison MSVC + Bazel</a></p>
</li>
<li>
<p dir="auto"><a href="https://github.com/protocolbuffers/protobuf/issues/20085" data-hovercard-type="issue" data-hovercard-url="/protocolbuffers/protobuf/issues/20085/hovercard">protocolbuffers/protobuf#20085: Breaking Change: Dropping support for
Bazel+MSVC</a></p>
</li>
</ul>
<p dir="auto">Enable <a href="#protoc">protocol compiler toolchainization</a> to fix broken Windows
builds by avoiding <code>@com_google_protobuf//:protoc</code> recompilation.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Minimum of <code>protobuf</code> v28.2</h3><a id="user-content-minimum-of-protobuf-v282" class="anchor" aria-label="Permalink: Minimum of protobuf v28.2" href="#minimum-of-protobuf-v282"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>rules_scala</code> requires at least <code>protobuf</code> v28.2, and at least v29 for <a href="#protoc">protocol
compiler toolchain</a> support. No <code>ScalaPB</code> release supports <code>protobuf</code>
v25.6, v26, or v27.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Using earlier <code>protobuf</code> versions</h4><a id="user-content-using-earlier-protobuf-versions" class="anchor" aria-label="Permalink: Using earlier protobuf versions" href="#using-earlier-protobuf-versions"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">If you can't update to <code>protobuf</code> v28.2 or later right now, build using Bazel 7
and the following maximum versions of key dependencies. This is not officially
supported, but should work for some time.</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th align="center">Dependency</th>
<th align="center">Max compatible version</th>
<th align="left">Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>ScalaPB</code></td>
<td align="center">0.11.17<br>(0.9.8 for Scala 2.11)</td>
<td align="left">Later versions only support <code>protobuf</code> &gt;= v28.2.</td>
</tr>
<tr>
<td align="center"><code>protobuf</code></td>
<td align="center">v25.5</td>
<td align="left">Maximum version supported by <code>ScalaPB</code> 0.11.17.</td>
</tr>
<tr>
<td align="center"><code>rules_cc</code></td>
<td align="center">0.0.9</td>
<td align="left">0.0.10 requires Bazel 7 to define <code>CcSharedLibraryHintInfo</code>.<br>0.0.13 requires at least <code>protobuf</code> v27.0.</td>
</tr>
<tr>
<td align="center"><code>rules_java</code></td>
<td align="center">7.12.5</td>
<td align="left">8.x requires <code>protobuf</code> v27 and later.</td>
</tr>
<tr>
<td align="center"><code>rules_proto</code></td>
<td align="center">6.0.2</td>
<td align="left">Maximum version supporting <code>protobuf</code> v25.5</td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Embedded resource paths no longer begin with <code>external/&lt;repo_name&gt;</code></h3><a id="user-content-embedded-resource-paths-no-longer-begin-with-externalrepo_name" class="anchor" aria-label="Permalink: Embedded resource paths no longer begin with external/&lt;repo_name&gt;" href="#embedded-resource-paths-no-longer-begin-with-externalrepo_name"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://github.com/bazelbuild/rules_scala/pull/1621#issuecomment-2417506589" data-hovercard-type="pull_request" data-hovercard-url="/bazel-contrib/rules_scala/pull/1621/hovercard">Any program compiled with an external repo asset in its 'resources' attribute
will need to strip the 'external/' and repo name components from its
path</a>. For example, the path for <code>resources = ["@some_external_repo//:resource.txt"]</code> would change thus:</p>
<ul dir="auto">
<li>Before: <code>external/some_external_repo/resource.txt</code></li>
<li>After: <code>resource.txt</code></li>
</ul>
<p dir="auto">This avoids encoding repo names or any other Bazel system knowledge in the
compiled artifacts. This is especially important under Bzlmod, because the
generated path would otherwise contain <a href="https://bazel.build/external/module#repository_names_and_strict_deps" rel="nofollow">the <em>canonical</em> repo name,  upon which
users should never
depend</a>.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Update <code>@bazel_tools//tools/jdk</code> targets to <code>@rules_java//toolchains</code> targets</h3><a id="user-content-update-bazel_toolstoolsjdk-targets-to-rules_javatoolchains-targets" class="anchor" aria-label="Permalink: Update @bazel_tools//tools/jdk targets to @rules_java//toolchains targets" href="#update-bazel_toolstoolsjdk-targets-to-rules_javatoolchains-targets"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Per <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2725663567" data-permission-text="Title is private" data-url="https://github.com/bazel-contrib/rules_scala/issues/1660" data-hovercard-type="pull_request" data-hovercard-url="/bazel-contrib/rules_scala/pull/1660/hovercard" href="https://github.com/bazel-contrib/rules_scala/pull/1660">#1660</a>, <code>rules_java</code> 7.10.0 and later precipitate the
need to replace <code>@bazel_tools//tools/jdk</code> targets with corresponding
<code>@rules_java//toolchains</code> targets. Fix any targets broken by this <code>rules_java</code>
upgrade by doing a global search and replace.</p>
<p dir="auto">However, <code>@bazel_tools//tools/jdk:toolchain_type</code> dependencies must remain for
now, as there's not yet a corresponding <a href="https://bazel.build/versions/6.1.0/reference/be/platform#toolchain_type" rel="nofollow"><code>toolchain_type()</code></a> target
in <code>@rules_java</code>.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Builtin repositories no longer visible by default under Bzlmod</h3><a id="user-content-builtin-repositories-no-longer-visible-by-default-under-bzlmod" class="anchor" aria-label="Permalink: Builtin repositories no longer visible by default under Bzlmod" href="#builtin-repositories-no-longer-visible-by-default-under-bzlmod"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Under Bzlmod, repos are only visible to the module extension that creates them,
unless the <code>MODULE.bazel</code> file brings them into scope with
<a href="https://bazel.build/rules/lib/globals/module#use_repo" rel="nofollow"><code>use_repo()</code></a>. This can
lead to errors like those from the following example, which <a href="https://github.com/michalbogacz/scala-bazel-monorepo/blob/17f0890a4345529e09b9ce83bcb2e3d15687c522/BUILD.bazel">originally called
'setup_scala_toolchain()' under Bzlmod</a>:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_scala//scala:scala.bzl&quot;, &quot;setup_scala_toolchain&quot;)

setup_scala_toolchain(
    name = &quot;custom_scala_toolchain&quot;,
    scalacopts = [
        &quot;-Wunused:all&quot;,
    ],
    strict_deps_mode = &quot;error&quot;,
    unused_dependency_checker_mode = &quot;warn&quot;,
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_scala//scala:scala.bzl"</span>, <span class="pl-s">"setup_scala_toolchain"</span>)

<span class="pl-en">setup_scala_toolchain</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"custom_scala_toolchain"</span>,
    <span class="pl-s1">scalacopts</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"-Wunused:all"</span>,
    ],
    <span class="pl-s1">strict_deps_mode</span> <span class="pl-c1">=</span> <span class="pl-s">"error"</span>,
    <span class="pl-s1">unused_dependency_checker_mode</span> <span class="pl-c1">=</span> <span class="pl-s">"warn"</span>,
)</pre></div>
<p dir="auto"><code>setup_scala_toolchains</code> is a macro that can take user specified classpath
targets as described in <a href="./docs/scala_toolchain.md">docs/scala_toolchain.md</a>.
Without explicit <code>*_classpath</code> or <code>*_deps</code> arguments, <code>setup_scala_toolchain()</code>
defaults to using dependency repositories generated by <code>rules_scala</code> itself.
This worked under <code>WORKSPACE</code>, but breaks under Bzlmod, because the builtin
toolchain dependency repos are no longer in the project's scope by default:</p>
<div class="highlight highlight-text-adblock notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="ERROR: no such package
    '@@[unknown repo 'org_scala_sbt_compiler_interface_3_3_5'
        requested from @@]//':
    The repository '@@[unknown repo 'org_scala_sbt_compiler_interface_3_3_5'
        requested from @@]' could not be resolved:
    No repository visible as '@org_scala_sbt_compiler_interface_3_3_5'"><pre>ERROR: no such package
    '@@[unknown repo 'org_scala_sbt_compiler_interface_3_3_5'
        requested from @@]//':
    The repository '@@[unknown repo 'org_scala_sbt_compiler_interface_3_3_5'
        requested from @@]' could not be resolved:
    No repository visible as '@org_scala_sbt_compiler_interface_3_3_5'</pre></div>
<p dir="auto">In this case, where the toolchain only sets different compiler options, the best
fix is to <a href="https://github.com/michalbogacz/scala-bazel-monorepo/blob/2cac860f386dcaa1c3be56cd25a84b247d335743/BUILD.bazel">use the 'scala_toolchain' rule directly instead</a>.
Its underlying <code>BUILD</code> rule uses builtin toolchain dependencies via existing
targets visible within <code>rules_scala</code>, without forcing users to import them:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;@rules_scala//scala:scala_toolchain.bzl&quot;, &quot;scala_toolchain&quot;)

scala_toolchain(
    name = &quot;custom_scala_toolchain_impl&quot;,
    scalacopts = [
        &quot;-Ywarn-unused&quot;,
    ],
    strict_deps_mode = &quot;error&quot;,
    unused_dependency_checker_mode = &quot;warn&quot;,
)

toolchain(
    name = &quot;custom_scala_toolchain&quot;,
    toolchain = &quot;:custom_scala_toolchain_impl&quot;,
    toolchain_type = &quot;@rules_scala//scala:toolchain_type&quot;,
    visibility = [&quot;//visibility:public&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"@rules_scala//scala:scala_toolchain.bzl"</span>, <span class="pl-s">"scala_toolchain"</span>)

<span class="pl-en">scala_toolchain</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"custom_scala_toolchain_impl"</span>,
    <span class="pl-s1">scalacopts</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"-Ywarn-unused"</span>,
    ],
    <span class="pl-s1">strict_deps_mode</span> <span class="pl-c1">=</span> <span class="pl-s">"error"</span>,
    <span class="pl-s1">unused_dependency_checker_mode</span> <span class="pl-c1">=</span> <span class="pl-s">"warn"</span>,
)

<span class="pl-en">toolchain</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"custom_scala_toolchain"</span>,
    <span class="pl-s1">toolchain</span> <span class="pl-c1">=</span> <span class="pl-s">":custom_scala_toolchain_impl"</span>,
    <span class="pl-s1">toolchain_type</span> <span class="pl-c1">=</span> <span class="pl-s">"@rules_scala//scala:toolchain_type"</span>,
    <span class="pl-s1">visibility</span> <span class="pl-c1">=</span> [<span class="pl-s">"//visibility:public"</span>],
)</pre></div>
<p dir="auto">A big part of the Bzlmodification work involved enabling <code>rules_scala</code> to
generate and register toolchains <em>without</em> forcing users to bring their
dependencies into scope. However, another way to fix this specific problem is to
call <code>use_repo</code> for every builtin repository needed by the
<code>setup_scala_toolchain()</code> call.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Replace some <code>$(location)</code> calls with <code>$(rootpath)</code> for Bazel 8</h3><a id="user-content-replace-some-location-calls-with-rootpath-for-bazel-8" class="anchor" aria-label="Permalink: Replace some $(location) calls with $(rootpath) for Bazel 8" href="#replace-some-location-calls-with-rootpath-for-bazel-8"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">This isn't actually a <code>rules_scala</code> breakage, but a Bazel 8 breakage encountered
while preparing <code>rules_scala</code> for Bazel 8 in <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2690469830" data-permission-text="Title is private" data-url="https://github.com/bazel-contrib/rules_scala/issues/1652" data-hovercard-type="issue" data-hovercard-url="/bazel-contrib/rules_scala/issues/1652/hovercard" href="https://github.com/bazel-contrib/rules_scala/issues/1652">#1652</a>.
<a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2831996656" data-permission-text="Title is private" data-url="https://github.com/bazelbuild/bazel/issues/25198" data-hovercard-type="issue" data-hovercard-url="/bazelbuild/bazel/issues/25198/hovercard" href="https://github.com/bazelbuild/bazel/issues/25198">bazelbuild/bazel#25198</a> describes how the semantics of some instances of
<code>$(location)</code> changed, and how changing these particular instances to
<code>$(rootpath)</code> fixed them.</p>
<p dir="auto">The good news is that replacing such instances <code>$(location)</code> with <code>$(rootpath)</code>
is backwards compatible to Bazel 6.5.0 and 7.6.1. Updating them now will ensure
future compatibility.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><a id="user-content-6.5.0"></a>Limited Bazel 6.5.0 compatibility</h3><a id="user-content-limited-bazel-650-compatibility" class="anchor" aria-label="Permalink: Limited Bazel 6.5.0 compatibility" href="#limited-bazel-650-compatibility"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><strong><code>rules_scala</code> 7.x officially drops support for Bazel 6.5.0.</strong> Bzlmod builds
with Bazel 6.5.0 won't work at all because <a href="https://bazel.build/versions/6.5.0/rules/lib/globals" rel="nofollow">Bazel 6.5.0 doesn't support
'use_repo_rule'</a>, which
<a href="https://github.com/bazelbuild/rules_scala/issues/1482#issuecomment-2515496234" data-hovercard-type="issue" data-hovercard-url="/bazel-contrib/rules_scala/issues/1482/hovercard">'rules_jvm_external' &gt;= 6.3 requires</a>.</p>
<p dir="auto">At the moment, <code>WORKSPACE</code> builds mostly continue to work with Bazel 6.5.0, but
may break at any time.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Configuring the protocol compiler toolchain</h4><a id="user-content-configuring-the-protocol-compiler-toolchain" class="anchor" aria-label="Permalink: Configuring the protocol compiler toolchain" href="#configuring-the-protocol-compiler-toolchain"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">See <a href="#using-a-prebuilt-com_google_protobufprotoc-or-c-compiler-flags">Using a prebuilt @com_google_protobuf//:protoc or C++ compiler
flags</a> for protocol compiler configuration requirements.</p>
<div class="markdown-heading" dir="auto"><h4 class="heading-element" dir="auto">Using older versions of <code>protobuf</code></h4><a id="user-content-using-older-versions-of-protobuf" class="anchor" aria-label="Permalink: Using older versions of protobuf" href="#using-older-versions-of-protobuf"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">See <a href="#using-earlier-protobuf-versions">Using earlier protobuf versions</a> for
details on using older versions of protobuf if necessary.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code>scala_proto</code> not supported for Scala 2.11</h3><a id="user-content-scala_proto-not-supported-for-scala-211" class="anchor" aria-label="Permalink: scala_proto not supported for Scala 2.11" href="#scala_proto-not-supported-for-scala-211"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><a href="https://github.com/scalapb/ScalaPB/releases/tag/v0.9.8">ScalaPB 0.9.8</a>, the
last version compatible with Scala 2.11, doesn't support <code>protobuf</code> v25.6 or
later. See <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2901124128" data-permission-text="Title is private" data-url="https://github.com/bazel-contrib/rules_scala/issues/1712" data-hovercard-type="pull_request" data-hovercard-url="/bazel-contrib/rules_scala/pull/1712/hovercard" href="https://github.com/bazel-contrib/rules_scala/pull/1712">#1712</a> for an example of what happens to Scala
2.11 test cases when using <code>protobuf</code> v25.6. Since <code>rules_scala</code> now supports
more recent <code>protobuf</code> versions via <a href="https://github.com/scalapb/ScalaPB/releases/tag/v1.0.0-alpha.1">ScalaPB 1.0.0-alpha1</a>, we had to
remove the Scala 2.11 test cases.</p>
<p dir="auto">Building <code>scala_proto</code> for Scala 2.11 requires <a href="#6.5.0">building with Bazel 6.5.0
under WORKSPACE</a>, with the maximum dependency versions specified in
that section. While this may continue to work for some time, it is not
officially supported.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto"><code>scala_proto_toolchain</code> changes and new <code>scalapb_toolchain</code> macro</h3><a id="user-content-scala_proto_toolchain-changes-and-new-scalapb_toolchain-macro" class="anchor" aria-label="Permalink: scala_proto_toolchain changes and new scalapb_toolchain macro" href="#scala_proto_toolchain-changes-and-new-scalapb_toolchain-macro"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>scala_proto_toolchain</code> has a more flexible plugin configuration schema. The
new <code>generators</code> and <code>generators_opts</code> attributes replace the following
attributes:</p>
<ul dir="auto">
<li><code>with_grpc</code></li>
<li><code>with_flat_package</code></li>
<li><code>with_single_line_to_string</code></li>
<li><code>main_generator</code></li>
<li><code>named_generators</code></li>
</ul>
<p dir="auto">Now each generator (plugin) will get a corresponding name
that can be used for further plugin options setup:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="scala_proto_toolchain(
    name = &quot;example&quot;,
    generators = {
        &quot;scala&quot;: &quot;scripts.ScalaPbCodeGenerator&quot;,
        &quot;jvm_extra_protobuf_generator&quot;: &quot;scalarules.test.extra_protobuf_generator.ExtraProtobufGenerator&quot;,
    },
    generators_opts = {
        &quot;scala&quot;: [
            &quot;grpc&quot;,
            &quot;single_line_to_proto_string&quot;,
        ],
        &quot;jvm_extra_protobuf_generator&quot;: [
            &quot;grpc&quot;,
            &quot;single_line_to_proto_string&quot;,
        ],
    },
)"><pre><span class="pl-en">scala_proto_toolchain</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"example"</span>,
    <span class="pl-s1">generators</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"scala"</span>: <span class="pl-s">"scripts.ScalaPbCodeGenerator"</span>,
        <span class="pl-s">"jvm_extra_protobuf_generator"</span>: <span class="pl-s">"scalarules.test.extra_protobuf_generator.ExtraProtobufGenerator"</span>,
    },
    <span class="pl-s1">generators_opts</span> <span class="pl-c1">=</span> {
        <span class="pl-s">"scala"</span>: [
            <span class="pl-s">"grpc"</span>,
            <span class="pl-s">"single_line_to_proto_string"</span>,
        ],
        <span class="pl-s">"jvm_extra_protobuf_generator"</span>: [
            <span class="pl-s">"grpc"</span>,
            <span class="pl-s">"single_line_to_proto_string"</span>,
        ],
    },
)</pre></div>
<p dir="auto"><code>scalapb_grpc_deps</code> no longer exists since it's now the user's responsibility
to configure dependencies based on the provided generators and their options.</p>
<p dir="auto">The new <code>scalapb_toolchain</code> convenience macro wraps <code>scala_proto_toolchain</code>
to provide the default <a href="https://scalapb.github.io/" rel="nofollow">ScalaPB</a> implementation:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="load(&quot;//scala_proto:scala_proto_toolchain.bzl&quot;, &quot;scalapb_toolchain&quot;)

scalapb_toolchain(
    name = &quot;my_toolchain&quot;,
    opts = [
        &quot;grpc&quot;,
        &quot;single_line_to_proto_string&quot;,
    ],
    visibility = [&quot;//visibility:public&quot;],
)"><pre><span class="pl-en">load</span>(<span class="pl-s">"//scala_proto:scala_proto_toolchain.bzl"</span>, <span class="pl-s">"scalapb_toolchain"</span>)

<span class="pl-en">scalapb_toolchain</span>(
    <span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s">"my_toolchain"</span>,
    <span class="pl-s1">opts</span> <span class="pl-c1">=</span> [
        <span class="pl-s">"grpc"</span>,
        <span class="pl-s">"single_line_to_proto_string"</span>,
    ],
    <span class="pl-s1">visibility</span> <span class="pl-c1">=</span> [<span class="pl-s">"//visibility:public"</span>],
)</pre></div>
<p dir="auto">Similarly, <code>setup_scala_proto_toolchains()</code> now uses a <code>default_gen_opts</code>
parameter to replace the previous boolean <code>enable_all_options</code> parameter.</p>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Removal of <code>bind()</code> aliases for <code>twitter_scrooge</code> dependencies</h3><a id="user-content-removal-of-bind-aliases-for-twitter_scrooge-dependencies" class="anchor" aria-label="Permalink: Removal of bind() aliases for twitter_scrooge dependencies" href="#removal-of-bind-aliases-for-twitter_scrooge-dependencies"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>rules_scala</code> 7.x removes all of the obsolete <a href="https://bazel.build/reference/be/workspace#bind" rel="nofollow"><code>bind()</code></a> aliases under
<code>//external:io_bazel_rules_scala/dependency/</code> created for <code>twitter_scrooge</code>
toolchain dependencies. If your project happens to depend on these aliases, you
can replace them with the following repository references:</p>
<markdown-accessiblity-table><table>
<thead>
<tr>
<th align="left"><code>bind()</code> alias under <code>//external:io_bazel_rules_scala/dependency/</code></th>
<th align="left">Repository reference</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><code>scala/guava</code></td>
<td align="left"><code>@io_bazel_rules_scala_guava</code></td>
</tr>
<tr>
<td align="left"><code>thrift/javax_annotation_api</code></td>
<td align="left"><code>@io_bazel_rules_scala_javax_annotation_api</code></td>
</tr>
<tr>
<td align="left"><code>thrift/libthrift</code></td>
<td align="left"><code>@libthrift</code></td>
</tr>
<tr>
<td align="left"><code>thrift/mustache</code></td>
<td align="left"><code>@io_bazel_rules_scala_mustache</code></td>
</tr>
<tr>
<td align="left"><code>thrift/scopt</code></td>
<td align="left"><code>@io_bazel_rules_scala_scopt</code></td>
</tr>
<tr>
<td align="left"><code>thrift/scrooge_core</code></td>
<td align="left"><code>@io_bazel_rules_scala_scrooge_core</code></td>
</tr>
<tr>
<td align="left"><code>thrift/scrooge_generator</code></td>
<td align="left"><code>@io_bazel_rules_scala_scrooge_generator</code></td>
</tr>
<tr>
<td align="left"><code>thrift/util_core</code></td>
<td align="left"><code>@io_bazel_rules_scala_util_core</code></td>
</tr>
<tr>
<td align="left"><code>thrift/util_logging</code></td>
<td align="left"><code>@io_bazel_rules_scala_util_logging</code></td>
</tr>
</tbody>
</table></markdown-accessiblity-table>
<p dir="auto">To access these repositories under Bzlmod, you'll need to add the following to
your <code>MODULE.bazel</code> file:</p>
<div class="highlight highlight-source-python notranslate position-relative overflow-auto" dir="auto" data-snippet-clipboard-copy-content="scala_deps.twitter_scrooge()
use_repo(
    scala_deps,
    &quot;io_bazel_rules_scala_guava&quot;,
    &quot;io_bazel_rules_scala_javax_annotation_api&quot;,
    &quot;io_bazel_rules_scala_mustache&quot;,
    &quot;io_bazel_rules_scala_scopt&quot;,
    &quot;io_bazel_rules_scala_scrooge_core&quot;,
    &quot;io_bazel_rules_scala_scrooge_generator&quot;,
    &quot;io_bazel_rules_scala_util_core&quot;,
    &quot;io_bazel_rules_scala_util_logging&quot;,
    &quot;libthrift&quot;,
)"><pre><span class="pl-s1">scala_deps</span>.<span class="pl-c1">twitter_scrooge</span>()
<span class="pl-en">use_repo</span>(
    <span class="pl-s1">scala_deps</span>,
    <span class="pl-s">"io_bazel_rules_scala_guava"</span>,
    <span class="pl-s">"io_bazel_rules_scala_javax_annotation_api"</span>,
    <span class="pl-s">"io_bazel_rules_scala_mustache"</span>,
    <span class="pl-s">"io_bazel_rules_scala_scopt"</span>,
    <span class="pl-s">"io_bazel_rules_scala_scrooge_core"</span>,
    <span class="pl-s">"io_bazel_rules_scala_scrooge_generator"</span>,
    <span class="pl-s">"io_bazel_rules_scala_util_core"</span>,
    <span class="pl-s">"io_bazel_rules_scala_util_logging"</span>,
    <span class="pl-s">"libthrift"</span>,
)</pre></div>
<div class="markdown-heading" dir="auto"><h3 class="heading-element" dir="auto">Bazel module compatibility levels</h3><a id="user-content-bazel-module-compatibility-levels" class="anchor" aria-label="Permalink: Bazel module compatibility levels" href="#bazel-module-compatibility-levels"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><code>rules_scala</code> 7.0.0 will set the
<a href="https://bazel.build/external/module#compatibility_level" rel="nofollow"><code>compatibility_level</code></a>
value for its <a href="https://bazel.build/rules/lib/globals/module" rel="nofollow"><code>module()</code></a>
directive. The <code>compatibility_level</code> for <code>rules_scala</code> will track major version
numbers (per <a href="https://semver.org/" rel="nofollow">semantic versioning</a>), and this <code>README</code> will
clearly document the reason for the level bump. <code>compatibility_level</code> mismatches
in the module graph will cause module resolution to fail, signaling the presence
of known breaking changes.</p>
<p dir="auto">The concept of proper <code>compatibility_level</code> usage is still up for discussion in
<a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="7472675" data-permission-text="Title is private" data-url="https://github.com/bazelbuild/bazel/discussions/24302" data-hovercard-type="discussion" data-hovercard-url="/bazelbuild/bazel/discussions/24302/hovercard" href="https://github.com/bazelbuild/bazel/discussions/24302">bazelbuild/bazel#24302</a>. However, the policy above favors forcing module
resolution to fail, rather than allowing a later execution step to fail with a
potentially confusing error message. If a version bump may break builds for any
known reason, we will explain why up front instead of waiting for users to be
surprised.</p>
<p dir="auto"><a href="https://github.com/bazelbuild/rules_scala/issues/1647#issuecomment-2486777859" data-hovercard-type="issue" data-hovercard-url="/bazel-contrib/rules_scala/issues/1647/hovercard">A comment from #1647 illustrates how 'rules_erlang' fails due to
'compatibility_level' conflicts</a>. The <a href="https://github.com/rabbitmq/rules_erlang/releases/tag/3.0.0">'rules_erlang' 3.0.0 release
notes</a> describe the
breaking changes. This seems like a reasonable model to follow.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Contributing</h2><a id="user-content-contributing" class="anchor" aria-label="Permalink: Contributing" href="#contributing"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">See <a href="CONTRIBUTING.md">CONTRIBUTING.md</a> for more info.</p>
<div class="markdown-heading" dir="auto"><h2 class="heading-element" dir="auto">Adopters</h2><a id="user-content-adopters" class="anchor" aria-label="Permalink: Adopters" href="#adopters"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto">Here's a (non-exhaustive) list of companies that use <code>rules_scala</code> in production. Don't see yours? <a href="https://github.com/bazelbuild/rules_scala/edit/master/README.md">You can add it in a PR</a>!</p>
<ul dir="auto">
<li><a href="https://airbnb.com/" rel="nofollow">Airbnb</a></li>
<li><a href="https://ascend.io/" rel="nofollow">Ascend</a></li>
<li><a href="https://www.canva.com/" rel="nofollow">Canva</a></li>
<li><a href="https://www.dominodatalab.com/" rel="nofollow">Domino Data Lab</a></li>
<li><a href="https://www.etsy.com/" rel="nofollow">Etsy</a></li>
<li><a href="https://gemini.com/" rel="nofollow">Gemini</a></li>
<li><a href="http://grandrounds.com/" rel="nofollow">Grand Rounds</a></li>
<li><a href="https://kittyhawk.aero/" rel="nofollow">Kitty Hawk</a></li>
<li><a href="https://meetup.com/" rel="nofollow">Meetup</a></li>
<li><a href="https://www.spotify.com/" rel="nofollow">Spotify</a></li>
<li><a href="https://stripe.com/" rel="nofollow">Stripe</a></li>
<li><a href="https://www.meettally.com/" rel="nofollow">Tally</a></li>
<li><a href="https://twitter.com/" rel="nofollow">Twitter</a></li>
<li><a href="https://virtuslab.com/" rel="nofollow">VirtusLab</a></li>
<li><a href="https://vsco.co" rel="nofollow">VSCO</a></li>
<li><a href="https://www.wix.com/" rel="nofollow">Wix</a></li>
<li><a href="https://www.yobi.ai/" rel="nofollow">Yobi</a></li>
</ul>
</article></div>