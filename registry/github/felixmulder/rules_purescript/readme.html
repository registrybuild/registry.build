<div id="readme" class="md" data-path="README.md"><article class="markdown-body entry-content container-lg" itemprop="text"><h1 id="user-content-purescript-rules-for-bazel" dir="auto"><a class="heading-link" href="#purescript-rules-for-bazel">Purescript Rules for Bazel<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h1>
<h2 id="user-content-adding-purescript-support-to-your-bazel-repo" dir="auto"><a class="heading-link" href="#adding-purescript-support-to-your-bazel-repo">Adding purescript support to your bazel repo<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">This repo is the beginnings of support for purescript in Bazel. In order to use
this put the following into your <code>WORKSPACE</code> file:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="# refer to a githash in this repo:
rules_purescript_version = &quot;38abb155c30502c9996925640b9b8e04bd48d974&quot;

# download the archive:
http_archive(
    name = &quot;io_bazel_rules_purescript&quot;,
    url  = &quot;https://github.com/felixmulder/rules_purescript/archive/%s.zip&quot; % rules_purescript_version,
    type = &quot;zip&quot;,
    strip_prefix = &quot;rules_purescript-%s&quot; % rules_purescript_version,
)

# load the purescript rules and functions:
load(&quot;@io_bazel_rules_purescript//purescript:purescript.bzl&quot;, &quot;purescript_toolchain&quot;, &quot;purescript_dep&quot;)

# downloads the `purs` command:
purescript_toolchain()

# add some dependencies:
purescript_dep(
    name = &quot;purescript_console&quot;,
    url = &quot;https://github.com/purescript/purescript-console/archive/v4.1.0.tar.gz&quot;,
    sha256 = &quot;5b0d2089e14a3611caf9d397e9dd825fc5c8f39b049d19448c9dbbe7a1b595bf&quot;,
    strip_prefix = &quot;purescript-console-4.1.0&quot;,
)

purescript_dep(
    name = &quot;purescript_effect&quot;,
    url = &quot;https://github.com/purescript/purescript-effect/archive/v2.0.0.tar.gz&quot;,
    sha256 = &quot;5254c048102a6f4360a77096c6162722c4c4b2449983f26058d75d4e5be9d301&quot;,
    strip_prefix = &quot;purescript-effect-2.0.0&quot;,
)

purescript_dep(
    name = &quot;purescript_prelude&quot;,
    url = &quot;https://github.com/purescript/purescript-prelude/archive/v4.0.1.tar.gz&quot;,
    sha256 = &quot;3b69b111875eb2b915fd7bdf320707ed3d22194d71cd51d25695d22ab06ae6ee&quot;,
    strip_prefix = &quot;purescript-prelude-4.0.1&quot;,
)"><pre lang="python" class="notranslate"><code># refer to a githash in this repo:
rules_purescript_version = "38abb155c30502c9996925640b9b8e04bd48d974"

# download the archive:
http_archive(
    name = "io_bazel_rules_purescript",
    url  = "https://github.com/felixmulder/rules_purescript/archive/%s.zip" % rules_purescript_version,
    type = "zip",
    strip_prefix = "rules_purescript-%s" % rules_purescript_version,
)

# load the purescript rules and functions:
load("@io_bazel_rules_purescript//purescript:purescript.bzl", "purescript_toolchain", "purescript_dep")

# downloads the `purs` command:
purescript_toolchain()

# add some dependencies:
purescript_dep(
    name = "purescript_console",
    url = "https://github.com/purescript/purescript-console/archive/v4.1.0.tar.gz",
    sha256 = "5b0d2089e14a3611caf9d397e9dd825fc5c8f39b049d19448c9dbbe7a1b595bf",
    strip_prefix = "purescript-console-4.1.0",
)

purescript_dep(
    name = "purescript_effect",
    url = "https://github.com/purescript/purescript-effect/archive/v2.0.0.tar.gz",
    sha256 = "5254c048102a6f4360a77096c6162722c4c4b2449983f26058d75d4e5be9d301",
    strip_prefix = "purescript-effect-2.0.0",
)

purescript_dep(
    name = "purescript_prelude",
    url = "https://github.com/purescript/purescript-prelude/archive/v4.0.1.tar.gz",
    sha256 = "3b69b111875eb2b915fd7bdf320707ed3d22194d71cd51d25695d22ab06ae6ee",
    strip_prefix = "purescript-prelude-4.0.1",
)
</code></pre></div>
<h2 id="user-content-defining-a-project" dir="auto"><a class="heading-link" href="#defining-a-project">Defining a project<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">With this in place you can now define a <code>BUILD</code> file for your project:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="load(&quot;@io_bazel_rules_purescript//purescript:purescript.bzl&quot;, &quot;purescript_app&quot;, &quot;purescript_test&quot;)

dependencies = \
    [ &quot;@purescript_console//:pkg&quot;
    , &quot;@purescript_effect//:pkg&quot;
    , &quot;@purescript_prelude//:pkg&quot;
    ]

# Defines an application with default entrypoint (Main.main):
purescript_app(
    name       = &quot;purs-app&quot;,
    visibility = [&quot;//visibility:public&quot;],
    srcs       = glob([&quot;src/**/*.purs&quot;]),
    deps       = dependencies,
)"><pre lang="python" class="notranslate"><code>load("@io_bazel_rules_purescript//purescript:purescript.bzl", "purescript_app", "purescript_test")

dependencies = \
    [ "@purescript_console//:pkg"
    , "@purescript_effect//:pkg"
    , "@purescript_prelude//:pkg"
    ]

# Defines an application with default entrypoint (Main.main):
purescript_app(
    name       = "purs-app",
    visibility = ["//visibility:public"],
    srcs       = glob(["src/**/*.purs"]),
    deps       = dependencies,
)
</code></pre></div>
<p dir="auto">You can now build your program and run the main function!</p>
<p dir="auto">If you want to customize the entrypoint, you can do something like:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="purescript_app(
    name             = &quot;purs-app&quot;,
    visibility       = [&quot;//visibility:public&quot;],
    srcs             = glob([&quot;src/**/*.purs&quot;]),
    deps             = dependencies,
    entry_module     = &quot;MyModule&quot;,
    entry_function   = &quot;myFunction&quot;,
    entry_parameters = [ &quot;my&quot;, &quot;parameters&quot; ],
)"><pre lang="python" class="notranslate"><code>purescript_app(
    name             = "purs-app",
    visibility       = ["//visibility:public"],
    srcs             = glob(["src/**/*.purs"]),
    deps             = dependencies,
    entry_module     = "MyModule",
    entry_function   = "myFunction",
    entry_parameters = [ "my", "parameters" ],
)
</code></pre></div>
<h3 id="user-content-depending-on-other-bazel-purescript-projects" dir="auto"><a class="heading-link" href="#depending-on-other-bazel-purescript-projects">Depending on other Bazel Purescript Projects<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h3>
<p dir="auto">Currently this is as simple as adding the label to your project's dependencies.
There's a known issue with the way this is currently implemented. Files with
the same name will overwrite each other. This is detailed in
<a href="https://github.com/felixmulder/rules_purescript/issues/4" data-hovercard-type="issue" data-hovercard-url="/felixmulder/rules_purescript/issues/4/hovercard">#4</a>.</p>
<p dir="auto">Example of depending on other bazel purescript project:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="purescript_app(
    name             = &quot;purs-app&quot;,
    visibility       = [&quot;//visibility:public&quot;],
    srcs             = glob([&quot;src/**/*.purs&quot;]),
    deps             = [ &quot;//lib:purs-lib&quot; ] + dependencies,
)"><pre lang="python" class="notranslate"><code>purescript_app(
    name             = "purs-app",
    visibility       = ["//visibility:public"],
    srcs             = glob(["src/**/*.purs"]),
    deps             = [ "//lib:purs-lib" ] + dependencies,
)
</code></pre></div>
<h2 id="user-content-testing" dir="auto"><a class="heading-link" href="#testing">Testing<svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></h2>
<p dir="auto">In the same <code>BUILD</code> file, you can define a test module:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="purescript_test(
    name = &quot;purs-app-test&quot;,
    srcs = glob([&quot;test/**/*.purs&quot;]) + glob([&quot;src/**/*.purs&quot;]),
    deps = dependencies,
)"><pre lang="python" class="notranslate"><code>purescript_test(
    name = "purs-app-test",
    srcs = glob(["test/**/*.purs"]) + glob(["src/**/*.purs"]),
    deps = dependencies,
)
</code></pre></div>
<p dir="auto">in the <code>test</code> directory I've created a module like:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="module Test.Main where

-- imports omitted

main :: Effect Unit
main = log &quot;Hello test world!&quot;"><pre lang="purescript" class="notranslate"><code>module Test.Main where

-- imports omitted

main :: Effect Unit
main = log "Hello test world!"
</code></pre></div>
<p dir="auto">when you run <code>bazel test</code> on the <code>:purs-app-test</code> project, it should succeed
ðŸŽ‰</p>
<p dir="auto"><strong>NOTE:</strong> the default entrypoint for testing is the module <code>Test.Main</code> and the
function <code>main</code>. But these can be overwritten:</p>
<div class="snippet-clipboard-content notranslate position-relative overflow-auto" data-snippet-clipboard-copy-content="purescript_test(
    name          = &quot;purs-app-test&quot;,
    srcs          = glob([&quot;test/**/*.purs&quot;]) + glob([&quot;src/**/*.purs&quot;]),
    deps          = dependencies,
    main_module   = &quot;MyMainTest.Whatever&quot;
    main_function = &quot;myFun&quot;
)"><pre lang="python" class="notranslate"><code>purescript_test(
    name          = "purs-app-test",
    srcs          = glob(["test/**/*.purs"]) + glob(["src/**/*.purs"]),
    deps          = dependencies,
    main_module   = "MyMainTest.Whatever"
    main_function = "myFun"
)
</code></pre></div>
</article></div>